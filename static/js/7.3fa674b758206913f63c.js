webpackJsonp([7],{"1C79":function(e,n,t){var r=t("uIr7"),o=t("Qp3N");e.exports=function e(n,t,i,a,c){var s=-1,u=n.length;for(i||(i=o),c||(c=[]);++s<u;){var l=n[s];t>0&&i(l)?t>1?e(l,t-1,i,a,c):r(c,l):a||(c[c.length]=l)}return c}},"9fDL":function(e,n){},PVzK:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=t("2R8v"),o=t.n(r),i=t("Dd8w"),a=t.n(i),c=t("mvHQ"),s=t.n(c),u=t("fZjL"),l=t.n(u),d=t("Xxa5"),f=t.n(d),p=t("exGp"),m=t.n(p),v=t("ifoU"),h=t.n(v),g=t("nPYt"),F=t("7o8y"),b=t("RxjI"),w=function(e,n){var t=n._c;return t("div",{staticClass:"skeleton-screen"},n._l(60,function(e){return t("div",{key:e,staticClass:"skeleton-content"})}),0)};w._withStripped=!0;var x={render:w,staticRenderFns:[]},k=x;var y=!1;var C=t("VU/8")(null,k,!0,function(e){y||t("hPJd")},"data-v-34766d50",null);C.options.__file="src/components/ReportForm/formApplication/formFill/components/skeleton.vue";var _=C.exports,I=t("HiFX"),V=t("vWu6"),L=t.n(V),$={props:{finishAllWorkorder:{type:Boolean,default:!1}},methods:{closeDialog:function(){this.$parent.closeDialog()},cancelFinishApply:function(){this.closeDialog()},save:function(e){this.$parent.saveForm(e)}}},R=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",[t("el-dialog",{staticClass:"closeWorkOrder",attrs:{title:"提示",visible:e.finishAllWorkorder,"show-close":!0,width:"30%","append-to-body":""},on:{"update:visible":function(n){e.finishAllWorkorder=n},closed:e.closeDialog}},[t("div",{staticStyle:{"font-size":"14px",color:"#666"}},[e._v("当前服务报告完成后，当前工单和服务申请均可完结，是否同步完成？")]),e._v(" "),t("div",{staticStyle:{display:"flex","justify-content":"space-between"},attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{plain:"",size:"small"},on:{click:e.cancelFinishApply}},[e._v(" 取消 ")]),e._v(" "),t("div",[t("el-button",{attrs:{type:"danger",plain:"",size:"small"},on:{click:function(n){return e.save(1)}}},[e._v(" 发布并完成服务 ")]),e._v(" "),t("el-button",{attrs:{type:"danger",plain:"",size:"small"},on:{click:function(n){return e.save(2)}}},[e._v(" 完成工单 ")]),e._v(" "),t("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(n){return e.save(1)}}},[e._v(" 仅发布报告 ")])],1)],1)])],1)};R._withStripped=!0;var O={render:R,staticRenderFns:[]},D=O;var T=!1;var j=t("VU/8")($,D,!1,function(e){T||t("e9Ql")},"data-v-3c871c14",null);j.options.__file="src/components/ReportForm/formApplication/formFill/components/fillDialog.vue";var z=j.exports,A=o()(["\n            position: relative;\n            display: flex;\n            justify-content: center;\n            box-sizing: border-box;\n            width: 100%;\n            height: 90%;\n            margin: 0;\n            padding: 0;\n          "],["\n            position: relative;\n            display: flex;\n            justify-content: center;\n            box-sizing: border-box;\n            width: 100%;\n            height: 90%;\n            margin: 0;\n            padding: 0;\n          "]),N=o()(["\n            box-sizing: border-box;\n            padding: 0 5px;\n            width: 50%;\n            overflow: auto;\n            padding-bottom: 50px;\n            &::-webkit-scrollbar {\n              width: 3px !important;\n            }\n          "],["\n            box-sizing: border-box;\n            padding: 0 5px;\n            width: 50%;\n            overflow: auto;\n            padding-bottom: 50px;\n            &::-webkit-scrollbar {\n              width: 3px !important;\n            }\n          "]),M=o()(["\n            z-index: 99;\n            box-sizing: border-box;\n            display: flex;\n            justify-content: center;\n            position: fixed;\n            width: 90%;\n            align-items: center;\n            height: 50px;\n            bottom: 0;\n            background-color: #fff;\n          "],["\n            z-index: 99;\n            box-sizing: border-box;\n            display: flex;\n            justify-content: center;\n            position: fixed;\n            width: 90%;\n            align-items: center;\n            height: 50px;\n            bottom: 0;\n            background-color: #fff;\n          "]),S=VueCompositionAPI,B=(S.ref,S.reactive,S.onMounted,S.onUnmounted),W={components:{Skeleton:_},data:function(){return{renderDone:!0,componentList:[],revertFormValueList:[],revertFormValueMapRecord:new h.a,moduleList:[],activeTab:"",finishAllWorkorder:!1,observer:null}},provide:function(){return{createFormField:this.createFormField,formContentList:b.formOperationState.formContentList,saveForm:this.saveForm}},created:function(){var e=this;return m()(f.a.mark(function n(){return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e.initVM(),Object(F.i)(),n.next=4,e.getRecordValue();case 4:return n.next=6,e.revertFormComponentList();case 6:case"end":return n.stop()}},n,e)}))()},beforeDestroy:function(){Object(F.d)()},methods:{createIntersectionObserver:function(){var e=this;return m()(f.a.mark(function n(){return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.$nextTick();case 2:e.observer=new IntersectionObserver(function(n){var t=n[0].isIntersecting,r=n[0].target;if(t){var o=r.getAttribute("data-module-name"),i=e.moduleList.find(function(e){return e.configField.fieldName==o}).configField.woComponentId;i&&(e.activeTab=i)}},{root:e.$refs.formFillContainer,rootMargin:"0px",threshold:.4}),l()(e.$refs).forEach(function(n){e.$refs[n].$el&&e.observer.observe(e.$refs[n].$el)});case 4:case"end":return n.stop()}},n,e)}))()},initVM:function(){this},getRecordValue:function(){var e=this;return m()(f.a.mark(function n(){var t;return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(F.k)({woRecordId:e.$route.query.woRecordId});case 2:1e3==(t=n.sent).data.code&&(e.revertFormValueList=t.data.data);case 4:case"end":return n.stop()}},n,e)}))()},findBaseCompInfo:function(e){var n=g.a[0].subMenuData.find(function(n){return n.componentType===e});return n?JSON.parse(s()(n)):null},handeBackendData:function(e){var n=this;if(e&&e.length)return e.map(function(e){var t=n.findBaseCompInfo(e.woComponentType),r=t||JSON.parse(s()(e));return r.configField=e,r.configField.options=e.options?JSON.parse(e.options):r.options,r.configField.componentType=e.woComponentType,r.configField.fieldName=e.woComponentName,r.configField.children=n.handeBackendData(e.children),n.revertFormComponentValue(r),n.revertFormFillButtonGroupList(r),r})},revertFormComponentValue:function(e){var n=this;return m()(f.a.mark(function t(){var r,o;return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n.revertFormValueList.length){t.next=2;break}return t.abrupt("return");case 2:if(r=n.revertFormValueList.find(function(n){return n.woComponentId==e.configField.woComponentId})){t.next=5;break}return t.abrupt("return");case 5:o=r.value,2==e.configField.componentType&&(o=r.richValue),e.configField.defaultValue=o||e.configField.defaultValue,n.revertFormValueMapRecord.set(e.configField.woComponentId,r);case 9:case"end":return t.stop()}},t,n)}))()},revertFormFillButtonGroupList:function(e){var n=this;if(8==e.configField.componentType){var t=e.configField.children;if(!t||!t.length)return;var r=t.map(function(e){return e.configField.woComponentId}),o=this.revertFormValueList.filter(function(e){return r.includes(e.woComponentId)}),i=o.map(function(e){var r=t.find(function(n){return n.configField.woComponentId==e.woComponentId});return n.revertFormValueMapRecord.set(e.woComponentId+"-"+e.row,e),a()({},r,{configField:a()({},r.configField,{defaultValue:e.value}),row:e.row})});if(!o.length)return;var c=Object.groupBy(i,function(e){return e.row});e.configField.__groupList=l()(c).map(function(e){return c[e]})}},revertFormComponentList:function(){var e=this;return m()(f.a.mark(function n(){var t,r,o;return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.$route.query.woFormId){n.next=14;break}return e.renderDone=!1,n.next=4,Object(F.f)({woFormId:e.$route.query.woFormId});case 4:if(t=n.sent,r=t.data.data,(o=e.handeBackendData(r))&&o.length>0&&o.forEach(function(n){e.createFormField(n)}),e.moduleList=o.filter(function(e){return 11==e.componentType&&e.configField.display}),e.moduleList.length){n.next=11;break}return n.abrupt("return");case 11:e.activeTab=e.moduleList[0].configField.woComponentId,e.renderDone=!0,e.createIntersectionObserver();case 14:case"end":return n.stop()}},n,e)}))()},saveForm:function(e){var n=this,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return m()(f.a.mark(function r(){var o,i,a,c;return f.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:o=function(e){if(!e.woComponentId)return e;var t=e.woComponentId,r=e.row?t+"-"+e.row:t;if(n.revertFormValueMapRecord.has(r)){var o=n.revertFormValueMapRecord.get(r);e.woValueId=o.woValueId}return e},i=function(e,n){return 2==e._configField.componentType&&(n.richValue=n.value,delete n.value),n},a=function(e){var t=e.fieldInfo,r=e.formModel,a=r&&r.value,s=t.row,u=t._configField,l={row:s,value:a,woComponentId:u.woComponentId,woComponentName:u.woComponentName,woRecordId:n.$route.query.woRecordId};return i(t,l),o(l),c(t,l),l},c=function(e,t){var r=e._configField.requireFlag,o=e._configField.woComponentType;if(![7,10,11].includes(o)&&(Number(r)&&!(2==o?t.richValue:t.value))){var i=e._configField.fieldName+"为必填项";throw n.$message({message:i,type:"warning"}),n.closeDialog(),i}},function(){var r=m()(f.a.mark(function r(){var o,i,c;return f.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return o=[],b.formOperationState.formContentList.map(function(e){var t=n.$refs[e.__uuid],r=t.getComponentValue();if(o.push(r),[8,9,10,11,14].includes(t.fieldInfo._configField.componentType)){var i=t.getFieldComponentInstance(),a=i.getComponentValue&&i.getComponentValue();o.push(a)}}),i=L()(o),c=i.filter(function(e){return e}).map(function(e){return a(e)}),r.next=6,Object(F.c)({operate:e,woFormValueRequestList:c});case 6:1e3==r.sent.data.code&&(t&&n.$message.success("保存成功"),0!=e&&n.$router.go(-1)),n.closeDialog();case 9:case"end":return r.stop()}},r,n)}));return function(){return r.apply(this,arguments)}}()();case 6:case"end":return r.stop()}},r,n)}))()},previewReport:function(){var e=this;return m()(f.a.mark(function n(){var t,r;return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(F.j)({woRecordId:e.$route.query.woRecordId});case 2:if(1e3!=(t=n.sent).data.code){n.next=12;break}return n.next=6,e.requestMethodGetTip("/web/file/getFullUrl",{url:t.data.data});case 6:return n.next=8,n.sent;case 8:r=n.sent,window.open(r.data.data,"_blank"),n.next=13;break;case 12:e.$message.warning(t.data.msg);case 13:case"end":return n.stop()}},n,e)}))()},clickTabpane:function(e){var n=this.moduleList[e.index].configField;if(n&&n.woComponentUuid){var t=this.$refs[n.woComponentUuid].$el;t&&t.scrollIntoView()}},cancelFillForm:function(){var e=this;this.$confirm("取消后将丢失本次编辑内容","取消编辑",{confirmButtonText:"确定",cancelButtonText:"继续编辑",type:"warning"}).then(function(){e.$router.go(-1)}).catch(function(){})},saveFormAndPublic:function(){var e=this;return m()(f.a.mark(function n(){return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.$nextTick();case 2:e.finishAllWorkorder=!0;case 3:case"end":return n.stop()}},n,e)}))()},closeDialog:function(){this.finishAllWorkorder=!1}},setup:function(){var e=b.useFormCreate().createFormField;return B(function(){b.clearFormGenerateData()}),{createFormField:e}},render:function(){var e=this,n=arguments[0];return n("div",{class:Object(I.b)("form-fill__container",Object(I.a)(A))},[n("el-tabs",{class:"report-form__tabs",attrs:{value:this.activeTab,"tab-position":"left"},style:"margin-right:50px;width:fit-content;min-width:100px",on:{"tab-click":this.clickTabpane}},[this.moduleList.map(function(e){return n("el-tab-pane",{attrs:{label:e.configField.fieldName,name:e.configField.woComponentId}})})]),n("div",{ref:"formFillContainer",class:Object(I.a)(N)},[n("div",[this.renderDone?n("transition-group",{attrs:{name:"form-property-box-content-list"}},[b.formOperationState.formContentList.map(function(e){return n(e.Cotr,{attrs:{"data-module-name":e._uFieldInfo._configField.fieldName,_uFieldInfo:e._uFieldInfo,disabledEditForm:!0},key:e.__uuid,ref:e.__uuid})})]):n(_)])]),n("div",{class:Object(I.a)(M)},[n("el-button",{attrs:{size:"mini"},on:{click:this.previewReport}},["预览报告"]),n("el-button",{attrs:{size:"mini"},on:{click:function(){return e.saveForm(0)}}},["保存草稿"]),n("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(){return e.saveFormAndPublic(1)}}},["保存并发布"]),n("el-button",{attrs:{size:"mini"},on:{click:this.cancelFillForm}},["取消"])]),n(z,{attrs:{finishAllWorkorder:this.finishAllWorkorder}})])}},q=!1;var P=t("VU/8")(W,null,!1,function(e){q||(t("9fDL"),t("vgye"))},"data-v-0ac68284",null);P.options.__file="src/components/ReportForm/formApplication/formFill/index.vue";n.default=P.exports},Qp3N:function(e,n,t){var r=t("NkRn"),o=t("1Yb9"),i=t("NGEn"),a=r?r.isConcatSpreadable:void 0;e.exports=function(e){return i(e)||o(e)||!!(a&&e&&e[a])}},e9Ql:function(e,n){},hPJd:function(e,n){},vWu6:function(e,n,t){var r=t("1C79"),o=1/0;e.exports=function(e){return null!=e&&e.length?r(e,o):[]}},vgye:function(e,n){}});