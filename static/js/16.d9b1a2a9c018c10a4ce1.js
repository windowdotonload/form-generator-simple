webpackJsonp([16],{"73cQ":function(e,t){},"7YgM":function(e,t){e.exports={name:"my-test",version:"1.0.0",description:"A Vue.js project",author:"",private:!0,scripts:{dev:"webpack-dev-server --inline --progress --config build/webpack.dev.conf.js",local:"cross-env NODE_ENV=local webpack-dev-server --inline --progress --config build/webpack.dev.conf.js",start:"npm run dev",unit:"jest --config test/unit/jest.conf.js --coverage",e2e:"node test/e2e/runner.js",test:"npm run unit && npm run e2e",build:"node build/build.js","build--uat":"cross-env NODE_ENV=testing env_config=test node build/build.js","build--pro":"cross-env NODE_ENV=production env_config=prod node build/build.js","build--dev":"cross-env NODE_ENV=development env_config=dev node build/build.js"},dependencies:{"@emotion/css":"^11.11.2","@wangeditor/editor":"^5.1.23","@wangeditor/editor-for-vue":"^1.0.2",axios:"^0.19.2","crypto-js":"^4.1.1",echarts:"^5.4.0","el-table-infinite-scroll":"^1.0.11","element-china-area-data":"^4.2.0","element-ui":"2.13.0",encryptlong:"^3.1.4","font-awesome":"^4.7.0",html2canvas:"^1.4.1","js-base64":"^3.7.3","js-cookie":"^3.0.1","js-sha256":"^0.9.0",jsencrypt:"^3.3.2",less:"^3.13.1","less-loader":"^5.0.0",lodash:"^4.17.21",moment:"^2.29.4",vue:"^2.6.11","vue-clipboard2":"^0.3.3","vue-quill-editor":"^3.0.6",vuedraggable:"^2.24.3",vuex:"^3.6.2"},devDependencies:{autoprefixer:"^7.1.2","babel-core":"^6.22.1","babel-eslint":"^8.2.1","babel-helper-vue-jsx-merge-props":"^2.0.3","babel-jest":"^21.0.2","babel-loader":"^7.1.1","babel-plugin-dynamic-import-node":"^1.2.0","babel-plugin-syntax-jsx":"^6.18.0","babel-plugin-transform-es2015-modules-commonjs":"^6.26.0","babel-plugin-transform-runtime":"^6.22.0","babel-plugin-transform-vue-jsx":"^3.5.0","babel-preset-env":"^1.3.2","babel-preset-stage-2":"^6.22.0","babel-register":"^6.22.0",chalk:"^2.0.1","copy-webpack-plugin":"^4.0.1","cross-env":"^7.0.3","cross-spawn":"^5.0.1","css-loader":"^0.28.0",eslint:"^4.15.0","eslint-config-standard":"^10.2.1","eslint-friendly-formatter":"^3.0.0","eslint-loader":"^1.7.1","eslint-plugin-import":"^2.26.0","eslint-plugin-node":"^5.2.0","eslint-plugin-promise":"^3.4.0","eslint-plugin-security":"^1.7.1","eslint-plugin-standard":"^3.0.1","eslint-plugin-vue":"^4.0.0","extract-text-webpack-plugin":"^3.0.0","file-loader":"^1.1.4","friendly-errors-webpack-plugin":"^1.6.1","hard-source-webpack-plugin":"^0.13.1","html-webpack-plugin":"^2.30.1",jest:"^22.0.4","jest-serializer-vue":"^0.3.0",nightwatch:"^0.9.12","node-notifier":"^5.4.5","optimize-css-assets-webpack-plugin":"^3.2.0",ora:"^1.2.0",portfinder:"^1.0.32","postcss-import":"^11.0.0","postcss-loader":"^2.0.8","postcss-url":"^7.2.1",rimraf:"^2.6.0","selenium-server":"^3.0.1",semver:"^5.3.0",shelljs:"^0.7.6","uglifyjs-webpack-plugin":"^1.1.1","url-loader":"^0.5.8","vue-jest":"^1.0.2","vue-loader":"^13.3.0","vue-style-loader":"^3.0.1","vue-template-compiler":"^2.7.15",webpack:"^3.6.0","webpack-bundle-analyzer":"^2.9.0","webpack-dev-server":"^2.11.5","webpack-merge":"^4.1.0"},engines:{node:">= 6.0.0",npm:">= 3.0.0"},browserslist:["> 1%","last 2 versions","not ie <= 8"]}},"8qGi":function(e,t,i){"use strict";var o=i("woOf"),a=i.n(o),l=i("Xxa5"),r=i.n(l),n=i("Dd8w"),s=i.n(n),d=i("exGp"),c=i.n(d),u=i("fZjL"),m=i.n(u),h=i("mvHQ"),p=i.n(h),g=i("DpoM"),v=i("n8UN"),f={components:{SyncLub:i("Csjt").a,AddOil:g.a,imgCutter:v.a},props:{addLubricationPointDialog:{type:Boolean,default:function(){return!1}},saveFlag:{type:Boolean,default:function(){return!1}},addLumPointFormSave:{type:Object,default:function(){return{}}},addDeviceForm:{type:Object,default:function(){return{}}},epInfo:{type:Object,default:function(){return{}}},imageLubricationList:{type:Array,default:function(){return[]}},uploadUrl:{type:String,default:""},resource:{type:String,default:""},selectLubricationPointNumber:{type:String,default:""},deviceTypeDialog:{type:String,default:""}},data:function(){return{validatePeriodVal:function(e){var t=e.oilChangePeriodUnit;return function(e,i,o){return i?parseInt(i)<0?o(new Error("请输入大于0的周期")):"Y"==t&&i>20?o(new Error("请输入小于20年的周期")):"M"==t&&i>240?o(new Error("请输入小于240月的周期")):"D"==t&&i>7300?o(new Error("请输入小于7300天的周期")):"H"==t&&i>175200?o(new Error("请输入小于175200小时的周期")):o():o(new Error("请输入换油周期"))}},expireTimeOption:{disabledDate:function(e){return e.getTime()>Date.now()}},pickerBeginDateBefore:{disabledDate:function(e){return e.getTime()<Date.now()}},pruneIndex:null,uploadUrl:"",picAddCont:[],imgDialogVisible:!1,dialogImageUrl:"",cutFileList:{},cutFlag:!1,notShowUploadBtn:!1,cutWidth:200,cutHeight:200,pictureFields:[],roleType:"",addType:"",oilList:[],addOilDialog:!1,oilTypeDevice:"1",showSyncLubDialog:!1,tipsData:{},lupDeviceNameList:[],addLubricationPointDialog:!1,lubricationPointTypeData:[],lubricationPointTypeList:[],loadingRemote:!1,oilChangePeriodList:[],hideUpload:!1,typeProps:{value:"code",label:"name"},oilBoxCapacityList:[{oilBoxCapacityUnit:"L",oilBoxCapacityUnitDesc:"L"},{oilBoxCapacityUnit:"KG",oilBoxCapacityUnitDesc:"KG"}],addOilForm:{oilBrand:"",oilType:"",oilName:""},addLumPointForm:{imgLubricationFile:"",lubricationPointPicPath:"",lubricationPointPicRelativePath:"",recommendOilBrand:"",oilChangeMethod:2,recommendOilType:"",recommendOilSeries:"",recommendOilCode:"",lubricationPointType:"",lubricationPointTypeCode:"",lastOilAddDate:"",oilBrandCode:"",lubricationPointName:"",lubricationPointDesc:"",lubricationPointManufacturer:"",lubricationMethod:"",oilAddPeriod:"",oilName:"",oilSeries:"",oilType:"",everyTimeOilAddQuantityUnit:"L",fillingQuantityUnit:"L",preMonthOilAddQuantityUnit:"L",preMonthOilAddQuantity:"",lastOilChangeDate:"",fillingQuantity:"",oilBoxCapacity:"",currentOilCode:"",everyTimeOilAddQuantity:"",nextScheduledOilChangeDate:"",nextScheduledOilAddDate:"",autoCreateOilChangePlan:!1,lastTestDate:"",autoCreateOilAddPlan:!1,oilChangePeriodUnit:"D",oilChangePeriod:"",oilBoxCapacityUnit:"L",oilAddPeriodUnit:"D",lubricationPointSelectName:"",tableFromValueList:[],deviceWorkComponentList:[]},brandError:!1,typeError:!1,nameError:!1,noticeError:"",addOilRules:{oilBrand:[{required:!0,message:"请选择油品品牌",trigger:"change"}],oilBrandName:[{required:!0,message:"请输入油品品牌",trigger:"blur"}],oilName:[{required:!0,message:"请输入油品名称",trigger:"blur"}],oilTypeName:[{required:!0,message:"请输入油品类型",trigger:"blur"}],oilType:[{required:!0,message:"请选择油品类型",trigger:"change"}]},rules:{oilChangeMethod:[{required:!0,message:"请选择定期或按质换油",trigger:"change"}],lubricationPointName:[{required:!0,message:"请输入润滑点设备名称",trigger:"blur"}],lubricationPointSelectName:[{required:!0,message:"请选择润滑点设备名称",trigger:"change"}],lubricationMethod:[{required:!0,message:"请选择润滑方式",trigger:"change"}],oilChangePeriodUnit:[{required:!0,message:"请输入换油周期单位",trigger:"change"}],lubricationPointTypeCode:[{required:!0,message:"请选择润滑点设备类型",trigger:"change"}],currentOilCode:[{required:!0,message:"请选择在用油品名称",trigger:"change"}]},oldBussess:Boolean,fields:[],fieldsFlag:!1}},created:function(){},watch:{addLubricationPointDialog:{handler:function(e,t){var i=this;this.$_queryLubricationMethodData(),this.oldBussess=this.epInfo.newBusinessFlag,"editLumPoint"!=this.deviceTypeDialog&&"addLumPoint"!=this.deviceTypeDialog||this.$set(this.addDeviceForm,"newBusinessFlag",this.oldBussess),console.log(this.addDeviceForm),this.$_queryLPData(),this.getOilData(),this.$_queryOilChangePeriodData();var o=[];this.addDeviceForm.eptType&&this.addDeviceForm.eptType.length>0||(this.epInfo.deviceTypeDto&&this.epInfo.deviceTypeDto.forEach(function(e){o.push(e.code)}),this.epInfo&&"{}"!=p()(this.epInfo)&&(this.addDeviceForm.eptType=o)),"editDeviceAndLumPoint"!=this.deviceTypeDialog&&"editLumPoint"!=this.deviceTypeDialog&&(console.log(99999,this.epInfo,this.addDeviceForm),this.addDeviceForm.eptType&&this.addDeviceForm.eptType.length>0?this.eptTypeChange(this.addDeviceForm.eptType):this.eptTypeChange(this.epInfo.deviceType,"","devicetype")),"editLumPoint"!=this.deviceTypeDialog&&"editDeviceAndLumPoint"!=this.deviceTypeDialog||this.saveFlag?this.addLumPointFormSave&&"{}"!=p()(this.addLumPointFormSave)&&this.saveFlag&&(m()(this.addLumPointForm).forEach(function(e){i.addLumPointForm[e]=i.addLumPointFormSave[e]}),this.oilTypeDevice=this.addLumPointForm.oilType):(this.addDeviceForm.newBusinessFlag&&void 0!=this.addDeviceForm.newBusinessFlag&&"editDeviceAndLumPoint"==this.deviceTypeDialog&&this.$set(this.addDeviceForm,"newBusinessFlag",this.addDeviceForm.newBusinessFlag),this.$_getLubricationPointDetail())},immediate:!0}},methods:{isObjectEmpty:function(e){return console.log(e),0===m()(e).length},addPicture:function(e){var t=this;return c()(r.a.mark(function i(){var o,a,l,n,d,c;return r.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return console.log(e),o={},i.next=4,t.requestMethodGet("/device/workComponent/list",{lubricationPointType:t.addLumPointForm.lubricationPointTypeCode});case 4:a=i.sent,t.picAddCont=a.data.data.filter(function(e){return"12"==e.componentType}),t.picAddCont[0].componentList.forEach(function(e){console.log(e),e.componentId=e.id,e.id="","8"==e.componentType&&t.$set(e,"imgFullDtoUrl",[])}),"{}"==p()(e.componentList)?(console.log(t.picAddCont[0]),(l=_.cloneDeep(t.picAddCont[0].componentList)).uid=_.uniqueId("addLupSituation_"),o={1:l}):(console.log(e.componentList[1]),n=m()(e.componentList).length,d=n+1,(c=_.cloneDeep(t.picAddCont[0].componentList)).uid=_.uniqueId("addLupSituation_"),2==d&&(o={2:c}),3==d&&(o={3:c}),4==d&&t.$message({type:"warning",message:"最多添加3条数据"})),e.componentList=s()({},e.componentList,o),console.log(e,"追加后");case 10:case"end":return i.stop()}},i,t)}))()},deletePicture:function(e,t){console.log(e,t),this.$delete(e.componentList,t);var i=[],o=[];for(var a in e.componentList)i.push(a),o.push(e.componentList[a]);for(var l={},r=0;r<i.length;r++){l[r+1]=o[r]}e.componentList=l},handlePictureCardPreview:function(e,t){this.dialogImageUrl=e.url,this.imgDialogVisible=!0},handlePictureUpload:function(e){this.cutFileList=e,this.cutFlag=!1,this.$refs.imgCutterModal.handleOpen()},handlePicturePrune:function(e,t){this.cutFlag=!0,this.cutFileList=t;var i=t.imgFullDtoUrl[0].url;this.$refs.imgCutterModal.handleOpen({name:"img",src:i,width:400,height:400})},imgBackShow:function(e,t){t(e[0].url)},cutDown:function(e){var t,i=this,o=this.cutFileList,a=e.dataURL.split(";")[0].split("/")[1],l=this.dataURLtoBlob(e.dataURL,"裁剪图片."+a),n=new FormData;n.append("fileType","lubrication_point"),n.append("multipartFiles",l),this.requestMethodPost("/web/file/uploadFiles",n).then((t=c()(r.a.mark(function e(t){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:1e3===(t=t.data).code?(i.getFullImgPath1(o,t.data[0],i.cutFlag),o.value=t.data[0]):(o.notShowUploadBtn=!1,i.$message({message:t.msg,type:"warning"}));case 2:case"end":return e.stop()}},e,i)})),function(e){return t.apply(this,arguments)})).catch(function(e){})},dataURLtoBlob:function(e,t){for(var i=e.split(","),o=i[0].match(/:(.*?);/)[1],a=atob(i[1]),l=a.length,r=new Uint8Array(l);l--;)r[l]=a.charCodeAt(l);return new File([r],t,{type:o})},getFullImgPath1:function(e,t,i){var o=this;return c()(r.a.mark(function a(){var l;return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return console.log(e,t,i),l={url:t},a.next=4,o.requestMethodGet("/web/file/getFullUrl",l).then(function(i){1e3==i.data.code?(o.$set(e,"imgFullDtoUrl",[{url:i.data.data}]),o.$set(e,"value",t)):o.$message({message:i.data.msg,type:"warning"})});case 4:case"end":return a.stop()}},a,o)}))()},handleRemove:function(e,t){this.$set(t,"value",""),this.$set(t,"imgFullDtoUrl",[])},cancelAddLumpoint:function(){this.$emit("closeDialogAddLubPoint")},cancelEditLubpoint:function(){this.$emit("closeDialogAddLubPoint")},handleDirectCreationDevice:function(){this.$emit("addDevice")},handleSubmit:function(e,t){var i=this;this.$refs[e].validate(function(e){e?(i.addLumPointForm.oilType=i.oilTypeDevice,i.addLumPointForm.tableFromValueList=i.fields,console.log(i.addLumPointForm),"editLumPoint"==t&&(i.addLumPointForm.lubricationPointNumber=i.selectLubricationPointNumber),"addDeviceAndLubpoint"==t&&i.submitDeviceAndLumpoint("addOrEditLup",i.addLumPointForm,i.showOrHideState,i.lupDeviceNameList,i.addDeviceForm.newBusinessFlag),"editDeviceAndLumPoint"==t&&(i.oldBussess&&!i.addDeviceForm.newBusinessFlag?i.$alert("设备由新项目初装设备变为现有生意设备，必填信息发生改变，请及时补全设备及润滑点信息","提示",{confirmButtonText:"知道了",callback:function(e){i.submitEditDeviceAndLumpoint("editDeviceAndLumPoint",i.addLumPointForm,i.showOrHideState,i.lupDeviceNameList,i.addDeviceForm.newBusinessFlag)}}):i.submitEditDeviceAndLumpoint("editDeviceAndLumPoint",i.addLumPointForm,i.showOrHideState,i.lupDeviceNameList,i.addDeviceForm.newBusinessFlag)),"addLumPoint"!=t&&"editLumPoint"!=t||i.submitAddOrEditLumpoint(i.addLumPointForm,i.showOrHideState,t,i.lupDeviceNameList,i.addDeviceForm.newBusinessFlag)):i.$message({type:"error",message:"存在必填项未录入，请填写后重试"})})},submitAddOrEditLumpoint:function(e,t,i,o,a){var l=this;"addLumPoint"==i?this.$confirm("确定提交添加润滑点?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var i=/^[1-9]\d*$/,o=Number(e.oilChangePeriod),r=Number(e.oilAddPeriod),n=i.test(o),s=i.test(r),d="2"==e.oilType,c=l.oilChangePeriodList,u=null,m=null;if(c.forEach(function(e){e.rangMin=1,e.rangMax=d?"Y"==e.oilChangePeriodUnit?2:"M"==e.oilChangePeriodUnit?24:"D"==e.oilChangePeriodUnit?730:17520:"Y"==e.oilChangePeriodUnit?20:"M"==e.oilChangePeriodUnit?240:"D"==e.oilChangePeriodUnit?7300:175200}),d?c.forEach(function(t){e.oilAddPeriodUnit==t.oilChangePeriodUnit&&(m=t.rangMax)}):(c.forEach(function(t){e.oilChangePeriodUnit==t.oilChangePeriodUnit&&(u=t.rangMax)}),c.forEach(function(t){e.oilAddPeriodUnit==t.oilChangePeriodUnit&&(m=t.rangMax)})),r)if(s&&r>=1&&r<=m);else if(m)return void l.$message({type:"error",message:"加油/加脂周期：请输入1~"+m+"的整数"});if(n&&o&&!d)if(o>=1&&o<=u);else if(u)return void l.$message({type:"error",message:"换油周期：请输入1~"+u+"的整数"});var h={};h.deviceNumber=l.epInfo.deviceNumber,h.lubricationPointTypeCode=e.lubricationPointTypeCode,e.lubricationPointPicPath&&(h.lubricationPointPicPath=e.lubricationPointPicPath),h.newBusinessFlag=a,h.lubricationPointType=e.lubricationPointType,h.oilBoxCapacity=e.oilBoxCapacity,h.lubricationPointManufacturer=e.lubricationPointManufacturer,h.lubricationMethod=e.lubricationMethod,h.oilBoxCapacityUnit=e.oilBoxCapacityUnit,h.oilBrandCode=e.oilBrandCode,h.currentOilCode=e.currentOilCode,l.lupDeviceNameList.length>1&&"自定义"!=e.lubricationPointSelectName?h.lubricationPointName=e.lubricationPointSelectName:h.lubricationPointName=e.lubricationPointName,h.lubricationPointDesc=e.lubricationPointDesc,e.recommendOilCode?h.recommendOilCode=e.recommendOilCode:h.recommendOilCode="",h.oilType=e.oilType,1==e.oilType&&(0==t&&(h.oilChangeMethod=e.oilChangeMethod,h.oilChangePeriod=e.oilChangePeriod,h.oilChangePeriodUnit=e.oilChangePeriodUnit,e.lastOilChangeDate&&(h.lastOilChangeDate=e.lastOilChangeDate,h.fillingQuantity=e.fillingQuantity,h.fillingQuantityUnit=e.fillingQuantityUnit),1==e.oilChangeMethod&&e.lastOilChangeDate&&e.oilChangePeriod&&"KM"!=e.oilChangePeriodUnit&&(h.autoCreateOilChangePlan=e.autoCreateOilChangePlan,e.nextScheduledOilChangeDate&&e.autoCreateOilChangePlan&&(h.nextScheduledOilChangeDate=e.nextScheduledOilChangeDate))),h.oilAddPeriod=e.oilAddPeriod,h.oilAddPeriodUnit=e.oilAddPeriodUnit,h.lastOilAddDate=e.lastOilAddDate,h.everyTimeOilAddQuantity=e.everyTimeOilAddQuantity,h.everyTimeOilAddQuantityUnit=e.everyTimeOilAddQuantityUnit,h.preMonthOilAddQuantity=e.preMonthOilAddQuantity,h.preMonthOilAddQuantityUnit=e.preMonthOilAddQuantityUnit,e.oilAddPeriod&&e.lastOilAddDate&&"KM"!=e.oilAddPeriodUnit&&(h.autoCreateOilAddPlan=e.autoCreateOilAddPlan,e.autoCreateOilAddPlan&&(h.nextScheduledOilAddDate=e.nextScheduledOilAddDate))),2==e.oilType&&(h.oilAddPeriodUnit=e.oilAddPeriodUnit,h.oilAddPeriod=e.oilAddPeriod,h.everyTimeOilAddQuantity=e.everyTimeOilAddQuantity,h.everyTimeOilAddQuantityUnit=e.everyTimeOilAddQuantityUnit,h.lastOilAddDate=e.lastOilAddDate,h.preMonthOilAddQuantity=e.preMonthOilAddQuantity,h.preMonthOilAddQuantityUnit=e.preMonthOilAddQuantityUnit,e.lastOilAddDate&&e.oilAddPeriod&&"KM"!=e.oilAddPeriodUnit&&(h.autoCreateOilAddPlan=e.autoCreateOilAddPlan,""!=e.nextScheduledOilAddDate&&e.autoCreateOilAddPlan&&(h.nextScheduledOilAddDate=e.nextScheduledOilAddDate))),e.tableFromValueList.forEach(function(e){if(12==e.componentType||11==e.componentType){var t=function(t){console.log(t),e.componentList[t].forEach(function(e,i){e.row=t})};for(var i in e.componentList)t(i)}}),h.tableFromValueList=e.tableFromValueList,h.delFlag=!1,++l.recommendOilCodeKey,l.requestMethodPost("/web/device/addMoreLubricationPoint",h).then(function(e){1e3==(e=e.data).code?(l.$message({message:"添加成功",type:"success"}),e.data.tips&&2!=l.$userInfo.userType?(l.showSyncLubDialog=!0,l.tipsData=e.data.tips):l.$emit("addOrEditLup")):l.$message({message:e.msg,type:"warning"})}).catch(function(e){})}).catch(function(){l.loading=!1}):this.$confirm("确定提交编辑润滑点?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t=e;e.tableFromValueList.forEach(function(e){if(12==e.componentType||11==e.componentType){var t=function(t){console.log(t),e.componentList[t].forEach(function(e,i){e.row=t})};for(var i in e.componentList)t(i)}}),t.deviceNumber=l.epInfo.deviceNumber,t.newBusinessFlag=a,t.delFlag=!1,delete t.lubricationPointPicRelativePath,l.requestMethodPost("/weChat/lubricationPoint/updateLubricationPoint",t).then(function(e){1e3==(e=e.data).code?(l.$message({message:"编辑成功",type:"success"}),l.dialogFlag=!1,l.$emit("addOrEditLup")):l.$message({message:e.msg,type:"warning"})}).catch(function(e){})}).catch(function(){l.loading=!1})},closeSyncLubDialog:function(){this.showSyncLubDialog=!1,this.$emit("addOrEditLup")},addOrEditOil:function(e){var t=this,i={oilBrand:e.oilBrand,oilName:e.oilName,customerCompanyNumber:JSON.parse(this.Decrypt(sessionStorage.getItem("userInfo"))).companyNumber};"0"==e.oilBrand&&(i.oilBrand="",i.customCode="1",i.oilBrandName=e.oilBrandName),this.requestMethodPost("mdm/oil/addOil",i).then(function(i){1e3==i.data.code?("0"==e.oilBrand?(t.getOilBrandData(),t.getQueryOilList("oilBrandList","add",i.data.data.oilBrandNumber),"oilName"==t.addType&&(t.addLumPointForm.oilBrandCode=i.data.data.oilBrandNumber)):t.addLumPointForm.oilBrandCode=e.oilBrand,console.log(t.addType,88989),"oilName"==t.addType?(t.getOilData("",i.data.data.oilNameNumber),t.$set(t.addLumPointForm,"currentOilCode",i.data.data.oilNameNumber)):(t.getOilData("",i.data.data.oilNameNumber),t.$set(t.addLumPointForm,"recommendOilCode",i.data.data.oilNameNumber)),t.addOilDialog=!1):t.$message({message:i.data.msg,type:"error"})})},closeDialogAdd:function(){a()(this.$data.addOilForm,this.$options.data().addOilForm),this.addOilDialog=!1},createOil:function(e){this.addType=e,"currentName"==e&&(this.$set(this.addOilForm,"oilBrand",""),this.$set(this.addOilForm,"oilBrandName","")),this.$set(this.addOilForm,"oilBrand",""),this.$set(this.addOilForm,"oilBrandName",""),this.$set(this.addOilForm,"oilType",""),this.$set(this.addOilForm,"oilName",""),this.$set(this.addOilForm,"oilTypeName",""),this.addOilDialog=!0},submitDeviceAndLumpoint:function(e,t,i,o,a){var l=this;this.$confirm("确定提交添加设备?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){console.log(t);var e={};e.deviceName=l.addDeviceForm.deviceName,e.spId=l.addDeviceForm.spId,e.customerNumber=l.addDeviceForm.customerNumber,e.deviceType=l.addDeviceForm.eptType[l.addDeviceForm.eptType.length-1],e.workshopId=l.addDeviceForm.workshopId,e.newBusinessFlag=l.addDeviceForm.newBusinessFlag,e.manufacturer=l.addDeviceForm.manufacturer,e.deviceModel=l.addDeviceForm.deviceModel,e.deviceCode=l.addDeviceForm.deviceCode,e.devicePosition=l.addDeviceForm.devicePosition,e.customerVisibility=l.addDeviceForm.customerVisibility,e.oilBoxCapacity=t.oilBoxCapacity,e.oilBoxCapacityUnit=t.oilBoxCapacityUnit,e.oilBrandCode=t.oilBrandCode,e.oilBrand=t.oilBrandName,e.lubricationPointManufacturer=t.lubricationPointManufacturer,e.lubricationPointTypeCode=t.lubricationPointTypeCode,t.lubricationPointPicPath&&(e.lubricationPointPicPath=t.lubricationPointPicPath),e.lubricationPointType=t.lubricationPointType,e.oilType=l.oilTypeDevice,l.lupDeviceNameList.length>1&&"自定义"!=t.lubricationPointSelectName?e.lubricationPointName=t.lubricationPointSelectName:e.lubricationPointName=t.lubricationPointName,e.lubricationPointDesc=t.lubricationPointDesc,t.recommendOilCode&&(e.recommendOilCode=t.recommendOilCode),e.currentOilCode=t.currentOilCode,e.lubricationMethod=t.lubricationMethod,1==l.oilTypeDevice&&(0==l.showOrHideState&&(e.oilChangeMethod=t.oilChangeMethod,e.oilChangePeriod=t.oilChangePeriod,e.oilChangePeriodUnit=t.oilChangePeriodUnit,t.lastOilChangeDate&&(e.lastOilChangeDate=t.lastOilChangeDate,e.fillingQuantity=t.fillingQuantity,e.fillingQuantityUnit=t.fillingQuantityUnit),1==t.oilChangeMethod&&t.lastOilChangeDate&&t.oilChangePeriod&&"KM"!=t.oilChangePeriodUnit&&(e.autoCreateOilChangePlan=t.autoCreateOilChangePlan,t.nextScheduledOilChangeDate&&t.autoCreateOilChangePlan&&(e.nextScheduledOilChangeDate=t.nextScheduledOilChangeDate))),e.oilAddPeriod=t.oilAddPeriod,e.oilAddPeriodUnit=t.oilAddPeriodUnit,e.lastOilAddDate=t.lastOilAddDate,e.everyTimeOilAddQuantity=t.everyTimeOilAddQuantity,e.everyTimeOilAddQuantityUnit=t.everyTimeOilAddQuantityUnit,e.preMonthOilAddQuantity=t.preMonthOilAddQuantity,e.preMonthOilAddQuantityUnit=t.preMonthOilAddQuantityUnit,t.oilAddPeriod&&t.lastOilAddDate&&"KM"!=t.oilAddPeriodUnit&&(e.autoCreateOilAddPlan=t.autoCreateOilAddPlan,t.autoCreateOilAddPlan&&(e.nextScheduledOilAddDate=t.nextScheduledOilAddDate))),2==l.oilTypeDevice&&(e.oilAddPeriodUnit=t.oilAddPeriodUnit,e.oilAddPeriod=t.oilAddPeriod,e.everyTimeOilAddQuantity=t.everyTimeOilAddQuantity,e.everyTimeOilAddQuantityUnit=t.everyTimeOilAddQuantityUnit,e.lastOilAddDate=t.lastOilAddDate,e.preMonthOilAddQuantity=t.preMonthOilAddQuantity,e.preMonthOilAddQuantityUnit=t.preMonthOilAddQuantityUnit,t.lastOilAddDate&&t.oilAddPeriod&&"KM"!=t.oilAddPeriodUnit&&(e.autoCreateOilAddPlan=t.autoCreateOilAddPlan,""!=t.nextScheduledOilAddDate&&t.autoCreateOilAddPlan&&(e.nextScheduledOilAddDate=t.nextScheduledOilAddDate))),t.tableFromValueList.forEach(function(e){if(12==e.componentType||11==e.componentType){var t=function(t){console.log(t),e.componentList[t].forEach(function(e,i){e.row=t})};for(var i in e.componentList)t(i)}}),e.tableFromValueList=t.tableFromValueList,l.requestMethodPost("/web/device/addDeviceV2",e).then(function(e){1e3==(e=e.data).code?(l.$message({message:"添加成功",type:"success"}),e.data.tips&&2!=l.$userInfo.userType?(l.showSyncLubDialog=!0,l.tipsData=e.data.tips):l.$emit("addOrEditLup")):l.$message({message:e.msg,type:"warning"})}).catch(function(e){})}).catch(function(){})},lubricationPointSelectNameChange:function(e){e&&(this.addLumPointForm.lubricationPointSelectNameFlag="自定义"!=e)},submitEditDeviceAndLumpoint:function(e,t,i,o,a){var l=this;this.$confirm("确定提交修改设备?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",customClass:"deletBtn",type:"warning"}).then(function(){var e=[];t.tableFromValueList.forEach(function(e){if(12==e.componentType||11==e.componentType){var t=function(t){console.log(t),e.componentList[t].forEach(function(e,i){e.row=t})};for(var i in e.componentList)t(i)}});var i={deviceNumber:l.epInfo.deviceNumber,lubricationMethod:t.lubricationMethod,lubricationPointDesc:t.lubricationPointDesc,lubricationPointName:t.lubricationPointSelectNameFlag?t.lubricationPointSelectName:t.lubricationPointName,lubricationPointNumber:l.selectLubricationPointNumber,lubricationPointType:t.lubricationPointType,lubricationPointTypeCode:t.lubricationPointTypeCode,oilBoxCapacity:t.oilBoxCapacity,oilBoxCapacityUnit:t.oilBoxCapacityUnit,oilBrandCode:t.oilBrandCode,oilBrandName:t.oilBrandName,recommendOil:t.recommendOil,recommendOilCode:t.recommendOilCode,lubricationPointPicPath:t.lubricationPointPicPath,picDeleteFlag:t.delLubPicFlag||"",delFlag:t.delFlag||!1,currentOilCode:t.currentOilCode,lubricationPointManufacturer:t.lubricationPointManufacturer,tableFromValueList:t.tableFromValueList};i.lubricationPointPicPath&&"1"==i.picDeleteFlag&&(i.picDeleteFlag=0),i.oilChangeMethod=t.oilChangeMethod,i.oilChangePeriod=t.oilChangePeriod,i.oilChangePeriodUnit=t.oilChangePeriodUnit,i.lastOilChangeDate=t.lastOilChangeDate,i.fillingQuantity=t.fillingQuantity,i.fillingQuantityUnit=t.fillingQuantityUnit,i.autoCreateOilChangePlan=t.autoCreateOilChangePlan,i.nextScheduledOilChangeDate=t.nextScheduledOilChangeDate,i.oilAddPeriod=t.oilAddPeriod,i.oilAddPeriodUnit=t.oilAddPeriodUnit,i.lastOilAddDate=t.lastOilAddDate,i.everyTimeOilAddQuantity=t.everyTimeOilAddQuantity,i.everyTimeOilAddQuantityUnit=t.everyTimeOilAddQuantityUnit,i.preMonthOilAddQuantity=t.preMonthOilAddQuantity,i.preMonthOilAddQuantityUnit=t.preMonthOilAddQuantityUnit,i.autoCreateOilAddPlan=t.autoCreateOilAddPlan,i.nextScheduledOilAddDate=t.nextScheduledOilAddDate,i.oilAddPeriodUnit=t.oilAddPeriodUnit,i.oilAddPeriod=t.oilAddPeriod,i.everyTimeOilAddQuantity=t.everyTimeOilAddQuantity,i.everyTimeOilAddQuantityUnit=t.everyTimeOilAddQuantityUnit,i.preMonthOilAddQuantity=t.preMonthOilAddQuantity,i.preMonthOilAddQuantityUnit=t.preMonthOilAddQuantityUnit,i.oilType=l.oilTypeDevice,i.lastOilAddDate=t.lastOilAddDate,i.autoCreateOilAddPlan=t.autoCreateOilAddPlan,i.nextScheduledOilAddDate=t.nextScheduledOilAddDate,e.push(i);var o={deviceNumber:l.epInfo.deviceNumber,deviceName:l.addDeviceForm.deviceName,newBusinessFlag:l.addDeviceForm.newBusinessFlag,customerNumber:l.addDeviceForm.customerNumber,manufacturer:l.addDeviceForm.manufacturer||"",deviceModel:l.addDeviceForm.deviceModel||"",lubricationPointUpdateRequestList:e,deviceType:l.addDeviceForm.eptType[l.addDeviceForm.eptType.length-1],workshopId:l.addDeviceForm.workshopId,deviceCode:l.addDeviceForm.deviceCode,devicePosition:l.addDeviceForm.devicePosition,customerVisibility:l.addDeviceForm.customerVisibility};l.requestMethodPost("/web/device/updateDeviceAndLPBatch",o).then(function(e){1e3==(e=e.data).code?(l.$message({message:"修改成功",type:"success"}),l.$emit("editDeviceAndLumPoint")):l.$message({message:e.msg,type:"warning"})}).catch(function(e){})}).catch(function(){})},handleLastStep:function(){this.addLumPointForm.oilType=this.oilTypeDevice,this.$emit("lastNext",this.addLumPointForm,this.imageLubricationList,this.uploadUrl)},selectComponent:function(e,t,i){var o=[];i&&(e?(o=i.optionsDtos.filter(function(t){return e==t.value}),i.name=o[0].option):i.name=""),t&&(e?(o=t.optionsDtos.filter(function(t){return e==t.value}),t.name=o[0].option):t.name="")},eptTypeChange:function(e,t,i){var o=this;console.log(e,t);var a={lubPointName:"",status:1,current:1,size:100};a.deviceCode="devicetype"==i?e:e[e.length-1],this.requestMethodGet("/device/coreDeviceLubPoint/pageList",a).then(function(e){if(1e3==e.data.code){var i=e.data.data.list||[];i.length&&i.forEach(function(e){e.isCustomFlag=!1});if(i.push({lubPointName:"自定义",isCustomFlag:!0}),i.length>1&&!t&&o.$set(o.addLumPointForm,"lubricationPointSelectName",""),t){var a=[];i.forEach(function(e){a.push(e.lubPointName)}),a.includes(o.addLumPointForm.lubricationPointName)?(o.$set(o.addLumPointForm,"lubricationPointSelectName",o.addLumPointForm.lubricationPointName),o.$nextTick(function(){o.$refs.lupRuleForm.validateField(["lubricationPointSelectName"])})):(o.$set(o.addLumPointForm,"lubricationPointSelectName","自定义"),o.$nextTick(function(){o.$refs.lupRuleForm.validateField(["lubricationPointName"])}))}o.lupDeviceNameList=i}else o.$message({message:e.data.msg,type:"error"})})},getFullImg:function(e,t){var i=this,o={url:t};this.requestMethodGet("/web/file/getFullUrl",o).then(function(t){1e3==t.data.code?i.$set(e,"imgFullDtoUrl",[{url:t.data.data}]):i.$message({message:t.data.msg,type:"warning"})})},$_getLubricationPointDetail:function(){var e=this;console.log(1222333);var t,i={lubricationPointNumber:this.selectLubricationPointNumber};this.requestMethodGet("/web/device/queryLubricationPointDetail",i).then((t=c()(r.a.mark(function t(i){var o,a,l;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(1e3!=(i=i.data).code){t.next=27;break}if(o=i.data,m()(e.addLumPointForm).forEach(function(t){e.addLumPointForm[t]=o[t]}),console.log(e.addLumPointForm),0==e.addLumPointForm.deviceWorkComponentList.length?e.getDeviceOperationMsg(e.addLumPointForm.lubricationPointTypeCode):(console.log(1122333),e.addLumPointForm.deviceWorkComponentList.forEach(function(t){if(12==t.componentType)for(var i in t.componentList)t.componentList[i].forEach(function(t){"8"==t.componentType&&(t.value?e.getFullImg(t,t.value):e.$set(t,"imgFullDtoUrl",[]))})}),e.fields=e.addLumPointForm.deviceWorkComponentList),console.log(e.fields),e.imageLubricationList=[],!e.addLumPointForm.currentOilCode){t.next=15;break}return t.next=11,e.getOilNameByOilCode(e.addLumPointForm.currentOilCode);case 11:a=t.sent,console.log(a,"在用油品名称",{oilAlias:a,code:e.addLumPointForm.currentOilCode}),e.oilList.push({oilAlias:a,code:e.addLumPointForm.currentOilCode}),console.log(e.oilList);case 15:if(!e.addLumPointForm.recommendOilCode){t.next=22;break}return t.next=18,e.getOilNameByOilCode(e.addLumPointForm.recommendOilCode);case 18:l=t.sent,console.log(l,"推荐油品名称",{oilAlias:l,code:e.addLumPointForm.recommendOilCode}),e.oilList.push({oilAlias:l,code:e.addLumPointForm.recommendOilCode}),console.log(e.oilList);case 22:e.addLumPointForm.lubricationPointPicPath?(e.$set(e.addLumPointForm,"lubricationPointPicPath",e.addLumPointForm.lubricationPointPicRelativePath),e.getFullpath(e.addLumPointForm.lubricationPointPicRelativePath)):e.addLumPointForm.imgLubricationFile="",e.oilTypeDevice=e.addLumPointForm.oilType,e.addLumPointForm.lubricationPointName?(e.eptTypeChange(e.addDeviceForm.eptType,"editLumPoint"),e.$set(e.addLumPointForm,"lubricationPointSelectName",e.addLumPointForm.lubricationPointName)):e.eptTypeChange(e.addDeviceForm.eptType),t.next=28;break;case 27:e.$message({message:i.msg,type:"warning"});case 28:case"end":return t.stop()}},t,e)})),function(e){return t.apply(this,arguments)})).catch(function(e){})},getFullpath:function(e){var t=this,i={url:e};this.requestMethodGet("/web/file/getFullUrl",i).then(function(e){1e3==(e=e.data).code?(t.$set(t.addLumPointForm,"lubricationPointPicRelativePath",e.data),t.imageLubricationList.push({url:e.data})):t.$message({type:"warning",message:"获取全路径失败，请稍后重试。"})}).catch(function(e){})},$_queryLPData:function(){var e=this;this.requestMethodGet("/web/customer/getIndustryTreeList",{parentCode:"lubrication_point_type"}).then(function(t){1e3==(t=t.data).code?t.data&&t.data.length>0&&(e.lubricationPointTypeList=t.data):e.$message({message:t.msg,type:"warning"})}).catch(function(e){})},getOilData:function(e,t){var i=this;this.loadingRemote=!0,this.requestMethodGet("/mdm/oil/queryOilListByPage",{oilName:e,code:t,status:1,size:200,current:1}).then(function(e){1e3==e.data.code?(i.loadingRemote=!1,i.oilList=e.data.data.list,i.$nextTick(function(){i.addDeviceForm.newBusinessFlag||i.$refs.lupRuleForm.clearValidate("currentOilCode")})):i.$message({message:e.data.msg,type:"error"})})},oilNameChange:function(e){if(e){var t=this.oilList.filter(function(t){return t.code==e});this.addLumPointForm.oilBrandCode=t[0].parentCode,this.addLumPointForm.oilBrandName=t[0].parentName,this.addLumPointForm.currentOilCode=e}},handleAddLubricatePointFile:function(e,t){var i=this;if(!e.raw.type.startsWith("image"))return this.imageLubricationList=[],void this.$message.error("只能上传图片类型文件");if(!(e.size/1024/1024<10))return this.imageLubricationList=[],void this.$message.error("上传图片大小不能超过 10MB!");var o=new FormData;o.append("fileType","lubrication_point"),o.append("multipartFiles",e.raw),this.requestMethodPost("/web/file/uploadFiles",o).then(function(t){if(1e3==(t=t.data).code){var o=t.data[0];i.getFullImgPath(o,e),i.addLumPointForm.lubricationPointPicPath=t.data[0]}else i.$message({message:t.msg,type:"warning"})}).catch(function(e){})},getFullImgPath:function(e,t){var i=this,o={url:e};this.requestMethodGet("/web/file/getFullUrl",o).then(function(o){1e3==o.data.code?(i.imageLubricationList.push({url:o.data.data,submitImgUrl:e}),i.hideUpload=i.imageLubricationList.length>=1,i.addLumPointForm.id?i.addLumPointForm.imgLubricationFile=e:i.addLumPointForm.imgLubricationFile=t.raw):i.$message({message:o.data.msg,type:"warning"})})},handleLubricatePointRemove:function(e,t){var i=this;this.addLumPointForm.imgLubricationFile="",this.addLumPointForm.lubricationPointPicPath="",this.addLumPointForm.lubricationPointPicRelativePath="",this.addLumPointForm.delLubPicFlag=1,this.imageLubricationList=[],setTimeout(function(){i.hideUpload=t.length>=1},500)},$_queryOilChangePeriodData:function(){var e=this;this.requestMethodGet("/web/device/getOilChangePeriodUnitConfig").then(function(t){if(1e3==(t=t.data).code){if(t.data&&t.data.length>0){var i=t.data;i=i.map(function(e){return{oilChangePeriodUnit:e.oilChangePeriodUnit,oilChangePeriodUnitDesc:e.oilChangePeriodUnitDesc}}),e.oilChangePeriodList=i}}else e.$message({message:t.msg,type:"warning"})}).catch(function(e){})},isPositiveInteger:function(e){return/^[1-9]\d*$/.test(e)},dateChange:function(e){var t=this,i=void 0,o=void 0,a=void 0;if("lastOilAddDate2"==e||"lastOilAddDate"==e?(i=this.addLumPointForm.oilAddPeriod,o=this.addLumPointForm.oilAddPeriodUnit,a=this.addLumPointForm.lastOilAddDate):(i=this.addLumPointForm.oilChangePeriod,o=this.addLumPointForm.oilChangePeriodUnit,a=this.addLumPointForm.lastOilChangeDate),"KM"!=o&&this.isPositiveInteger(i)&&i&&o&&a){var l={oilChangePeriod:i,oilChangePeriodUnit:o,oilLastTime:a};this.requestMethodGet("/web/service/ps/plusChangeOilDate",l).then(function(i){1e3==i.data.code?"lastOilAddDate2"==e?t.addLumPointForm.nextScheduledOilAddDate=i.data.data:"lastOilAddDate"==e?t.addLumPointForm.nextScheduledOilAddDate=i.data.data:t.addLumPointForm.nextScheduledOilChangeDate=i.data.data:t.$message({message:i.msg,type:"warning"})})}},handleLubricationPointTypeChange:function(e){var t;t=this.lubricationPointTypeList.filter(function(t){return t.code===e}),this.addLumPointForm.lubricationPointTypeCode=t[0].code,this.addLumPointForm.lubricationPointType=t[0].name,console.log(e),this.getDeviceModel(e)},getDeviceModel:function(e){var t=this;this.requestMethodGet("/device/workComponent/selectDeviceWorkListBylubPoint",{lubricationPointType:e,lubricationPointNumber:"addDeviceAndLubpoint"!=this.deviceTypeDialog&&"addLumPoint"!=this.deviceTypeDialog?this.selectLubricationPointNumber:""}).then(function(i){1e3==i.data.code&&(console.log(i.data),i.data.data.length>0?(i.data.data.forEach(function(e){if(12==e.componentType)for(var i in e.componentList)e.componentList[i].forEach(function(e){"8"==e.componentType&&(e.value?t.getFullImg(e,e.value):t.$set(e,"imgFullDtoUrl",[]))})}),t.fields=i.data.data):t.getDeviceOperationMsg(e),console.log(t.fields))})},getDeviceOperationMsg:function(e,t){var i=this;this.requestMethodGet("/device/workComponent/list",{lubricationPointType:e}).then(function(e){1e3==e.data.code&&(console.log(e.data),"addPic"==t?i.picAddCont=e.data.data.filter(function(e){return"12"==e.componentType}):(i.fields=e.data.data,i.fields.forEach(function(e){e.componentId=e.id,e.id="",e.componentList.length>0?(e.componentList.forEach(function(e){e.componentId=e.id,e.id="",i.$set(e,"imgFullDtoUrl",[])}),12==e.componentType?e.componentList={}:e.componentList={1:e.componentList}):e.componentList={}}),console.log(i.fields)))})},lubricationPointNameBlur:function(){var e=this;this.$refs.deviceRuleForm.validateField(["eptType"],function(t){t&&(e.$message({message:"请先选择设备类型",type:"warning"}),e.addLumPointForm.lubricationPointName="")})},getDeviceType:function(e){var t;t=this.lubricationPointTypeData.filter(function(t){return t.code===e}),this.oilTypeDevice=t[0].oilType,2==this.oilTypeDevice?(this.addLumPointForm.oilBoxCapacityUnit="KG",this.addLumPointForm.everyTimeOilAddQuantityUnit="KG",this.addLumPointForm.preMonthOilAddQuantityUnit="KG",this.addLumPointForm.oilChangeMethod="",this.addLumPointForm.oilChangePeriod="",this.addLumPointForm.oilChangePeriodUnit="",this.addLumPointForm.lastOilChangeDate="",this.addLumPointForm.autoCreateOilChangePlan="",this.addLumPointForm.fillingQuantity="",this.addLumPointForm.nextScheduledOilChangeDate=""):(this.addLumPointForm.oilBoxCapacityUnit="L",this.addLumPointForm.everyTimeOilAddQuantityUnit="L",this.addLumPointForm.preMonthOilAddQuantityUnit="L",this.addLumPointForm.oilChangeMethod=2,this.addLumPointForm.autoCreateOilChangePlan=!1,this.addLumPointForm.fillingQuantityUnit="L","lubrication_point_type_0004"==this.addLumPointForm.lubricationPointTypeCode&&(this.addLumPointForm.oilChangeMethod=1))},handlelubricationMethodChange:function(e){this.getDeviceType(e)},$_queryLubricationMethodData:function(){var e=this;this.requestMethodGet("/web/device/getLubricationMethodByType").then(function(t){1e3==(t=t.data).code?e.lubricationPointTypeData=t.data:e.$message({message:t.msg,type:"warning"})}).catch(function(e){})}},computed:{showOrHideState:function(){var e=this.addLumPointForm,t=e.lubricationPointTypeCode,i=e.lubricationMethod;return"lubrication_method_0004"==i||"lubrication_method_0003"==i&&"lubrication_point_type_0011"==t?1:"lubrication_method_0001"==i||"lubrication_method_0002"==i||"lubrication_method_0008"==i||"lubrication_method_0003"==i&&"lubrication_point_type_0011"!=t?0:"lubrication_method_0005"==i||"lubrication_method_0006"==i||"lubrication_method_0007"==i||"lubrication_method_0009"==i?2:null}}},y=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"add-lumpoint"},[i("el-dialog",{attrs:{title:"addDeviceAndLubpoint"!=e.deviceTypeDialog&&"addLumPoint"!=e.deviceTypeDialog?"编辑润滑点":"创建润滑点",visible:e.addLubricationPointDialog,width:"40%","close-on-click-modal":!1,"before-close":e.cancelAddLumpoint},on:{"update:visible":function(t){e.addLubricationPointDialog=t}}},[i("div",{staticStyle:{padding:"10px 20px 0",height:"630px",overflow:"auto"}},[i("el-form",{ref:"lupRuleForm",staticClass:"demo-addLumPointForm",attrs:{model:e.addLumPointForm,rules:e.rules,"label-width":"160px","label-position":"top"}},[i("div",[i("div",{staticClass:"info detail-other-info"},[i("div",{staticClass:"info-title"},[i("div",{staticClass:"line"}),e._v(" "),i("div",{staticClass:"title"},[e._v("基础信息")])]),e._v(" "),i("el-row",{staticStyle:{padding:"20px"},attrs:{gutter:24}},[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"润滑点设备名称",prop:"自定义"==e.addLumPointForm.lubricationPointSelectName||1==e.lupDeviceNameList.length||0==e.lupDeviceNameList.length?"lubricationPointName":"lubricationPointSelectName"}},[e.lupDeviceNameList.length>1?i("div",{staticStyle:{display:"flex"}},[i("el-select",{style:{width:"自定义"==e.addLumPointForm.lubricationPointSelectName?"30%":"100%",marginRight:"自定义"==e.addLumPointForm.lubricationPointSelectName?"5px":""},attrs:{placeholder:"请选择润滑点设备名称",size:"small"},on:{change:e.lubricationPointSelectNameChange},model:{value:e.addLumPointForm.lubricationPointSelectName,callback:function(t){e.$set(e.addLumPointForm,"lubricationPointSelectName",t)},expression:"addLumPointForm.lubricationPointSelectName"}},e._l(e.lupDeviceNameList,function(e){return i("el-option",{key:e.id,style:{color:"自定义"==e.lubPointName?"blue":"#606266"},attrs:{label:e.lubPointName,value:e.lubPointName}})}),1),e._v(" "),"自定义"==e.addLumPointForm.lubricationPointSelectName?i("el-input",{style:{width:"自定义"==e.addLumPointForm.lubricationPointSelectName?"70%":"80%"},attrs:{size:"small",maxlength:"50",clearable:"",placeholder:"请输入"},on:{blur:e.lubricationPointNameBlur},model:{value:e.addLumPointForm.lubricationPointName,callback:function(t){e.$set(e.addLumPointForm,"lubricationPointName",t)},expression:"addLumPointForm.lubricationPointName"}}):e._e()],1):i("div",[i("el-input",{staticStyle:{width:"100%"},attrs:{size:"small",maxlength:"50",clearable:"",placeholder:"请输入"},on:{blur:e.lubricationPointNameBlur},model:{value:e.addLumPointForm.lubricationPointName,callback:function(t){e.$set(e.addLumPointForm,"lubricationPointName",t)},expression:"addLumPointForm.lubricationPointName"}})],1)])],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"润滑点设备类型",prop:"lubricationPointTypeCode"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("\n                                    润滑点设备类型\n                                    "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"",placement:"top-start"}},[i("div",{staticStyle:{"max-width":"400px","line-height":"18px"},attrs:{slot:"content"},slot:"content"},[e._v("\n                                            1. 蒸汽轮机、燃气轮机、造纸机类型仅对应其循环系统 "),i("br"),e._v("\n                                            2. 商用车对应的润滑点设备类型选择如下： 发动机请选择“发动机”，变速箱/差速器/终传动/轮边减速器请选择“闭式齿轮”，轮毂轴承/其它回转设备滚动轴承请选择“滚动轴承”，刹车系统/液压系统请选择“液压系统”，开式齿轮请选择“开式齿轮”，冷却系统/销轴请选择“其它”\n                                        ")]),e._v(" "),i("el-button",{staticStyle:{color:"#333","font-size":"15px",padding:"0px"},attrs:{type:"text"}},[i("i",{staticClass:"el-icon-warning-outline"})])],1)],1),e._v(" "),i("el-select",{staticStyle:{width:"100%"},attrs:{disabled:"report"==e.resource||"task"==e.resource,placeholder:"请选择",size:"small"},on:{change:e.handleLubricationPointTypeChange},model:{value:e.addLumPointForm.lubricationPointTypeCode,callback:function(t){e.$set(e.addLumPointForm,"lubricationPointTypeCode",t)},expression:"addLumPointForm.lubricationPointTypeCode"}},e._l(e.lubricationPointTypeList,function(e){return i("el-option",{key:e.code,attrs:{label:e.name,value:e.code,clearable:""}})}),1)],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"润滑⽅式",prop:"lubricationMethod"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",clearable:"",disabled:"task"==e.resource,placeholder:"请选择"},on:{change:e.handlelubricationMethodChange},model:{value:e.addLumPointForm.lubricationMethod,callback:function(t){e.$set(e.addLumPointForm,"lubricationMethod",t)},expression:"addLumPointForm.lubricationMethod"}},e._l(e.lubricationPointTypeData,function(e){return i("el-option",{key:e.code,attrs:{label:e.name,value:e.code}})}),1)],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"在用油品名称",prop:e.addDeviceForm.newBusinessFlag?"":"currentOilCode"}},[i("el-select",{ref:"cascaderRef",staticStyle:{width:"100%"},attrs:{size:"small",placeholder:"试试搜索：油品名称",clearable:"",filterable:"",remote:"",loading:e.loadingRemote,"remote-method":e.getOilData},on:{focus:function(t){return e.getOilData("")},change:e.oilNameChange},model:{value:e.addLumPointForm.currentOilCode,callback:function(t){e.$set(e.addLumPointForm,"currentOilCode",t)},expression:"addLumPointForm.currentOilCode"}},[e._l(e.oilList,function(e){return i("el-option",{key:e.code,attrs:{label:e.oilAlias,value:e.code}})}),e._v(" "),i("template",{slot:"empty"},[e.loadingRemote?i("div",{staticStyle:{"text-align":"center",padding:"5px",color:"grey"}},[e._v("\n                                            加载中\n                                        ")]):i("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center",padding:"5px 0px"}},[e._v("\n                                            暂无匹配数据"),i("el-link",{staticStyle:{"margin-left":"10px",color:"#409eff"},on:{click:function(t){return e.createOil("oilName")}}},[e._v("去添加")])],1)])],2)],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",[i("el-col",{staticStyle:{padding:"0"},attrs:{span:15}},[i("el-form-item",{attrs:{prop:"oilBoxCapacity",label:"油箱容量",rules:[{required:1==e.oilTypeDevice&&!e.addDeviceForm.newBusinessFlag,message:"请输入油箱容量",trigger:"blur"},{pattern:/^(([1-9]\d*)|([0-9]\d*.\d?[1-9]{1,2}))$/,message:"数值不能为0,且小数点后最多三位小数",trigger:"blur"}]}},[i("el-input",{attrs:{size:"small",maxlength:"10",placeholder:"请输入",clearable:""},model:{value:e.addLumPointForm.oilBoxCapacity,callback:function(t){e.$set(e.addLumPointForm,"oilBoxCapacity",t)},expression:"addLumPointForm.oilBoxCapacity"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:"oilBoxCapacityUnit",rules:[{required:1==e.oilTypeDevice&&!e.addDeviceForm.newBusinessFlag,message:"请选择油箱容量单位",trigger:"change"}]}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},model:{value:e.addLumPointForm.oilBoxCapacityUnit,callback:function(t){e.$set(e.addLumPointForm,"oilBoxCapacityUnit",t)},expression:"addLumPointForm.oilBoxCapacityUnit"}},e._l(e.oilBoxCapacityList,function(e){return i("el-option",{key:e.oilBoxCapacityUnit,attrs:{label:e.oilBoxCapacityUnitDesc,value:e.oilBoxCapacityUnit}})}),1)],1)],1)],1)],1)],1)],1),e._v(" "),i("div",{staticClass:"info detail-other-info",staticStyle:{"margin-top":"20px"}},[i("div",{staticClass:"info-title"},[i("div",{staticClass:"line"}),e._v(" "),i("div",{staticClass:"title"},[e._v("润滑参考信息")])]),e._v(" "),0==e.showOrHideState?i("div",{staticStyle:{padding:"20px 20px 0 20px"}},[i("el-row",{attrs:{gutter:24}},[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"定期或按质换油",prop:e.addDeviceForm.newBusinessFlag?"":"oilChangeMethod"}},[i("el-radio-group",{model:{value:e.addLumPointForm.oilChangeMethod,callback:function(t){e.$set(e.addLumPointForm,"oilChangeMethod",t)},expression:"addLumPointForm.oilChangeMethod"}},[i("el-radio",{attrs:{label:1}},[e._v("定期")]),e._v(" "),i("el-radio",{attrs:{label:2}},[e._v("按质")])],1)],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",[i("el-col",{staticStyle:{padding:"0"},attrs:{span:15}},[i("el-form-item",{attrs:{prop:e.addDeviceForm.newBusinessFlag?"":"oilChangePeriod",label:"换油周期",rules:[{validator:e.validatePeriodVal(this.addLumPointForm),trigger:"blur"},{required:!e.addDeviceForm.newBusinessFlag,message:"请输入换油周期",trigger:"blur"},{pattern:/^[0-9]*[1-9][0-9]*$/,message:"请输入正整数",trigger:"blur"}]}},[i("el-input",{staticClass:"input-with-select",attrs:{size:"small",maxlength:"10",placeholder:"请输入",clearable:""},on:{change:function(t){return e.dateChange("lastOilChangeDate")}},model:{value:e.addLumPointForm.oilChangePeriod,callback:function(t){e.$set(e.addLumPointForm,"oilChangePeriod",t)},expression:"addLumPointForm.oilChangePeriod"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:e.addDeviceForm.newBusinessFlag?"":"oilChangePeriodUnit"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},on:{change:function(t){return e.dateChange("lastOilChangeDate")}},model:{value:e.addLumPointForm.oilChangePeriodUnit,callback:function(t){e.$set(e.addLumPointForm,"oilChangePeriodUnit",t)},expression:"addLumPointForm.oilChangePeriodUnit"}},e._l(e.oilChangePeriodList,function(e){return i("el-option",{key:e.oilChangePeriodUnit,attrs:{label:e.oilChangePeriodUnitDesc,value:e.oilChangePeriodUnit}})}),1)],1)],1)],1)],1)],1)],1):e._e(),e._v(" "),1==e.showOrHideState||2==e.oilTypeDevice?i("div",{staticStyle:{padding:"20px 20px 0 20px"}},[i("el-row",{attrs:{gutter:24}},[i("el-col",{attrs:{span:12}},[i("el-form-item",[i("el-col",{staticStyle:{padding:"0"},attrs:{span:15}},[i("el-form-item",{attrs:{prop:"preMonthOilAddQuantity",label:"每月润滑剂添加量",rules:[{pattern:/^(([1-9]\d*)|([0-9]\d*.\d?[1-9]{1,2}))$/,message:"数值不能为0,且小数点后最多三位小数",trigger:"blur"},{required:!e.addDeviceForm.newBusinessFlag,message:"请输入每月润滑剂添加量",trigger:"blur"}]}},[i("el-input",{staticClass:"input-with-select",attrs:{size:"small",maxlength:"6",placeholder:"请输入",clearable:""},model:{value:e.addLumPointForm.preMonthOilAddQuantity,callback:function(t){e.$set(e.addLumPointForm,"preMonthOilAddQuantity",t)},expression:"addLumPointForm.preMonthOilAddQuantity"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:e.addDeviceForm.newBusinessFlag?"":"preMonthOilAddQuantityUnit"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},model:{value:e.addLumPointForm.preMonthOilAddQuantityUnit,callback:function(t){e.$set(e.addLumPointForm,"preMonthOilAddQuantityUnit",t)},expression:"addLumPointForm.preMonthOilAddQuantityUnit"}},e._l(e.oilBoxCapacityList,function(e){return i("el-option",{key:e.oilBoxCapacityUnit,attrs:{label:e.oilBoxCapacityUnitDesc,value:e.oilBoxCapacityUnit}})}),1)],1)],1)],1)],1)],1)],1):e._e(),e._v(" "),0!=e.showOrHideState?i("div",{staticStyle:{"margin-top":"20px"}}):e._e(),e._v(" "),i("div",{staticStyle:{padding:"0px 20px 0 20px"}},[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:12}},[i("el-form-item",[i("div",{staticClass:"label-title",staticStyle:{"margin-bottom":"15px"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("润滑点图片")]),i("span",{staticStyle:{color:"#999"},attrs:{slot:"label"},slot:"label"},[e._v("（支持.png.jpg.svn.gif图片格式）")])]),e._v(" "),i("el-upload",{class:{hide:e.hideUpload||e.imageLubricationList.length>0},attrs:{action:e.uploadUrl,"list-type":"picture-card",limit:"1","file-list":e.imageLubricationList,accept:"image/*","auto-upload":!1,"on-change":e.handleAddLubricatePointFile,"on-remove":e.handleLubricatePointRemove}},[i("i",{staticClass:"el-icon-plus"})])],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"润滑点描述"}},[i("el-input",{staticStyle:{width:"100%"},attrs:{size:"small",type:"textarea",rows:6,maxlength:"200",placeholder:"请输入","show-word-limit":""},model:{value:e.addLumPointForm.lubricationPointDesc,callback:function(t){e.$set(e.addLumPointForm,"lubricationPointDesc",t)},expression:"addLumPointForm.lubricationPointDesc"}})],1)],1)],1),e._v(" "),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"设备制造商推荐油品",prop:"recommendOilCode"}},[i("el-select",{ref:"deviceRef",staticStyle:{width:"100%"},attrs:{size:"small",placeholder:"试试搜索：油品名称",clearable:"",filterable:"",remote:"",loading:e.loadingRemote,"remote-method":e.getOilData},on:{focus:function(t){return e.getOilData("")},change:e.selectRecommendOilName},model:{value:e.addLumPointForm.recommendOilCode,callback:function(t){e.$set(e.addLumPointForm,"recommendOilCode",t)},expression:"addLumPointForm.recommendOilCode"}},[e._l(e.oilList,function(e){return i("el-option",{key:e.code,attrs:{label:e.oilAlias,value:e.code}})}),e._v(" "),i("template",{slot:"empty"},[e.loadingRemote?i("div",{staticStyle:{"text-align":"center",padding:"5px",color:"grey"}},[e._v("\n                                            加载中\n                                        ")]):i("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center",padding:"5px 0px"}},[e._v("\n                                            暂无匹配数据"),i("el-link",{staticStyle:{"margin-left":"10px",color:"#409eff"},on:{click:function(t){return e.createOil("currentName")}}},[e._v("去添加")])],1)])],2)],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"润滑点设备制造商名称",prop:"lubricationPointManufacturer"}},[i("el-input",{staticStyle:{width:"100%"},attrs:{size:"small",maxlength:"50",clearable:"",placeholder:"请输入"},model:{value:e.addLumPointForm.lubricationPointManufacturer,callback:function(t){e.$set(e.addLumPointForm,"lubricationPointManufacturer",t)},expression:"addLumPointForm.lubricationPointManufacturer"}})],1)],1)],1),e._v(" "),i("el-row",{attrs:{gutter:20}},[0==e.showOrHideState?i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"上次换油⽇期",prop:"lastOilChangeDate"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",size:"small","picker-options":e.expireTimeOption,"value-format":"yyyy-MM-dd",placeholder:"选择日期"},on:{change:function(t){return e.dateChange("lastOilChangeDate")}},model:{value:e.addLumPointForm.lastOilChangeDate,callback:function(t){e.$set(e.addLumPointForm,"lastOilChangeDate",t)},expression:"addLumPointForm.lastOilChangeDate"}})],1)],1):e._e(),e._v(" "),0==e.showOrHideState&&e.addLumPointForm.lastOilChangeDate?i("el-col",{attrs:{span:12}},[i("el-form-item",[i("el-col",{staticStyle:{padding:"0"},attrs:{span:15}},[i("el-form-item",{attrs:{prop:"fillingQuantity",label:"上次换油时加注量",rules:[{pattern:/^(([1-9]\d*)|([0-9]\d*.\d?[1-9]{1,2}))$/,message:"数值不能为0,且小数点后最多三位小数",trigger:"blur"}]}},[i("el-input",{staticClass:"input-with-select",attrs:{size:"small",maxlength:"6",placeholder:"请输入",clearable:""},model:{value:e.addLumPointForm.fillingQuantity,callback:function(t){e.$set(e.addLumPointForm,"fillingQuantity",t)},expression:"addLumPointForm.fillingQuantity"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:"fillingQuantityUnit"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},model:{value:e.addLumPointForm.fillingQuantityUnit,callback:function(t){e.$set(e.addLumPointForm,"fillingQuantityUnit",t)},expression:"addLumPointForm.fillingQuantityUnit"}},e._l(e.oilBoxCapacityList,function(e){return i("el-option",{key:e.oilBoxCapacityUnit,attrs:{label:e.oilBoxCapacityUnitDesc,value:e.oilBoxCapacityUnit}})}),1)],1)],1)],1)],1):e._e()],1),e._v(" "),i("el-row",{attrs:{gutter:20}},[0==e.showOrHideState&&1==e.addLumPointForm.oilChangeMethod&&e.addLumPointForm.lastOilChangeDate&&e.addLumPointForm.oilChangePeriod&&"KM"!=e.addLumPointForm.oilChangePeriodUnit?i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"是否自动生成换油任务？"}},[i("el-radio-group",{model:{value:e.addLumPointForm.autoCreateOilChangePlan,callback:function(t){e.$set(e.addLumPointForm,"autoCreateOilChangePlan",t)},expression:"addLumPointForm.autoCreateOilChangePlan"}},[i("el-radio",{attrs:{label:!0}},[e._v("是")]),e._v(" "),i("el-radio",{attrs:{label:!1}},[e._v("否")])],1)],1)],1):e._e(),e._v(" "),0==e.showOrHideState&&1==e.addLumPointForm.oilChangeMethod&&e.addLumPointForm.autoCreateOilChangePlan&&e.addLumPointForm.lastOilChangeDate&&e.addLumPointForm.oilChangePeriod&&"KM"!=e.addLumPointForm.oilChangePeriodUnit?i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"预计下次换油日期",prop:"nextScheduledOilChangeDate"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",size:"small","picker-options":e.pickerBeginDateBefore,"value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:e.addLumPointForm.nextScheduledOilChangeDate,callback:function(t){e.$set(e.addLumPointForm,"nextScheduledOilChangeDate",t)},expression:"addLumPointForm.nextScheduledOilChangeDate"}})],1)],1):e._e()],1),e._v(" "),i("el-row",{attrs:{gutter:20}},[1==e.oilTypeDevice&&1!=e.showOrHideState?i("el-col",{attrs:{span:12}},[i("el-form-item",[i("el-col",{staticStyle:{padding:"0"},attrs:{span:15}},[i("el-form-item",{attrs:{prop:e.addDeviceForm.newBusinessFlag?"":"preMonthOilAddQuantity",label:"每月润滑剂添加量",rules:[{pattern:/^(([1-9]\d*)|([0-9]\d*.\d?[1-9]{1,2}))$/,message:"数值不能为0,且小数点后最多三位小数",trigger:"blur"}]}},[i("el-input",{staticClass:"input-with-select",attrs:{size:"small",maxlength:"6",placeholder:"请输入",clearable:""},model:{value:e.addLumPointForm.preMonthOilAddQuantity,callback:function(t){e.$set(e.addLumPointForm,"preMonthOilAddQuantity",t)},expression:"addLumPointForm.preMonthOilAddQuantity"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:e.addDeviceForm.newBusinessFlag?"":"preMonthOilAddQuantityUnit"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},model:{value:e.addLumPointForm.preMonthOilAddQuantityUnit,callback:function(t){e.$set(e.addLumPointForm,"preMonthOilAddQuantityUnit",t)},expression:"addLumPointForm.preMonthOilAddQuantityUnit"}},e._l(e.oilBoxCapacityList,function(e){return i("el-option",{key:e.oilBoxCapacityUnit,attrs:{label:e.oilBoxCapacityUnitDesc,value:e.oilBoxCapacityUnit}})}),1)],1)],1)],1)],1):e._e(),e._v(" "),1==e.oilTypeDevice?i("el-col",{attrs:{span:12}},[i("el-form-item",[i("el-col",{staticStyle:{padding:"0"},attrs:{span:15}},[i("el-form-item",{attrs:{prop:"everyTimeOilAddQuantity",label:"每次加油量",rules:[{pattern:/^(([1-9]\d*)|([0-9]\d*.\d?[1-9]{1,2}))$/,message:"数值不能为0,且小数点后最多三位小数",trigger:"blur"}]}},[i("el-input",{staticClass:"input-with-select",attrs:{size:"small",maxlength:"6",placeholder:"请输入",clearable:""},model:{value:e.addLumPointForm.everyTimeOilAddQuantity,callback:function(t){e.$set(e.addLumPointForm,"everyTimeOilAddQuantity",t)},expression:"addLumPointForm.everyTimeOilAddQuantity"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:"everyTimeOilAddQuantityUnit"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},model:{value:e.addLumPointForm.everyTimeOilAddQuantityUnit,callback:function(t){e.$set(e.addLumPointForm,"everyTimeOilAddQuantityUnit",t)},expression:"addLumPointForm.everyTimeOilAddQuantityUnit"}},e._l(e.oilBoxCapacityList,function(e){return i("el-option",{key:e.oilBoxCapacityUnit,attrs:{label:e.oilBoxCapacityUnitDesc,value:e.oilBoxCapacityUnit}})}),1)],1)],1)],1)],1):e._e()],1),e._v(" "),1==e.oilTypeDevice?i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:12}},[i("el-form-item",[i("el-col",{staticStyle:{padding:"0"},attrs:{span:15}},[i("el-form-item",{attrs:{prop:"oilAddPeriod",label:"加油周期",rules:[{pattern:/^[0-9]*[1-9][0-9]*$/,message:"请输入正整数",trigger:"blur"}]}},[i("el-input",{staticClass:"input-with-select",attrs:{size:"small",maxlength:"10",placeholder:"请输入",clearable:""},on:{change:function(t){return e.dateChange("lastOilAddDate")}},model:{value:e.addLumPointForm.oilAddPeriod,callback:function(t){e.$set(e.addLumPointForm,"oilAddPeriod",t)},expression:"addLumPointForm.oilAddPeriod"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:"oilAddPeriodUnit"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},on:{change:function(t){return e.dateChange("lastOilAddDate")}},model:{value:e.addLumPointForm.oilAddPeriodUnit,callback:function(t){e.$set(e.addLumPointForm,"oilAddPeriodUnit",t)},expression:"addLumPointForm.oilAddPeriodUnit"}},e._l(e.oilChangePeriodList,function(e){return i("el-option",{key:e.oilChangePeriodUnit,attrs:{label:e.oilChangePeriodUnitDesc,value:e.oilChangePeriodUnit}})}),1)],1)],1)],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"上次加油⽇期",prop:"lastOilAddDate"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",size:"small","picker-options":e.expireTimeOption,"value-format":"yyyy-MM-dd",placeholder:"选择日期"},on:{change:function(t){return e.dateChange("lastOilAddDate")}},model:{value:e.addLumPointForm.lastOilAddDate,callback:function(t){e.$set(e.addLumPointForm,"lastOilAddDate",t)},expression:"addLumPointForm.lastOilAddDate"}})],1)],1)],1):e._e(),e._v(" "),1==e.oilTypeDevice?i("el-row",{attrs:{gutter:20}},[e.addLumPointForm.oilAddPeriod&&e.addLumPointForm.lastOilAddDate&&"KM"!=e.addLumPointForm.oilAddPeriodUnit?i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"是否自动生成加油任务"}},[i("el-radio-group",{model:{value:e.addLumPointForm.autoCreateOilAddPlan,callback:function(t){e.$set(e.addLumPointForm,"autoCreateOilAddPlan",t)},expression:"addLumPointForm.autoCreateOilAddPlan"}},[i("el-radio",{attrs:{label:!0}},[e._v("是")]),e._v(" "),i("el-radio",{attrs:{label:!1}},[e._v("否")])],1)],1)],1):e._e(),e._v(" "),1==e.oilTypeDevice&&e.addLumPointForm.autoCreateOilAddPlan&&e.addLumPointForm.lastOilAddDate&&e.addLumPointForm.oilAddPeriod&&"KM"!=e.addLumPointForm.oilAddPeriodUnit?i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"预计下次加油日期"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date","picker-options":e.pickerBeginDateBefore,size:"small","value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:e.addLumPointForm.nextScheduledOilAddDate,callback:function(t){e.$set(e.addLumPointForm,"nextScheduledOilAddDate",t)},expression:"addLumPointForm.nextScheduledOilAddDate"}})],1)],1):e._e()],1):e._e(),e._v(" "),2==e.oilTypeDevice?i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:12}},[i("el-form-item",[i("el-col",{staticStyle:{padding:"0"},attrs:{span:15}},[i("el-form-item",{attrs:{prop:"everyTimeOilAddQuantity",label:"每次加脂量",rules:[{pattern:/^(([1-9]\d*)|([0-9]\d*.\d?[1-9]{1,2}))$/,message:"数值不能为0,且小数点后最多三位小数",trigger:"blur"}]}},[i("el-input",{staticClass:"input-with-select",attrs:{size:"small",maxlength:"6",placeholder:"请输入",clearable:""},model:{value:e.addLumPointForm.everyTimeOilAddQuantity,callback:function(t){e.$set(e.addLumPointForm,"everyTimeOilAddQuantity",t)},expression:"addLumPointForm.everyTimeOilAddQuantity"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:"everyTimeOilAddQuantityUnit"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},model:{value:e.addLumPointForm.everyTimeOilAddQuantityUnit,callback:function(t){e.$set(e.addLumPointForm,"everyTimeOilAddQuantityUnit",t)},expression:"addLumPointForm.everyTimeOilAddQuantityUnit"}},e._l(e.oilBoxCapacityList,function(e){return i("el-option",{key:e.oilBoxCapacityUnit,attrs:{label:e.oilBoxCapacityUnitDesc,value:e.oilBoxCapacityUnit}})}),1)],1)],1)],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",[i("el-col",{staticStyle:{padding:"0"},attrs:{span:15}},[i("el-form-item",{attrs:{prop:"oilAddPeriod",label:"加脂周期",rules:[{pattern:/^[0-9]*[1-9][0-9]*$/,message:"请输入正整数",trigger:"blur"}]}},[i("el-input",{staticClass:"input-with-select",attrs:{size:"small",maxlength:"10",placeholder:"请输入",clearable:""},on:{change:function(t){return e.dateChange("lastOilAddDate2")}},model:{value:e.addLumPointForm.oilAddPeriod,callback:function(t){e.$set(e.addLumPointForm,"oilAddPeriod",t)},expression:"addLumPointForm.oilAddPeriod"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:"oilAddPeriodUnit"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},on:{change:function(t){return e.dateChange("lastOilAddDate2")}},model:{value:e.addLumPointForm.oilAddPeriodUnit,callback:function(t){e.$set(e.addLumPointForm,"oilAddPeriodUnit",t)},expression:"addLumPointForm.oilAddPeriodUnit"}},e._l(e.oilChangePeriodList,function(e){return i("el-option",{key:e.oilChangePeriodUnit,attrs:{label:e.oilChangePeriodUnitDesc,value:e.oilChangePeriodUnit}})}),1)],1)],1)],1)],1)],1):e._e(),e._v(" "),2==e.oilTypeDevice?i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"上次加脂⽇期",prop:"lastOilAddDate"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",size:"small","picker-options":e.expireTimeOption,"value-format":"yyyy-MM-dd",placeholder:"选择日期"},on:{change:function(t){return e.dateChange("lastOilAddDate2")}},model:{value:e.addLumPointForm.lastOilAddDate,callback:function(t){e.$set(e.addLumPointForm,"lastOilAddDate",t)},expression:"addLumPointForm.lastOilAddDate"}})],1)],1),e._v(" "),e.addLumPointForm.lastOilAddDate&&e.addLumPointForm.oilAddPeriod&&"KM"!=e.addLumPointForm.oilAddPeriodUnit?i("el-col",{staticStyle:{height:"96px"},attrs:{span:12}},[i("el-form-item",{attrs:{label:"是否自动生成加脂任务？"}},[i("el-radio-group",{model:{value:e.addLumPointForm.autoCreateOilAddPlan,callback:function(t){e.$set(e.addLumPointForm,"autoCreateOilAddPlan",t)},expression:"addLumPointForm.autoCreateOilAddPlan"}},[i("el-radio",{attrs:{label:!0}},[e._v("是")]),e._v(" "),i("el-radio",{attrs:{label:!1}},[e._v("否")])],1)],1)],1):e._e(),e._v(" "),i("el-col",{attrs:{span:12}},[e.addLumPointForm.autoCreateOilAddPlan&&"KM"!=e.addLumPointForm.oilAddPeriodUnit?i("el-form-item",{attrs:{label:"预计下次加脂日期"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date","picker-options":e.pickerBeginDateBefore,size:"small","value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:e.addLumPointForm.nextScheduledOilAddDate,callback:function(t){e.$set(e.addLumPointForm,"nextScheduledOilAddDate",t)},expression:"addLumPointForm.nextScheduledOilAddDate"}})],1):e._e()],1)],1):e._e(),e._v(" "),i("el-row",{attrs:{gutter:20}}),e._v(" "),i("el-row",{attrs:{gutter:20}})],1)]),e._v(" "),e.fields.length>0?i("div",{staticClass:"info detail-other-info",staticStyle:{"margin-top":"20px"}},[i("div",{staticClass:"info-title"},[i("div",{staticClass:"line"}),e._v(" "),i("div",{staticClass:"title"},[e._v("设备运行信息")])]),e._v(" "),i("el-row",{staticStyle:{padding:"20px"},attrs:{gutter:24}},e._l(e.fields,function(t,o){return i("div",{key:o},[i("el-col",{attrs:{span:12}},["1"==t.componentType?i("el-form-item",{attrs:{prop:t.prop,label:t.title}},[i("el-input",{staticClass:"input-with-select",attrs:{type:"1"==t.style?"textarea":"",size:"small",maxlength:t.lengthMax,placeholder:"请输入",clearable:""},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"item.value"}})],1):e._e()],1),e._v(" "),i("el-col",{attrs:{span:12}},["5"==t.componentType?i("el-form-item",{attrs:{prop:t.prop,label:t.title}},[i("el-date-picker",{staticClass:"input-with-select",staticStyle:{width:"100%"},attrs:{type:"month","value-format":"yyyy-MM",size:"small",placeholder:"请选择"},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"item.value"}})],1):e._e()],1),e._v(" "),i("el-col",{attrs:{span:12}},["2"==t.componentType?i("el-form-item",{attrs:{prop:t.prop,label:t.title}},[i("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",clearable:""},on:{change:function(i){return e.selectComponent(i,t)}},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"item.value"}},e._l(t.optionsDtos,function(e){return i("el-option",{key:e.value,attrs:{label:e.option,value:e.value}})}),1)],1):e._e()],1),e._v(" "),"11"==t.componentType?i("el-col",{attrs:{span:12}},[i("el-form-item",e._l(t.componentList[1],function(o,a){return i("span",{key:a},[1==o.componentType?i("el-col",{staticStyle:{padding:"0"},attrs:{span:15}},[i("el-form-item",{attrs:{label:t.title}},[i("el-input",{attrs:{size:"small",maxlength:o.lengthMax,placeholder:"请输入",clearable:""},model:{value:o.value,callback:function(t){e.$set(o,"value",t)},expression:"itemChild.value"}})],1)],1):e._e(),e._v(" "),2==o.componentType?i("el-col",{attrs:{span:9}},[i("el-form-item",[i("span",{staticStyle:{opacity:"0"},attrs:{slot:"label"},slot:"label"},[e._v("111")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},on:{change:function(t){return e.selectComponent(t,o)}},model:{value:o.value,callback:function(t){e.$set(o,"value",t)},expression:"itemChild.value"}},e._l(o.optionsDtos,function(e){return i("el-option",{key:e.value,attrs:{label:e.option,value:e.value}})}),1)],1)],1):e._e()],1)}),0)],1):e._e(),e._v(" "),i("el-col",{attrs:{span:12}},["textarea"==t.type?i("el-form-item",{attrs:{prop:t.prop,label:t.label}},[i("el-input",{staticStyle:{width:"100%"},attrs:{size:"small",type:"textarea",rows:6,maxlength:t.length,placeholder:"请输入","show-word-limit":""},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"item.value"}})],1):e._e()],1),e._v(" "),12==t.componentType?i("el-col",{staticStyle:{padding:"0px 0"},attrs:{span:24}},[e.isObjectEmpty(t.componentList)?e._e():i("div",e._l(t.componentList,function(o,a,l){return i("div",{key:a},[e._l(o,function(t,o){return i("div",{key:o},[8==t.componentType?i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"设备工况图片1（最多上传1张图片）"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("设备工况图片"+e._s(l+1)+"（最多上传1张图片）")]),e._v(" "),i("el-upload",{class:{isShowUploadBtn:t.imgFullDtoUrl.length>=1||e.notShowUploadBtn},attrs:{action:e.uploadUrl,accept:"image/*","list-type":"picture-card",limit:"1","auto-upload":!1,disabled:!0,"file-list":t.imgFullDtoUrl},scopedSlots:e._u([{key:"file",fn:function(o){var a=o.file;return i("div",{},[i("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{src:a.url,alt:""}}),e._v(" "),i("span",{staticClass:"el-upload-list__item-actions uploadMask",staticStyle:{"padding-top":"12px"}},[i("span",{staticClass:"el-upload-list__item-preview"},[i("i",{staticClass:"el-icon-zoom-in",on:{click:function(i){return i.target!==i.currentTarget?null:e.handlePictureCardPreview(a,t)}}})]),e._v(" "),i("span",{staticClass:"el-upload-list__item-preview"},[i("i",{staticClass:"el-icon-crop",on:{click:function(i){return i.target!==i.currentTarget?null:e.handlePicturePrune(a,t)}}})]),e._v(" "),e.disabled?e._e():i("span",{staticClass:"el-upload-list__item-delete"},[i("i",{staticClass:"el-icon-delete",on:{click:function(i){return i.target!==i.currentTarget?null:e.handleRemove(a,t)}}})])])])}}],null,!0)},[i("div",{staticStyle:{width:"114px",height:"114px"},on:{click:function(i){return e.handlePictureUpload(t)}}},[i("i",{staticClass:"el-icon-plus"})])])],1)],1):e._e(),e._v(" "),1==t.componentType?i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"图片1描述"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("图片"+e._s(l+1)+"描述")]),e._v(" "),i("el-input",{staticClass:"input-with-select",attrs:{type:"1"==t.style?"textarea":"",size:"small",maxlength:t.lengthMax,placeholder:"请输入",clearable:""},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"itemChild.value"}})],1)],1):e._e()],1)}),e._v(" "),i("el-col",{attrs:{span:24}},[i("div",{staticStyle:{color:"#dd0000",cursor:"pointer","margin-bottom":"10px","margin-top":"-5px"},on:{click:function(i){return e.deletePicture(t,a)}}},[e._v("删除")])])],2)}),0),e._v(" "),i("el-col",{staticStyle:{padding:"20px 0"},attrs:{span:24}},[i("el-button",{attrs:{size:"small"},on:{click:function(i){return e.addPicture(t)}}},[e._v(e._s(t.title))])],1)],1):e._e()],1)}),0)],1):e._e()])])],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},["addDeviceAndLubpoint"==e.deviceTypeDialog?i("div",[i("el-button",{staticStyle:{color:"#999"},attrs:{size:"small"},on:{click:function(t){return e.handleDirectCreationDevice("lupRuleForm")}}},[e._v("跳过，暂不创建润滑点")]),e._v(" "),i("el-button",{attrs:{type:"danger",plain:"",size:"small"},on:{click:function(t){return e.handleLastStep("lupRuleForm")}}},[e._v("上一步")]),e._v(" "),i("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){return e.handleSubmit("lupRuleForm","addDeviceAndLubpoint")}}},[e._v("确定")])],1):e._e(),e._v(" "),"editLumPoint"==e.deviceTypeDialog?i("div",[i("el-button",{staticStyle:{color:"#999"},attrs:{size:"small"},on:{click:function(t){return e.cancelEditLubpoint("lupRuleForm")}}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){return e.handleSubmit("lupRuleForm","editLumPoint")}}},[e._v("确定")])],1):e._e(),e._v(" "),"addLumPoint"==e.deviceTypeDialog?i("div",[i("el-button",{staticStyle:{color:"#999"},attrs:{size:"small"},on:{click:function(t){return e.cancelEditLubpoint("lupRuleForm")}}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){return e.handleSubmit("lupRuleForm","addLumPoint")}}},[e._v("确定")])],1):e._e(),e._v(" "),"editDeviceAndLumPoint"==e.deviceTypeDialog?i("div",[i("el-button",{staticStyle:{color:"#999"},attrs:{size:"small"},on:{click:function(t){return e.handleLastStep("lupRuleForm")}}},[e._v("上一步")]),e._v(" "),i("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){return e.handleSubmit("lupRuleForm","editDeviceAndLumPoint")}}},[e._v("确定")])],1):e._e()])]),e._v(" "),i("SyncLub",{attrs:{dialogFlag:e.showSyncLubDialog,tipsData:e.tipsData},on:{closeSyncLubDialog:e.closeSyncLubDialog}}),e._v(" "),i("AddOil",{ref:"LupDialogRef",attrs:{addOilDialog:e.addOilDialog,addType:e.addType,addOilForm:e.addOilForm},on:{addOrEditOil:e.addOrEditOil,closeDialogAdd:e.closeDialogAdd}}),e._v(" "),i("el-dialog",{attrs:{visible:e.imgDialogVisible,"append-to-body":""},on:{"update:visible":function(t){e.imgDialogVisible=t}}},[i("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})]),e._v(" "),i("img-cutter",{ref:"imgCutterModal",attrs:{label:"选择本地图片",crossOrigin:!0,isModal:!0,crossOriginHeader:e.anonymous,sizeChange:!1,toolBgc:"none",lockScroll:!0,boxWidth:800,boxHeight:450,cutWidth:e.cutWidth,cutHeight:e.cutHeight,toolBoxOverflow:!1},on:{cutDown:function(t){return e.cutDown(t,e.item)}}},[i("div",{attrs:{slot:"open"},slot:"open"}),e._v(" "),i("div",{attrs:{slot:"choose"},slot:"choose"})])],1)};y._withStripped=!0;var b={render:y,staticRenderFns:[]},F=b;var P=!1;var C=i("VU/8")(f,F,!1,function(e){P||i("gLOB")},"data-v-e75c10fc",null);C.options.__file="src/components/equipment/components/CreateLubricationPoint.vue";t.a=C.exports},"A+fv":function(e,t){},Csjt:function(e,t,i){"use strict";var o={props:{dialogFlag:{type:Boolean,default:function(){return!1}},tipsData:{type:Object,default:function(){return{}}}},watch:{},data:function(){return{}},created:function(){},methods:{closeSyncLubDialog:function(){this.$emit("closeSyncLubDialog")}}},a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-dialog",{attrs:{title:"温馨提示",visible:e.dialogFlag,width:"40%","close-on-click-modal":!1,"before-close":e.closeSyncLubDialog},on:{"update:visible":function(t){e.dialogFlag=t}}},[i("div",{staticStyle:{padding:"0 20px",color:"rgb(153, 153, 153)","line-height":"20px","margin-top":"20px","font-size":"16px"}},[e._v("设备类型（"+e._s(e.tipsData.deviceType)+"）通常有多个润滑点，可参考以下信息补充：")]),e._v(" "),e.tipsData.mainLubPoints?i("div",{staticStyle:{padding:"0 20px","line-height":"20px",margin:"10px 0 20px 0","font-size":"16px"}},[e._v(e._s(e.tipsData.mainLubPoints.join("，")))]):e._e(),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"danger",size:"small"},on:{click:e.closeSyncLubDialog}},[e._v("我知道了")])],1)])],1)};a._withStripped=!0;var l={render:a,staticRenderFns:[]},r=l;var n=!1;var s=i("VU/8")(o,r,!1,function(e){n||i("VJ0O")},"data-v-1952937e",null);s.options.__file="src/components/equipment/components/syncLubDialog.vue";t.a=s.exports},DpoM:function(e,t,i){"use strict";var o=i("woOf"),a=i.n(o),l=i("l/JR"),r={props:{addOilDialog:{type:Boolean,default:function(){return!1}},addType:{type:String,default:""},addOilForm:{type:Object,default:function(){return{}}},oilBrandList:{type:Array,default:function(){return[]}}},data:function(){return{oilBrandListAdd:[],brandError:!1,nameError:!1,noticeError:"",noticeErrorBrand:"",addOilForm:{oilBrand:"",oilName:""},checkOilName:!1,addOilRules:{oilBrand:[{required:!0,message:"请选择油品品牌",trigger:"change"}],oilBrandName:[{required:!0,message:"请输入",trigger:"blur"}],oilName:[{required:!0,message:"请输入油品名称",trigger:"blur"}]}}},created:function(){this.getOilBrandData()},methods:{getOilBrandData:function(){var e=this;this.requestMethodGet("/mdm/oil/queryOilList",{parentCode:0,status:1}).then(function(t){if(1e3==t.data.code){var i=t.data.data,o=[];0!==i.length&&(o=i.filter(function(e){return"oil_0001"!==e.code})),e.oilBrandListAdd=o,e.oilBrandListAdd.push({name:"自定义",code:"0"})}else e.$message({message:t.data.msg,type:"error"})})},checkedOil:function(e,t,i){var o=this,a=void 0;if(a=i?e:e.target.value){var r={productName:a};"brand"==t?r.parentNumber=0:"name"==t&&(r.parentNumber=this.addOilForm.oilBrand),Object(l.a)(),this.requestMethodPost("mdm/oil/checkOilName",r).then(function(e){1e3==e.data.code?"brand"==t?(o.brandError=!1,o.noticeErrorBrand=""):"name"==t&&(o.checkOilName=!0,o.nameError=!1,o.noticeError=""):4217==e.data.code?(o.brandError=!0,o.noticeErrorBrand=e.data.msg):4216==e.data.code?(o.checkOilName=!0,o.nameError=!0,o.noticeError=e.data.msg):o.$message({message:e.data.msg,type:"error"})})}},selectOilBrandAdd:function(){this.noticeError="",this.noticeErrorBrand="",this.$set(this.addOilForm,"oilBrandName",""),this.$set(this.addOilForm,"oilName","")},changeOil:function(e){e||(this.noticeError="")},cancelAddOil:function(){a()(this.$data.addOilForm,this.$options.data().addOilForm),this.$emit("closeDialogAdd")},completeAddOil:function(e){var t=this;this.$refs[e].validate(function(e){if(e){if(console.log(t.checkOilName),t.checkOilName||t.checkedOil(t.addOilForm.oilName,"name","type"),t.brandError||t.nameError)return!1;t.$emit("addOrEditOil",t.addOilForm)}})}},computed:{}},n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-dialog",{attrs:{title:"手动添加油品",visible:e.addOilDialog,width:"30%","close-on-click-modal":!1,"before-close":e.cancelAddOil},on:{"update:visible":function(t){e.addOilDialog=t}}},[i("el-form",{ref:"addOilRef",staticClass:"demo-ruleForm",attrs:{model:e.addOilForm,rules:e.addOilRules,"label-width":"100px","label-position":"left"}},[i("el-form-item",{staticClass:"filterConditionType",attrs:{prop:"oilBrand",label:"油品品牌"}},[i("el-select",{staticStyle:{width:"60%"},attrs:{size:"small",clearable:""},on:{change:e.selectOilBrandAdd},model:{value:e.addOilForm.oilBrand,callback:function(t){e.$set(e.addOilForm,"oilBrand",t)},expression:"addOilForm.oilBrand"}},e._l(e.oilBrandListAdd,function(e){return i("el-option",{key:e.code,attrs:{label:e.name,value:e.code}})}),1)],1),e._v(" "),"0"==e.addOilForm.oilBrand?i("el-form-item",{staticClass:"filterConditionType",attrs:{prop:"oilBrandName",label:""}},[i("el-input",{staticStyle:{width:"60%"},attrs:{size:"small",clearable:"",maxlength:"25",placeholder:"请输入油品品牌"},on:{blur:function(t){return e.checkedOil(t,"brand")}},model:{value:e.addOilForm.oilBrandName,callback:function(t){e.$set(e.addOilForm,"oilBrandName",t)},expression:"addOilForm.oilBrandName"}}),e._v(" "),e.brandError&&e.addOilForm.oilBrandName?i("div",{staticStyle:{color:"#ff0000"}},[e._v(e._s(e.noticeErrorBrand))]):e._e()],1):e._e(),e._v(" "),i("el-form-item",{staticClass:"filterConditionType",attrs:{prop:"oilName",label:"油品名称"}},[i("el-input",{staticStyle:{width:"60%"},attrs:{size:"small",clearable:"",maxlength:"25"},on:{blur:function(t){return e.checkedOil(t,"name")},change:e.changeOil},model:{value:e.addOilForm.oilName,callback:function(t){e.$set(e.addOilForm,"oilName",t)},expression:"addOilForm.oilName"}}),e._v(" "),e.nameError&&e.addOilForm.oilName?i("div",{staticStyle:{color:"#ff0000"}},[e._v(e._s(e.noticeError))]):e._e()],1)],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){return e.cancelAddOil("addOilRef")}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){return e.completeAddOil("addOilRef")}}},[e._v("完 成")])],1)],1)],1)};n._withStripped=!0;var s={render:n,staticRenderFns:[]},d=s;var c=!1;var u=i("VU/8")(r,d,!1,function(e){c||i("isYw")},"data-v-00d751e9",null);u.options.__file="src/components/equipment/components/addOil.vue";t.a=u.exports},VJ0O:function(e,t){},VSfC:function(e,t){},gLOB:function(e,t){},gcxd:function(e,t){},isYw:function(e,t){},lLtC:function(e,t){},lnRy:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i("Xxa5"),a=i.n(o),l=i("exGp"),r=i.n(l),n=i("Dd8w"),s=i.n(n),d=i("bOdI"),c=i.n(d),u=i("//Fk"),m=i.n(u),h=i("woOf"),p=i.n(h),g=i("DpoM"),v={components:{AddOil:g.a},props:{dialogFlag:{type:Boolean,default:function(){return!1}},ruleForm:{type:Object,default:function(){return{}}},imageLubricationList:{type:Array,default:function(){return[]}},lubricationPointTypeList:{type:Array,default:function(){return[]}},oilBrandList:{type:Array,default:function(){return[]}},oilChangePeriodList:{type:Array,default:function(){return[]}},oilBoxCapacityList:{type:Array,default:function(){return[]}},oilList:{type:Array,default:function(){return[]}},recommendOilCodeKey:{type:Number,default:function(){return 1}},lupDeviceNameList:{type:Array,default:function(){return[]}}},watch:{dialogFlag:function(e,t){e&&this.getOilList("")}},data:function(){var e=this;return{validatePeriodVal:function(e){var t=e.oilChangePeriodUnit;return function(e,i,o){return i?parseInt(i)<0?o(new Error("请输入大于0的周期")):"Y"==t&&i>20?o(new Error("请输入小于20年的周期")):"M"==t&&i>240?o(new Error("请输入小于240月的周期")):"D"==t&&i>7300?(console.log("this ======",i>7300),o(new Error("请输入小于7300天的周期"))):"H"==t&&i>175200?o(new Error("请输入小于175200小时的周期")):o():o(new Error("请输入换油周期"))}},loadingRemote:!1,hideUpload:!1,addOilDialog:!1,oilBrandListAdd:[],oilTypeListAdd:[],addOilForm:{oilBrand:"",oilType:"",oilName:""},addOilRules:{oilBrand:[{required:!0,message:"请选择油品品牌",trigger:"change"}],oilBrandName:[{required:!0,message:"请输入",trigger:"blur"}],oilName:[{required:!0,message:"请输入油品名称",trigger:"blur"}],oilTypeName:[{required:!0,message:"请输入",trigger:"blur"}],oilType:[{required:!0,message:"请选择油品类型",trigger:"change"}]},useOilKey:0,selectOil:"",expireTimeOption:{disabledDate:function(e){return e.getTime()>Date.now()}},pickerBeginDateBefore:{disabledDate:function(e){return e.getTime()<Date.now()}},lubricationPointTypeData:[],rules:{lubricationPointTypeCode:[{required:!0,message:"请选择润滑点设备类型",trigger:"change"}],lubricationPointName:[{required:!0,message:"请输入润滑点设备名称",trigger:"change"}],lubricationMethod:[{required:!0,message:"请选择润滑方式",trigger:"change"}],oilBrandCode:[{required:!0,message:"请选择在用油品牌",trigger:"change"}],currentOilCode:[{required:!0,message:"请选择在用油品名称",trigger:"change"}],oilChangePeriod:[{required:!0,message:"请输入换油周期",trigger:"change"}],oilChangePeriodUnit:[{required:!0,validator:function(t,i,o){var a="lubrication_point_type_0007"==e.ruleForm.lubricationPointTypeCode?"加脂":"换油";e.ruleForm.oilChangePeriodUnit?o():o(new Error("请选择"+a+"周期单位"))},trigger:"change"}],lubricationPointSelectName:[{required:!0,message:"请选择润滑点设备名称",trigger:"change"}]}}},created:function(){this.getOilBrandData()},methods:{dateChange:function(e){var t=this,i=void 0,o=void 0,a=void 0;if("lastOilAddDate2"==e||"lastOilAddDate"==e?(i=this.ruleForm.oilAddPeriod,o=this.ruleForm.oilAddPeriodUnit,a=this.ruleForm.lastOilAddDate):(i=this.ruleForm.oilChangePeriod,o=this.ruleForm.oilChangePeriodUnit,a=this.ruleForm.lastOilChangeDate),i&&o&&a){var l={oilChangePeriod:i,oilChangePeriodUnit:o,oilLastTime:a};this.requestMethodGet("/web/service/ps/plusChangeOilDate",l).then(function(i){1e3==i.data.code?"lastOilAddDate2"==e?t.ruleForm.nextScheduledOilAddDate=i.data.data:"lastOilAddDate"==e?t.ruleForm.nextScheduledOilAddDate=i.data.data:t.ruleForm.nextScheduledOilChangeDate=i.data.data:t.$message({message:i.msg,type:"warning"})})}},addOrEditOil:function(e){var t=this,i={oilBrand:e.oilBrand,oilName:e.oilName,customerCompanyNumber:JSON.parse(this.Decrypt(sessionStorage.getItem("userInfo"))).companyNumber};"0"==e.oilBrand&&(i.oilBrand="",i.customCode="1",i.oilBrandName=e.oilBrandName),this.requestMethodPost("mdm/oil/addOil",i).then(function(i){1e3==i.data.code?("0"==e.oilBrand?(t.getOilBrandData(),t.getQueryOilList("oilBrandList","add",i.data.data.oilBrandNumber),"oilName"==t.addType&&(t.ruleForm.oilBrandCode=i.data.data.oilBrandNumber)):t.ruleForm.oilBrandCode=e.oilBrand,"oilName"==t.addType?(t.getOilList(""),t.$set(t.ruleForm,"currentOilCode",i.data.data.oilNameNumber)):(t.getOilList(""),t.$set(t.ruleForm,"recommendOilCode",i.data.data.oilNameNumber)),t.addOilDialog=!1):t.$message({message:i.data.msg,type:"error"})})},closeDialogAdd:function(){p()(this.$data.addOilForm,this.$options.data().addOilForm),this.addOilDialog=!1},getOilBrandData:function(){var e=this;this.requestMethodGet("/mdm/oil/queryOilList",{status:1,parentCode:0}).then(function(t){if(1e3==t.data.code){var i=t.data.data,o=[];0!==i.length&&(i.forEach(function(e){e.text=e.name}),o=i.filter(function(e){return"oil_0001"!==e.code})),e.oilBrandListAdd=o,e.oilBrandListAdd.push({name:"自定义",code:"0"})}else e.$message({message:t.data.msg,type:"error"})})},selectOilBrandAdd:function(e){this.$set(this.addOilForm,"oilType",""),this.$set(this.addOilForm,"oilBrandName",""),this.$set(this.addOilForm,"oilTypeName",""),this.$set(this.addOilForm,"oilName","")},selectOilTypeAdd:function(){this.$set(this.addOilForm,"oilTypeName",""),this.$set(this.addOilForm,"oilName","")},createOil:function(e){this.addType=e,"currentName"==e&&(this.$set(this.addOilForm,"oilBrand",""),this.$set(this.addOilForm,"oilBrandName","")),this.$set(this.addOilForm,"oilBrand",""),this.$set(this.addOilForm,"oilBrandName",""),this.$set(this.addOilForm,"oilType",""),this.$set(this.addOilForm,"oilName",""),this.$set(this.addOilForm,"oilTypeName",""),this.addOilDialog=!0},cancelAddOil:function(){this.addOilDialog=!1,p()(this.$data.addOilForm,this.$options.data().addOilForm)},getQueryOilList:function(e,t,i){var o=this;this.requestMethodGet("/mdm/oil/queryOilList",{parentCode:0,status:1}).then(function(a){if(1e3==(a=a.data).code){if(a.data&&a.data.length>0){var l=a.data;switch(l=l.map(function(e){return{value:e.code,label:e.name}}),e){case"oilBrandList":o.oilBrandList=l;break;case"oilTypeListAdd":o.oilTypeListAdd=l;break;case"oilSeriesListAdd":o.oilSeriesListAdd=l}}"add"==t&&"oilName"==o.addType&&o.$nextTick(function(){o.ruleForm.oilBrandCode=i})}else o.$message({message:a.msg,type:"warning"})}).catch(function(e){})},completeAddOil:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;var i={oilBrand:t.addOilForm.oilBrand,oilName:t.addOilForm.oilName,customerCompanyNumber:JSON.parse(t.Decrypt(sessionStorage.getItem("userInfo"))).companyNumber};"0"==t.addOilForm.oilBrand&&(i.oilBrand="",i.customCode="1",i.oilBrandName=t.addOilForm.oilBrandName),t.requestMethodPost("mdm/oil/addOil",i).then(function(e){if(1e3==e.data.code)"0"==t.addOilForm.oilBrand?(t.getOilBrandData(),t.getQueryOilList("oilBrandList","add",e.data.data.oilBrandNumber),"oilName"==t.addType&&(t.ruleForm.oilBrandCode=e.data.data.oilBrandNumber)):t.ruleForm.oilBrandCode=t.addOilForm.oilBrand,"oilName"==t.addType?t.getRecommendOilList(t.ruleForm.oilBrandCode,"addType",e.data.data.oilNameNumber):(t.getOilList(""),t.ruleForm.recommendOilCode=e.data.data.oilNameNumber),t.addOilDialog=!1;else if(4216==e.data.code){var i="请直接搜索或下拉查询此油品：“"+e.data.msg+"”";t.$confirm(i,"该油品已存在",{confirmButtonText:"确定",showCancelButton:!1,type:"warning"}).then(function(){}).catch(function(){})}else if(4217==e.data.code){var o="请直接搜索或下拉查询此油品：“"+e.data.msg+"”";t.$confirm(o,"该油品品牌已存在",{confirmButtonText:"确定",showCancelButton:!1,type:"warning"}).then(function(){}).catch(function(){})}else if(4218==e.data.code){var a="请直接搜索或下拉查询此油品：“"+e.data.msg+"”";t.$confirm(a,"该油品类型已存在",{confirmButtonText:"确定",showCancelButton:!1,type:"warning"}).then(function(){}).catch(function(){})}else t.$message({message:e.data.msg,type:"error"})})})},getOilList:function(e){var t=this;this.loadingRemote=!0,this.requestMethodGet("/mdm/oil/queryOilListByPage",{oilName:e,status:1,size:200,current:1}).then(function(e){1e3==e.data.code?(t.loadingRemote=!1,t.oilList=e.data.data.list):t.$message({message:e.data.msg,type:"error"})})},formatData:function(e){for(var t=0;t<e.length;t++)e[t].children&&0!=e[t].children.length?this.formatData(e[t].children):e[t].children=null;return e},selectRecommendOilName:function(e){++this.recommendOilCodeKey,e&&(this.ruleForm.recommendOilCode=e)},handleLubricationPointTypeChange:function(e){if(e){var t;t=this.lubricationPointTypeList.filter(function(t){return t.code===e}),this.ruleForm.lubricationPointTypeCode=t[0].code,this.ruleForm.lubricationPointType=t[0].name,this.ruleForm.lubricationMethod="",this.$_queryLubricationMethodData(this.ruleForm.lubricationPointTypeCode)}else this.ruleForm.lubricationPointTypeCode="",this.ruleForm.lubricationPointType=""},getDeviceType:function(e){var t;t=this.lubricationPointTypeData.filter(function(t){return t.code===e}),this.ruleForm.oilTypeDevice=t[0].oilType,2==this.ruleForm.oilTypeDevice?(this.ruleForm.oilBoxCapacityUnit="KG",this.ruleForm.everyTimeOilAddQuantityUnit="KG",this.ruleForm.preMonthOilAddQuantityUnit="KG",this.ruleForm.oilChangeMethod="",this.ruleForm.oilChangePeriod="",this.ruleForm.oilChangePeriodUnit="",this.ruleForm.lastOilChangeDate="",this.ruleForm.autoCreateOilChangePlan="",this.ruleForm.fillingQuantity="",this.ruleForm.fillingQuantityUnit="",this.ruleForm.nextScheduledOilChangeDate=""):(this.ruleForm.oilBoxCapacityUnit="L",this.ruleForm.everyTimeOilAddQuantityUnit="L",this.ruleForm.preMonthOilAddQuantityUnit="L",this.ruleForm.oilChangeMethod=2,this.ruleForm.autoCreateOilChangePlan=!1,"lubrication_point_type_0004"==this.ruleForm.lubricationPointTypeCode&&(this.ruleForm.oilChangeMethod=1))},handlelubricationMethodChange:function(e){this.getDeviceType(e)},$_queryLubricationMethodData:function(e){var t=this,i={typeCode:e};this.requestMethodGet("/web/device/getLubricationMethodByType",i).then(function(e){1e3==(e=e.data).code?(t.lubricationPointTypeData=e.data,1==t.lubricationPointTypeData.length?(t.ruleForm.lubricationMethod=t.lubricationPointTypeData[0].code,t.ruleForm.oilTypeDevice=t.lubricationPointTypeData[0].oilType,2!=t.ruleForm.oilTypeDevice?(t.ruleForm.oilBoxCapacityUnit="L",t.ruleForm.everyTimeOilAddQuantityUnit="L",t.ruleForm.preMonthOilAddQuantityUnit="L",t.ruleForm.autoCreateOilChangePlan=!1,"lubrication_point_type_0004"==t.ruleForm.lubricationPointTypeCode?t.ruleForm.oilChangeMethod=1:t.ruleForm.oilChangeMethod=2):(t.ruleForm.oilBoxCapacityUnit="KG",t.ruleForm.everyTimeOilAddQuantityUnit="KG",t.ruleForm.preMonthOilAddQuantityUnit="KG",t.ruleForm.oilChangePeriod="",t.ruleForm.oilChangePeriodUnit="",t.ruleForm.lastOilChangeDate="",t.ruleForm.autoCreateOilChangePlan="",t.ruleForm.fillingQuantity="",t.ruleForm.fillingQuantityUnit="",t.ruleForm.nextScheduledOilChangeDate="")):(t.ruleForm.lubricationMethod="",2==t.ruleForm.oilTypeDevice&&(t.ruleForm.oilTypeDevice=1,t.ruleForm.oilBoxCapacityUnit="L",t.ruleForm.everyTimeOilAddQuantityUnit="L",t.ruleForm.preMonthOilAddQuantityUnit="L"))):t.$message({message:e.msg,type:"warning"})}).catch(function(e){})},oilNameChange:function(e){if(console.log("oilNameChange",e),e){var t=this.oilList.filter(function(t){return t.code==e});this.ruleForm.oilBrandCode=t[0].parentCode,this.ruleForm.currentOilCode=e}},handleAddLubricatePointFile:function(e,t){var i=this;if(!e.raw.type.startsWith("image"))return this.imageLubricationList=[],void this.$message.error("只能上传图片类型文件");if(!(e.size/1024/1024<10))return this.imageLubricationList=[],void this.$message.error("上传图片大小不能超过 10MB!");var o=new FormData;o.append("fileType","lubrication_point"),o.append("multipartFiles",e.raw),this.requestMethodPost("/web/file/uploadFiles",o).then(function(t){if(1e3==(t=t.data).code){var o=t.data[0];i.ruleForm.lubricationPointPicPath=t.data[0],i.getFullImgPath(o,e)}else i.$message({message:t.msg,type:"warning"})}).catch(function(e){})},getFullImgPath:function(e,t){var i=this,o={url:e};this.requestMethodGet("/web/file/getFullUrl",o).then(function(o){1e3==o.data.code?(i.imageLubricationList.push({url:o.data.data,submitImgUrl:e}),i.hideUpload=i.imageLubricationList.length>=1,i.ruleForm.id?i.ruleForm.imgLubricationFile=e:i.ruleForm.imgLubricationFile=t.raw):i.$message({message:o.data.msg,type:"warning"})})},handleLubricatePointRemove:function(e,t){var i=this;this.ruleForm.imgLubricationFile="",this.imageLubricationList=[],setTimeout(function(){i.hideUpload=t.length>=1},500)},validateForms:function(e){var t=[],i=e.map(function(e){return new m.a(function(i,o){e.validate(function(e,a){e?i():(t.push(a),o())})})});return m.a.all(i).catch(function(){return m.a.reject(t)})},submitAddLup:function(){var e=this,t=void 0;1==this.ruleForm.oilTypeDevice&&(t=["lupRuleForm","oilRuleForm"].map(function(t){return e.$refs[t]})),2==this.ruleForm.oilTypeDevice&&(t=["lupRuleForm","oilRuleForm1"].map(function(t){return e.$refs[t]})),this.validateForms(t).then(function(){var t=/^[1-9]\d*$/,i=Number(e.ruleForm.oilChangePeriod),o=Number(e.ruleForm.oilAddPeriod),a=t.test(i),l=t.test(o),r="2"==e.ruleForm.oilTypeDevice,n=e.oilChangePeriodList,s=null,d=null;if(n.forEach(function(e){e.rangMin=1,r?"KM"!=e.oilChangePeriodUnit&&(e.rangMax="Y"==e.oilChangePeriodUnit?2:"M"==e.oilChangePeriodUnit?24:"D"==e.oilChangePeriodUnit?730:17520):"KM"!=e.oilChangePeriodUnit&&(e.rangMax="Y"==e.oilChangePeriodUnit?20:"M"==e.oilChangePeriodUnit?240:"D"==e.oilChangePeriodUnit?7300:175200)}),r?n.forEach(function(t){e.ruleForm.oilAddPeriodUnit==t.oilChangePeriodUnit&&(d=t.rangMax)}):(n.forEach(function(t){e.ruleForm.oilChangePeriodUnit==t.oilChangePeriodUnit&&(s=t.rangMax)}),n.forEach(function(t){e.ruleForm.oilAddPeriodUnit==t.oilChangePeriodUnit&&(d=t.rangMax)})),o)if(l&&o>=1&&o<=d);else if(d)return void e.$message({type:"error",message:"加油/加脂周期：请输入1~"+d+"的整数"});if(a&&i&&!r)if(i>=1&&i<=s);else if(s)return void e.$message({type:"error",message:"换油周期：请输入1~"+s+"的整数"});e.ruleForm.id?e.ruleForm.lupFlag="edit":e.ruleForm.lupFlag="add",e.$emit("addOrEditLup",e.ruleForm,e.showOrHideState)}).catch(function(e){})},cancelDialog:function(){this.$refs.lupRuleForm.resetFields(),1==this.ruleForm.oilTypeDevice&&this.$refs.oilRuleForm.resetFields(),2==this.ruleForm.oilTypeDevice&&this.$refs.oilRuleForm1.resetFields(),this.$emit("closeDialog")}},computed:{showOrHideState:function(){var e=this.ruleForm,t=e.lubricationPointTypeCode,i=e.lubricationMethod;return"lubrication_method_0004"==i||"lubrication_method_0003"==i&&"lubrication_point_type_0011"==t?1:"lubrication_method_0001"==i||"lubrication_method_0002"==i||"lubrication_method_0008"==i||"lubrication_method_0003"==i&&"lubrication_point_type_0011"!=t?0:"lubrication_method_0005"==i||"lubrication_method_0006"==i||"lubrication_method_0007"==i||"lubrication_method_0009"==i?2:null}}},f=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-dialog",{attrs:{title:"创建润滑点",visible:e.dialogFlag,width:"40%","close-on-click-modal":!1,"before-close":e.cancelDialog},on:{"update:visible":function(t){e.dialogFlag=t}}},[i("div",{staticClass:"lup-content"},[i("div",{staticClass:"info-title"},[i("div",{staticClass:"line"}),e._v(" "),i("div",{staticClass:"title"},[e._v("润滑点信息")])]),e._v(" "),i("div",{staticClass:"form-content"},[i("el-form",{ref:"lupRuleForm",attrs:{rules:e.rules,model:e.ruleForm,"label-width":"100px","label-position":"top"}},[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"润滑点设备名称",prop:e.lupDeviceNameList.length<=1||"自定义"==e.ruleForm.lubricationPointSelectName?"lubricationPointName":"lubricationPointSelectName"}},[e.lupDeviceNameList.length>1?i("div",{staticStyle:{display:"flex"}},[i("el-select",{style:{width:"自定义"==e.ruleForm.lubricationPointSelectName?"30%":"80%",marginRight:"自定义"==e.ruleForm.lubricationPointSelectName?"5px":""},attrs:{placeholder:"请选择润滑点设备名称",size:"small"},model:{value:e.ruleForm.lubricationPointSelectName,callback:function(t){e.$set(e.ruleForm,"lubricationPointSelectName",t)},expression:"ruleForm.lubricationPointSelectName"}},e._l(e.lupDeviceNameList,function(e){return i("el-option",{key:e.lubPointName,style:{color:"自定义"==e.lubPointName?"blue":"#606266"},attrs:{label:e.lubPointName,value:e.lubPointName}})}),1),e._v(" "),"自定义"==e.ruleForm.lubricationPointSelectName?i("el-input",{style:{width:"自定义"==e.ruleForm.lubricationPointSelectName?"50%":"80%"},attrs:{size:"small",maxlength:"50",clearable:"",placeholder:"请输入"},model:{value:e.ruleForm.lubricationPointName,callback:function(t){e.$set(e.ruleForm,"lubricationPointName",t)},expression:"ruleForm.lubricationPointName"}}):e._e()],1):i("div",[i("el-input",{staticStyle:{width:"80%"},attrs:{size:"small",maxlength:"50",clearable:"",placeholder:"请输入"},model:{value:e.ruleForm.lubricationPointName,callback:function(t){e.$set(e.ruleForm,"lubricationPointName",t)},expression:"ruleForm.lubricationPointName"}})],1)])],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"润滑点设备类型",prop:"lubricationPointTypeCode"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("\n                  润滑点设备类型\n                  "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top-start"}},[i("div",{staticStyle:{"max-width":"400px","line-height":"18px"},attrs:{slot:"content"},slot:"content"},[e._v("\n                      1. 蒸汽轮机、燃气轮机、造纸机类型仅对应其循环系统 "),i("br"),e._v("\n                      2. 商用车对应的润滑点设备类型选择如下：\n                      发动机请选择“发动机”，变速箱/差速器/终传动/轮边减速器请选择“闭式齿轮”，轮毂轴承/其它回转设备滚动轴承请选择“滚动轴承”，刹车系统/液压系统请选择“液压系统”，开式齿轮请选择“开式齿轮”，冷却系统/销轴请选择“其它”\n                    ")]),e._v(" "),i("el-button",{staticStyle:{color:"#333","font-size":"15px",padding:"0px"},attrs:{type:"text"}},[i("i",{staticClass:"el-icon-warning-outline"})])],1)],1),e._v(" "),i("el-select",{staticStyle:{width:"80%"},attrs:{placeholder:"请选择",size:"small"},on:{change:e.handleLubricationPointTypeChange},model:{value:e.ruleForm.lubricationPointTypeCode,callback:function(t){e.$set(e.ruleForm,"lubricationPointTypeCode",t)},expression:"ruleForm.lubricationPointTypeCode"}},e._l(e.lubricationPointTypeList,function(e){return i("el-option",{key:e.code,attrs:{label:e.name,value:e.code,clearable:""}})}),1)],1)],1),e._v(" "),i("el-col",{staticStyle:{height:"80px"},attrs:{span:12}},[i("el-form-item",{attrs:{label:"润滑⽅式",prop:"lubricationMethod"}},[i("el-select",{staticStyle:{width:"80%"},attrs:{size:"small",clearable:"",placeholder:"请选择","no-data-text":"请先选择润滑点设备类型"},on:{change:e.handlelubricationMethodChange},model:{value:e.ruleForm.lubricationMethod,callback:function(t){e.$set(e.ruleForm,"lubricationMethod",t)},expression:"ruleForm.lubricationMethod"}},e._l(e.lubricationPointTypeData,function(e){return i("el-option",{key:e.code,attrs:{label:e.name,value:e.code}})}),1)],1)],1),e._v(" "),i("el-col",{staticStyle:{height:"80px"},attrs:{span:12}},[i("el-form-item",{attrs:{label:"在用油品名称",prop:"currentOilCode"}},[i("el-select",{ref:"cascaderRef",staticStyle:{width:"80%"},attrs:{size:"small",placeholder:"试试搜索：油品名称",clearable:"",filterable:"","no-data-text":"请先选择在用油品牌",remote:"",loading:e.loadingRemote,"remote-method":e.getOilList},on:{focus:function(t){return e.getOilList("")},change:e.oilNameChange},model:{value:e.ruleForm.currentOilCode,callback:function(t){e.$set(e.ruleForm,"currentOilCode",t)},expression:"ruleForm.currentOilCode"}},[e._l(e.oilList,function(e){return i("el-option",{key:e.code,attrs:{label:e.oilAlias,value:e.code}})}),e._v(" "),i("template",{slot:"empty"},[e.loadingRemote?i("div",{staticStyle:{"text-align":"center",padding:"5px",color:"grey"}},[e._v("\n                      加载中\n                    ")]):i("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center",padding:"5px 0px"}},[e._v("\n                      暂无匹配数据"),i("el-link",{staticStyle:{"margin-left":"10px",color:"#409eff"},on:{click:function(t){return e.createOil("oilName")}}},[e._v("去添加")])],1)])],2)],1)],1),e._v(" "),i("el-col",{staticStyle:{height:"80px"},attrs:{span:12}},[i("el-form-item",{attrs:{prop:"oilBoxCapacity"}},[i("el-col",{staticStyle:{padding:"0"},attrs:{span:11}},[i("el-form-item",{attrs:{prop:"oilBoxCapacity",label:"油箱容量",rules:[{required:2!=e.ruleForm.oilTypeDevice,message:"请输入油箱容量",trigger:"blur"},{pattern:/^(([1-9]\d*)|([0-9]\d*.\d?[1-9]{1,2}))$/,message:"数值不能为0,且小数点后最多三位小数",trigger:"blur"}]}},[i("el-input",{attrs:{size:"small",maxlength:"10",placeholder:"请输入",clearable:""},model:{value:e.ruleForm.oilBoxCapacity,callback:function(t){e.$set(e.ruleForm,"oilBoxCapacity",t)},expression:"ruleForm.oilBoxCapacity"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:"oilBoxCapacityUnit",rules:[{required:2!=e.ruleForm.oilTypeDevice,message:"请选择油箱容量单位",trigger:"change"}]}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},model:{value:e.ruleForm.oilBoxCapacityUnit,callback:function(t){e.$set(e.ruleForm,"oilBoxCapacityUnit",t)},expression:"ruleForm.oilBoxCapacityUnit"}},e._l(e.oilBoxCapacityList,function(e){return i("el-option",{key:e.oilBoxCapacityUnit,attrs:{label:e.oilBoxCapacityUnitDesc,value:e.oilBoxCapacityUnit}})}),1)],1)],1)],1)],1),e._v(" "),i("el-col",{staticStyle:{height:"80px"},attrs:{span:12}},[i("el-form-item",{attrs:{label:"润滑点设备制造商名称",prop:"lubricationPointManufacturer"}},[i("el-input",{staticStyle:{width:"80%"},attrs:{size:"small",maxlength:"50",clearable:"",placeholder:"请输入"},model:{value:e.ruleForm.lubricationPointManufacturer,callback:function(t){e.$set(e.ruleForm,"lubricationPointManufacturer",t)},expression:"ruleForm.lubricationPointManufacturer"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"设备制造商推荐油品",prop:"recommendOilCode"}},[i("el-select",{ref:"cascaderRef",staticStyle:{width:"80%"},attrs:{size:"small",placeholder:"试试搜索：油品名称",clearable:"",filterable:"","no-data-text":"请先选择在用油品牌",remote:"",loading:e.loadingRemote,"remote-method":e.getOilList},on:{focus:function(t){return e.getOilList("")},change:e.selectRecommendOilName},model:{value:e.ruleForm.recommendOilCode,callback:function(t){e.$set(e.ruleForm,"recommendOilCode",t)},expression:"ruleForm.recommendOilCode"}},[e._l(e.oilList,function(e){return i("el-option",{key:e.code,attrs:{label:e.oilAlias,value:e.code}})}),e._v(" "),i("template",{slot:"empty"},[e.loadingRemote?i("div",{staticStyle:{"text-align":"center",padding:"5px",color:"grey"}},[e._v("\n                      加载中\n                    ")]):i("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center",padding:"5px 0px"}},[e._v("\n                      暂无匹配数据"),i("el-link",{staticStyle:{"margin-left":"10px",color:"#409eff"},on:{click:function(t){return e.createOil("currentName")}}},[e._v("去添加")])],1)])],2)],1)],1)],1),e._v(" "),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:24}},[i("el-form-item",[i("div",{staticStyle:{"margin-bottom":"15px"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("润滑点图片")]),i("span",{staticStyle:{color:"#999"},attrs:{slot:"label"},slot:"label"},[e._v("（支持.png.jpg.svn.gif图片格式）")])]),e._v(" "),i("el-upload",{class:{hide:e.hideUpload||e.imageLubricationList.length>0},attrs:{action:e.uploadUrl,"list-type":"picture-card",limit:"1","file-list":e.imageLubricationList,accept:"image/*","auto-upload":!1,"on-change":e.handleAddLubricatePointFile,"on-remove":e.handleLubricatePointRemove}},[i("i",{staticClass:"el-icon-plus"})])],1)],1)],1),e._v(" "),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:24}},[i("el-form-item",{attrs:{label:"描述",prop:"lubricationPointDesc"}},[i("el-input",{staticStyle:{width:"80%"},attrs:{size:"small",type:"textarea",rows:6,maxlength:"200",placeholder:"请输入","show-word-limit":""},model:{value:e.ruleForm.lubricationPointDesc,callback:function(t){e.$set(e.ruleForm,"lubricationPointDesc",t)},expression:"ruleForm.lubricationPointDesc"}})],1)],1)],1)],1)],1),e._v(" "),i("div",{staticClass:"info-title"},[i("div",{staticClass:"line"}),e._v(" "),i("div",{staticClass:"title"},[e._v("用油信息")])]),e._v(" "),2!=e.ruleForm.oilTypeDevice?i("div",{staticClass:"form-content"},[i("el-form",{ref:"oilRuleForm",attrs:{rules:e.rules,model:e.ruleForm,"label-width":"100px","label-position":"top"}},[i("el-row",{attrs:{gutter:24}},[0==e.showOrHideState?i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"定期或按质换油",prop:"oilChangeMethod",rules:[{required:!0,message:"请选择定期或按质换油",trigger:"change"}]}},[i("el-radio-group",{model:{value:e.ruleForm.oilChangeMethod,callback:function(t){e.$set(e.ruleForm,"oilChangeMethod",t)},expression:"ruleForm.oilChangeMethod"}},[i("el-radio",{attrs:{label:1}},[e._v("定期")]),e._v(" "),i("el-radio",{attrs:{label:2}},[e._v("按质")])],1)],1)],1):e._e()],1),e._v(" "),i("el-row",{attrs:{gutter:24}},[0==e.showOrHideState?i("el-col",{staticStyle:{height:"80px"},attrs:{span:12}},[i("el-form-item",{attrs:{prop:"oilChangePeriod"}},[i("el-col",{staticStyle:{padding:"0",height:"80px"},attrs:{span:11}},[i("el-form-item",{attrs:{prop:"oilChangePeriod",label:"换油周期",rules:[{validator:e.validatePeriodVal(this.ruleForm),trigger:"blur"},{required:!0,message:"请输入换油周期",trigger:"blur"},{pattern:/^[0-9]*[1-9][0-9]*$/,message:"请输入正整数",trigger:"blur"}]}},[i("el-input",{staticClass:"input-with-select",attrs:{size:"small",maxlength:"10",placeholder:"请输入",clearable:""},on:{change:function(t){return e.dateChange("lastOilChangeDate")}},model:{value:e.ruleForm.oilChangePeriod,callback:function(t){e.$set(e.ruleForm,"oilChangePeriod",t)},expression:"ruleForm.oilChangePeriod"}})],1)],1),e._v(" "),i("el-col",{staticStyle:{height:"80px"},attrs:{span:9}},[i("el-form-item",{attrs:{prop:"oilChangePeriodUnit"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},on:{change:function(t){return e.dateChange("lastOilChangeDate")}},model:{value:e.ruleForm.oilChangePeriodUnit,callback:function(t){e.$set(e.ruleForm,"oilChangePeriodUnit",t)},expression:"ruleForm.oilChangePeriodUnit"}},e._l(e.oilChangePeriodList,function(e){return i("el-option",{key:e.oilChangePeriodUnit,attrs:{label:e.oilChangePeriodUnitDesc,value:e.oilChangePeriodUnit}})}),1)],1)],1)],1)],1):e._e(),e._v(" "),0==e.showOrHideState?i("el-col",{staticStyle:{height:"80px"},attrs:{span:12}},[i("el-form-item",{attrs:{label:"上次换油⽇期",prop:"lastOilChangeDate"}},[i("el-date-picker",{staticStyle:{width:"80%"},attrs:{type:"date",size:"small","picker-options":e.expireTimeOption,"value-format":"yyyy-MM-dd",placeholder:"选择日期"},on:{change:function(t){return e.dateChange("lastOilChangeDate")}},model:{value:e.ruleForm.lastOilChangeDate,callback:function(t){e.$set(e.ruleForm,"lastOilChangeDate",t)},expression:"ruleForm.lastOilChangeDate"}})],1)],1):e._e(),e._v(" "),0==e.showOrHideState&&e.ruleForm.lastOilChangeDate?i("el-col",{staticStyle:{height:"80px"},attrs:{span:12}},[i("el-form-item",{attrs:{prop:"fillingQuantity"}},[i("el-col",{staticStyle:{padding:"0"},attrs:{span:11}},[i("el-form-item",{attrs:{prop:"fillingQuantity",label:"上次换油时加注量",rules:[{pattern:/^(([1-9]\d*)|([0-9]\d*.\d?[1-9]{1,2}))$/,message:"数值不能为0,且小数点后最多三位小数",trigger:"blur"}]}},[i("el-input",{staticClass:"input-with-select",attrs:{size:"small",maxlength:"6",placeholder:"请输入",clearable:""},model:{value:e.ruleForm.fillingQuantity,callback:function(t){e.$set(e.ruleForm,"fillingQuantity",t)},expression:"ruleForm.fillingQuantity"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:"fillingQuantityUnit"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},model:{value:e.ruleForm.fillingQuantityUnit,callback:function(t){e.$set(e.ruleForm,"fillingQuantityUnit",t)},expression:"ruleForm.fillingQuantityUnit"}},e._l(e.oilBoxCapacityList,function(e){return i("el-option",{key:e.oilBoxCapacityUnit,attrs:{label:e.oilBoxCapacityUnitDesc,value:e.oilBoxCapacityUnit}})}),1)],1)],1)],1)],1):e._e(),e._v(" "),0==e.showOrHideState&&e.ruleForm.lastOilChangeDate&&e.ruleForm.oilChangePeriod&&1==e.ruleForm.oilChangeMethod&&"KM"!=e.ruleForm.oilChangePeriodUnit?i("el-col",{staticStyle:{height:"80px"},attrs:{span:12}},[i("el-form-item",{attrs:{label:"是否自动生成下次换油计划？",prop:"autoCreateOilChangePlan"}},[i("el-radio-group",{model:{value:e.ruleForm.autoCreateOilChangePlan,callback:function(t){e.$set(e.ruleForm,"autoCreateOilChangePlan",t)},expression:"ruleForm.autoCreateOilChangePlan"}},[i("el-radio",{attrs:{label:!0}},[e._v("是")]),e._v(" "),i("el-radio",{attrs:{label:!1}},[e._v("否")])],1)],1)],1):e._e(),e._v(" "),0==e.showOrHideState&&e.ruleForm.autoCreateOilChangePlan&&e.ruleForm.oilChangeMethod&&e.ruleForm.lastOilChangeDate&&1==e.ruleForm.oilChangeMethod&&e.ruleForm.oilChangePeriod&&"KM"!=e.ruleForm.oilChangePeriodUnit?i("el-col",{staticStyle:{height:"80px"},attrs:{span:12}},[i("el-form-item",{attrs:{label:"预计下次换油日期",prop:"nextScheduledOilChangeDate"}},[i("el-date-picker",{staticStyle:{width:"80%"},attrs:{type:"date",size:"small","picker-options":e.pickerBeginDateBefore,"value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:e.ruleForm.nextScheduledOilChangeDate,callback:function(t){e.$set(e.ruleForm,"nextScheduledOilChangeDate",t)},expression:"ruleForm.nextScheduledOilChangeDate"}})],1)],1):e._e()],1),e._v(" "),i("el-row",{attrs:{gutter:24}},[i("el-col",{attrs:{span:12}},[i("el-col",{staticStyle:{padding:"0",height:"80px"},attrs:{span:11}},[i("el-form-item",{attrs:{prop:"oilAddPeriod",label:"加油周期",rules:[{pattern:/^[0-9]*[1-9][0-9]*$/,message:"请输入正整数",trigger:"blur"}]}},[i("el-input",{staticClass:"input-with-select",attrs:{size:"small",maxlength:"10",placeholder:"请输入",clearable:""},on:{change:function(t){return e.dateChange("lastOilAddDate")}},model:{value:e.ruleForm.oilAddPeriod,callback:function(t){e.$set(e.ruleForm,"oilAddPeriod",t)},expression:"ruleForm.oilAddPeriod"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:"oilAddPeriodUnit"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},on:{change:function(t){return e.dateChange("lastOilAddDate")}},model:{value:e.ruleForm.oilAddPeriodUnit,callback:function(t){e.$set(e.ruleForm,"oilAddPeriodUnit",t)},expression:"ruleForm.oilAddPeriodUnit"}},e._l(e.oilChangePeriodList,function(e){return i("el-option",{key:e.oilChangePeriodUnit,attrs:{label:e.oilChangePeriodUnitDesc,value:e.oilChangePeriodUnit}})}),1)],1)],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"上次加油⽇期",prop:"lastOilAddDate"}},[i("el-date-picker",{staticStyle:{width:"80%"},attrs:{type:"date",size:"small","picker-options":e.expireTimeOption,"value-format":"yyyy-MM-dd",placeholder:"选择日期"},on:{change:function(t){return e.dateChange("lastOilAddDate")}},model:{value:e.ruleForm.lastOilAddDate,callback:function(t){e.$set(e.ruleForm,"lastOilAddDate",t)},expression:"ruleForm.lastOilAddDate"}})],1)],1)],1),e._v(" "),i("el-row",{attrs:{gutter:24}},[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{prop:"everyTimeOilAddQuantity"}},[i("el-col",{staticStyle:{padding:"0"},attrs:{span:11}},[i("el-form-item",{attrs:{prop:"everyTimeOilAddQuantity",label:"每次加油量",rules:[{pattern:/^(([1-9]\d*)|([0-9]\d*.\d?[1-9]{1,2}))$/,message:"数值不能为0,且小数点后最多三位小数",trigger:"blur"}]}},[i("el-input",{staticClass:"input-with-select",attrs:{size:"small",maxlength:"6",placeholder:"请输入",clearable:""},model:{value:e.ruleForm.everyTimeOilAddQuantity,callback:function(t){e.$set(e.ruleForm,"everyTimeOilAddQuantity",t)},expression:"ruleForm.everyTimeOilAddQuantity"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:"everyTimeOilAddQuantityUnit"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},model:{value:e.ruleForm.everyTimeOilAddQuantityUnit,callback:function(t){e.$set(e.ruleForm,"everyTimeOilAddQuantityUnit",t)},expression:"ruleForm.everyTimeOilAddQuantityUnit"}},e._l(e.oilBoxCapacityList,function(e){return i("el-option",{key:e.oilBoxCapacityUnit,attrs:{label:e.oilBoxCapacityUnitDesc,value:e.oilBoxCapacityUnit}})}),1)],1)],1)],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{prop:"preMonthOilAddQuantity"}},[i("el-col",{staticStyle:{padding:"0"},attrs:{span:11}},[i("el-form-item",{attrs:{prop:"preMonthOilAddQuantity",label:"每月润滑剂添加量",rules:[{pattern:/^(([1-9]\d*)|([0-9]\d*.\d?[1-9]{1,2}))$/,message:"数值不能为0,且小数点后最多三位小数",trigger:"blur"},{required:1==e.showOrHideState,message:"请输入每月润滑剂添加量",trigger:"blur"}]}},[i("el-input",{staticClass:"input-with-select",attrs:{size:"small",maxlength:"6",placeholder:"请输入",clearable:""},model:{value:e.ruleForm.preMonthOilAddQuantity,callback:function(t){e.$set(e.ruleForm,"preMonthOilAddQuantity",t)},expression:"ruleForm.preMonthOilAddQuantity"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:"preMonthOilAddQuantityUnit"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},model:{value:e.ruleForm.preMonthOilAddQuantityUnit,callback:function(t){e.$set(e.ruleForm,"preMonthOilAddQuantityUnit",t)},expression:"ruleForm.preMonthOilAddQuantityUnit"}},e._l(e.oilBoxCapacityList,function(e){return i("el-option",{key:e.oilBoxCapacityUnit,attrs:{label:e.oilBoxCapacityUnitDesc,value:e.oilBoxCapacityUnit}})}),1)],1)],1)],1)],1)],1),e._v(" "),i("el-row",{attrs:{gutter:24}},[e.ruleForm.oilAddPeriod&&e.ruleForm.lastOilAddDate&&"KM"!=e.ruleForm.oilAddPeriodUnit?i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"是否自动生成下次加油计划？",prop:"autoCreateOilAddPlan"}},[i("el-radio-group",{model:{value:e.ruleForm.autoCreateOilAddPlan,callback:function(t){e.$set(e.ruleForm,"autoCreateOilAddPlan",t)},expression:"ruleForm.autoCreateOilAddPlan"}},[i("el-radio",{attrs:{label:!0}},[e._v("是")]),e._v(" "),i("el-radio",{attrs:{label:!1}},[e._v("否")])],1)],1)],1):e._e(),e._v(" "),e.ruleForm.autoCreateOilAddPlan&&e.ruleForm.lastOilAddDate&&e.ruleForm.oilAddPeriod&&"KM"!=e.ruleForm.oilAddPeriodUnit?i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"预计下次加油日期",prop:"nextScheduledOilAddDate"}},[i("el-date-picker",{staticStyle:{width:"80%"},attrs:{type:"date","picker-options":e.pickerBeginDateBefore,size:"small","value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:e.ruleForm.nextScheduledOilAddDate,callback:function(t){e.$set(e.ruleForm,"nextScheduledOilAddDate",t)},expression:"ruleForm.nextScheduledOilAddDate"}})],1)],1):e._e()],1)],1)],1):e._e(),e._v(" "),2==e.ruleForm.oilTypeDevice?i("div",{staticClass:"form-content"},[i("el-form",{ref:"oilRuleForm1",attrs:{rules:e.rules,model:e.ruleForm,"label-width":"100px","label-position":"top"}},[i("el-row",{attrs:{gutter:24}},[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{prop:"oilAddPeriod"}},[i("el-col",{staticStyle:{padding:"0"},attrs:{span:11}},[i("el-form-item",{attrs:{prop:"oilAddPeriod",label:"加脂周期",rules:[{pattern:/^[0-9]*[1-9][0-9]*$/,message:"请输入正整数",trigger:"blur"}]}},[i("el-input",{staticClass:"input-with-select",attrs:{size:"small",maxlength:"10",placeholder:"请输入",clearable:""},on:{change:function(t){return e.dateChange("lastOilAddDate2")}},model:{value:e.ruleForm.oilAddPeriod,callback:function(t){e.$set(e.ruleForm,"oilAddPeriod",t)},expression:"ruleForm.oilAddPeriod"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:"oilAddPeriodUnit"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},on:{change:function(t){return e.dateChange("lastOilAddDate2")}},model:{value:e.ruleForm.oilAddPeriodUnit,callback:function(t){e.$set(e.ruleForm,"oilAddPeriodUnit",t)},expression:"ruleForm.oilAddPeriodUnit"}},e._l(e.oilChangePeriodList,function(e){return i("el-option",{key:e.oilChangePeriodUnit,attrs:{label:e.oilChangePeriodUnitDesc,value:e.oilChangePeriodUnit}})}),1)],1)],1)],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{prop:"everyTimeOilAddQuantity"}},[i("el-col",{staticStyle:{padding:"0"},attrs:{span:11}},[i("el-form-item",{attrs:{prop:"everyTimeOilAddQuantity",label:"每次加脂量",rules:[{pattern:/^(([1-9]\d*)|([0-9]\d*.\d?[1-9]{1,2}))$/,message:"数值不能为0,且小数点后最多三位小数",trigger:"blur"}]}},[i("el-input",{staticClass:"input-with-select",attrs:{size:"small",maxlength:"6",placeholder:"请输入",clearable:""},model:{value:e.ruleForm.everyTimeOilAddQuantity,callback:function(t){e.$set(e.ruleForm,"everyTimeOilAddQuantity",t)},expression:"ruleForm.everyTimeOilAddQuantity"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:"everyTimeOilAddQuantityUnit"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},model:{value:e.ruleForm.everyTimeOilAddQuantityUnit,callback:function(t){e.$set(e.ruleForm,"everyTimeOilAddQuantityUnit",t)},expression:"ruleForm.everyTimeOilAddQuantityUnit"}},e._l(e.oilBoxCapacityList,function(e){return i("el-option",{key:e.oilBoxCapacityUnit,attrs:{label:e.oilBoxCapacityUnitDesc,value:e.oilBoxCapacityUnit}})}),1)],1)],1)],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{prop:"preMonthOilAddQuantity"}},[i("el-col",{staticStyle:{padding:"0"},attrs:{span:11}},[i("el-form-item",{attrs:{prop:"preMonthOilAddQuantity",label:"每月润滑剂添加量",rules:[{pattern:/^(([1-9]\d*)|([0-9]\d*.\d?[1-9]{1,2}))$/,message:"数值不能为0,且小数点后最多三位小数",trigger:"blur"},{required:!0,message:"请输入每月润滑剂添加量",trigger:"blur"}]}},[i("el-input",{staticClass:"input-with-select",attrs:{size:"small",maxlength:"6",placeholder:"请输入",clearable:""},model:{value:e.ruleForm.preMonthOilAddQuantity,callback:function(t){e.$set(e.ruleForm,"preMonthOilAddQuantity",t)},expression:"ruleForm.preMonthOilAddQuantity"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:"preMonthOilAddQuantityUnit"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},model:{value:e.ruleForm.preMonthOilAddQuantityUnit,callback:function(t){e.$set(e.ruleForm,"preMonthOilAddQuantityUnit",t)},expression:"ruleForm.preMonthOilAddQuantityUnit"}},e._l(e.oilBoxCapacityList,function(e){return i("el-option",{key:e.oilBoxCapacityUnit,attrs:{label:e.oilBoxCapacityUnitDesc,value:e.oilBoxCapacityUnit}})}),1)],1)],1)],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"上次加脂⽇期",prop:"lastOilAddDate"}},[i("el-date-picker",{staticStyle:{width:"80%"},attrs:{type:"date",size:"small","picker-options":e.expireTimeOption,"value-format":"yyyy-MM-dd",placeholder:"选择日期"},on:{change:function(t){return e.dateChange("lastOilAddDate2")}},model:{value:e.ruleForm.lastOilAddDate,callback:function(t){e.$set(e.ruleForm,"lastOilAddDate",t)},expression:"ruleForm.lastOilAddDate"}})],1)],1)],1),e._v(" "),i("el-row",{attrs:{gutter:24}},[e.ruleForm.lastOilAddDate&&e.ruleForm.oilAddPeriod&&"KM"!=e.ruleForm.oilAddPeriodUnit?i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"是否自动生成下次加脂计划？",prop:"autoCreateOilAddPlan"}},[i("el-radio-group",{model:{value:e.ruleForm.autoCreateOilAddPlan,callback:function(t){e.$set(e.ruleForm,"autoCreateOilAddPlan",t)},expression:"ruleForm.autoCreateOilAddPlan"}},[i("el-radio",{attrs:{label:!0}},[e._v("是")]),e._v(" "),i("el-radio",{attrs:{label:!1}},[e._v("否")])],1)],1)],1):e._e(),e._v(" "),i("el-col",{attrs:{span:12}},[e.ruleForm.lastOilAddDate&&e.ruleForm.oilAddPeriod&&e.ruleForm.autoCreateOilAddPlan&&"KM"!=e.ruleForm.oilAddPeriodUnit?i("el-form-item",{attrs:{label:"预计下次加脂日期",prop:"nextScheduledOilAddDate"}},[i("el-date-picker",{staticStyle:{width:"80%"},attrs:{type:"date","picker-options":e.pickerBeginDateBefore,size:"small","value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:e.ruleForm.nextScheduledOilAddDate,callback:function(t){e.$set(e.ruleForm,"nextScheduledOilAddDate",t)},expression:"ruleForm.nextScheduledOilAddDate"}})],1):e._e()],1)],1)],1)],1):e._e()]),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:e.cancelDialog}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"danger",size:"small"},on:{click:e.submitAddLup}},[e._v("提 交")])],1)]),e._v(" "),i("AddOil",{ref:"LupDialogRef",attrs:{addOilDialog:e.addOilDialog,addType:e.addType,addOilForm:e.addOilForm},on:{addOrEditOil:e.addOrEditOil,closeDialogAdd:e.closeDialogAdd}})],1)};f._withStripped=!0;var y={render:f,staticRenderFns:[]},b=y;var F=!1;var P=i("VU/8")(v,b,!1,function(e){F||i("lLtC")},"data-v-6b49c0e7",null);P.options.__file="src/components/equipment/components/lupDialog.vue";var C=P.exports,D=i("Csjt"),x={components:{AddOil:g.a,SyncLub:D.a},props:{addDeviceDialogFlag:{type:Boolean,default:function(){return!1}},companyId:{type:String,default:function(){return""}},companyName:{type:String,default:function(){return""}},companyNumber:{type:String,default:function(){return""}},lubricationPointTypeList:{type:Array,default:function(){return[]}},oilBrandList:{type:Array,default:function(){return[]}},oilChangePeriodList:{type:Array,default:function(){return[]}},oilBoxCapacityList:{type:Array,default:function(){return[]}},oilList:{type:Array,default:function(){return[]}},recommendOilCodeKey:{type:Number,default:function(){return 1}}},watch:{addDeviceDialogFlag:function(e,t){e&&(console.log(999111199,this.companyName),this.ruleForm.customerNumber=this.companyNumber,"2"==this.roleType&&(this.ruleForm.customerNumber=JSON.parse(this.Decrypt(sessionStorage.getItem("userInfo"))).companyNumber,this.getWorkShopList(JSON.parse(this.Decrypt(sessionStorage.getItem("userInfo"))).companyId)),this.companyId&&this.getWorkShopList(this.companyId),"2"==this.roleType?(this.customerList=[{companyName:JSON.parse(this.Decrypt(sessionStorage.getItem("userInfo"))).orgInfo.companyName,companyNumber:JSON.parse(this.Decrypt(sessionStorage.getItem("userInfo"))).orgInfo.companyNumber}],this.ruleForm.customerNumber=JSON.parse(this.Decrypt(sessionStorage.getItem("userInfo"))).companyNumber,this.getWorkShopList(JSON.parse(this.Decrypt(sessionStorage.getItem("userInfo"))).companyId)):this.$_queryCustomerData())}},data:function(){var e=this;return{validatePeriodVal:function(e){var t=e.oilChangePeriodUnit;return function(e,i,o){return i?parseInt(i)<0?o(new Error("请输入大于0的周期")):"Y"==t&&i>20?o(new Error("请输入小于20年的周期")):"M"==t&&i>240?o(new Error("请输入小于240月的周期")):"D"==t&&i>7300?(console.log("this ======",i>7300),o(new Error("请输入小于7300天的周期"))):"H"==t&&i>175200?o(new Error("请输入小于175200小时的周期")):o():o(new Error("请输入换油周期"))}},showSyncLubDialog:!1,tipsData:{},hideUpload:!1,loadingRemote:!1,addOilDialog:!1,oilBrandListAdd:[],oilTypeListAdd:[],addOilForm:{oilBrand:"",oilType:"",oilName:""},addDeviceForm:{name:""},addDeviceRules:{name:[{validator:function(e,t,i){if(!t)return i(new Error("请输入自定义设备类型"));if(!/^[\u4e00-\u9fa5]{0,}$/.test(t))return i(new Error("请输入中文"));i()},trigger:"blur"}]},addOilRules:{oilBrand:[{required:!0,message:"请选择油品品牌",trigger:"change"}],oilBrandName:[{required:!0,message:"请输入",trigger:"blur"}],oilName:[{required:!0,message:"请输入油品名称",trigger:"blur"}],oilTypeName:[{required:!0,message:"请输入",trigger:"blur"}],oilType:[{required:!0,message:"请选择油品类型",trigger:"change"}]},useOilKey:0,selectOil:"",expireTimeOption:{disabledDate:function(e){return e.getTime()>Date.now()}},imageLubricationList:[],ruleForm:{isHas:1,deviceName:"",imgLubricationFile:"",customerNumber:"",recommendOilBrand:"",deviceCode:"",devicePosition:"",oilChangeMethod:2,recommendOilType:"",recommendOilSeries:"",recommendOilCode:"",lubricationPointTypeCode:"",deviceType:"",manufacturer:"",deviceModel:"",lastOilAddDate:"",oilBrandCode:"",lubricationPointName:"",lubricationPointDesc:"",lubricationPointManufacturer:"",lubricationMethod:"",oilAddPeriod:"",oilName:"",oilSeries:"",oilType:"",everyTimeOilAddQuantityUnit:"L",fillingQuantityUnit:"L",preMonthOilAddQuantityUnit:"L",preMonthOilAddQuantity:"",lastOilChangeDate:"",fillingQuantity:"",oilBoxCapacity:"",currentOilCode:"",everyTimeOilAddQuantity:"",nextScheduledOilChangeDate:"",nextScheduledOilAddDate:"",autoCreateOilChangePlan:!1,lastTestDate:"",autoCreateOilAddPlan:!1,cardNumber:"",eptType:[],workshopId:"",oilChangePeriodUnit:"D",oilChangePeriod:"",oilBoxCapacityUnit:"L",oilAddPeriodUnit:"D",lubricationPointSelectName:""},oilTypeDevice:1,pickerBeginDateBefore:{disabledDate:function(e){return e.getTime()<Date.now()}},lubricationPointTypeData:[],eptList:[],customerList:[],workshopList:[],rules:{lubricationPointTypeCode:[{required:!0,message:"请选择润滑点设备类型",trigger:"change"}],lubricationPointName:[{required:!0,message:"请输入润滑点设备名称",trigger:"change"}],lubricationPointSelectName:[{required:!0,message:"请选择润滑点设备名称",trigger:"change"}],lubricationMethod:[{required:!0,message:"请选择润滑方式",trigger:"change"}],oilBrandCode:[{required:!0,message:"请选择在用油品牌",trigger:"change"}],currentOilCode:[{required:!0,message:"请选择在用油品名称",trigger:"change"}],oilChangePeriod:[{required:!0,message:"请输入换油周期",trigger:"change"}],oilChangePeriodUnit:[{required:!0,validator:function(t,i,o){var a="lubrication_point_type_0007"==e.ruleForm.lubricationPointTypeCode?"加脂":"换油";e.ruleForm.oilChangePeriodUnit?o():o(new Error("请选择"+a+"周期单位"))},trigger:"change"}],oilChangeMethod:[{required:!0,message:"请选择定期或按质换油",trigger:"change"}],deviceName:[{required:!0,message:"请输入设备名称",trigger:"blur"}],customerNumber:[{required:!0,message:"请选择所属客户",trigger:"change"}],cardNumber:[{pattern:/^[0-9]{8}$/,message:"请输入8位数字",trigger:"blur"}],eptType:[{required:!0,validator:function(t,i,o){if(!e.ruleForm.eptType.length)return o(new Error("请选择设备类型"));o()},trigger:"change"}],workshopId:[{required:!0,message:"请选择车间",trigger:"change"}]},lupDeviceNameList:[]}},created:function(){this.getOilBrandData(),this.getEptList()},methods:{closeSyncLubDialog:function(){this.showSyncLubDialog=!1,this.successNext()},lubricationPointNameBlur:function(){var e=this;this.$refs.deviceRuleForm.validateField(["eptType"],function(t){t&&(e.$message({message:"请先选择设备类型",type:"warning"}),e.ruleForm.lubricationPointName="")})},eptTypeChange:function(e){var t=this,i={deviceCode:e[e.length-1],lubPointName:"",status:1,current:1,size:100};this.requestMethodGet("/device/coreDeviceLubPoint/pageList",i).then(function(e){if(1e3==e.data.code){var i=e.data.data.list||[];i.length&&i.forEach(function(e){e.isCustomFlag=!1});i.push({lubPointName:"自定义",isCustomFlag:!0}),i.length>1&&t.$set(t.ruleForm,"lubricationPointSelectName",""),t.lupDeviceNameList=i}else t.$message({message:e.data.msg,type:"error"})})},$_queryCustomerData:function(){var e=this,t={companyType:2,size:30,status:1,companyName:this.companyName,menuCode:"CustomerProfileList"};this.requestMethodGet("/web/customer/queryCompanyListByPage",t).then(function(t){1e3==(t=t.data).code?e.customerList=t.data.list:e.$message({message:t.msg,type:"warning"})}).catch(function(e){})},getWorkShopList:function(e){var t=this,i={companyId:e,workshopName:"",current:1,size:500};this.requestMethodGet("/weChat/workshop/queryWorkshopListByPage",i).then(function(e){if(1e3==e.data.code){var i=e.data.data.list||[];t.workshopList=i}else t.$message({message:e.data.msg,type:"error"})})},getEptList:function(){var e=this;this.requestMethodGet("/weChat/device/queryAllDeviceTypeTree4",{filterFlag:!0}).then(function(t){1e3==t.data.code?e.eptList=t.data.data:e.$message({message:t.data.msg,type:"error"})})},dateChange:function(e){var t=this,i=void 0,o=void 0,a=void 0;if("lastOilAddDate2"==e||"lastOilAddDate"==e?(i=this.ruleForm.oilAddPeriod,o=this.ruleForm.oilAddPeriodUnit,a=this.ruleForm.lastOilAddDate):(i=this.ruleForm.oilChangePeriod,o=this.ruleForm.oilChangePeriodUnit,a=this.ruleForm.lastOilChangeDate),i&&o&&a){var l={oilChangePeriod:i,oilChangePeriodUnit:o,oilLastTime:a};this.requestMethodGet("/web/service/ps/plusChangeOilDate",l).then(function(i){1e3==i.data.code?"lastOilAddDate2"==e?t.ruleForm.nextScheduledOilAddDate=i.data.data:"lastOilAddDate"==e?t.ruleForm.nextScheduledOilAddDate=i.data.data:t.ruleForm.nextScheduledOilChangeDate=i.data.data:t.$message({message:i.msg,type:"warning"})})}},createDevice:function(){this.createDeviceFlag=!0,this.addDeviceForm.name=this.$refs.deviceRef.inputValue},completeAdd:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;var i={level:"4",name:t.addDeviceForm.name,parentCode:"device_user_defined"};t.requestMethodPost("web/config/industryDevice/addIndustryDevice",i).then(function(e){1e3==e.data.code?(t.ruleForm.eptType=["industry_0013","industry_0051","device_user_defined",e.data.data],t.chooseAgain(),t.getEptList()):4306==e.data.code||4307==e.data.code?(t.addDeviceCode=e.data.code,t.addDeviceMsg=e.data.msg,t.showDialog=!0):t.$message({message:e.data.msg,type:"error"})})})},addOrEditOil:function(e){var t=this,i={oilBrand:e.oilBrand,oilName:e.oilName,customerCompanyNumber:JSON.parse(this.Decrypt(sessionStorage.getItem("userInfo"))).companyNumber};"0"==e.oilBrand&&(i.oilBrand="",i.customCode="1",i.oilBrandName=e.oilBrandName),this.requestMethodPost("mdm/oil/addOil",i).then(function(i){1e3==i.data.code?("0"==e.oilBrand?(t.getOilBrandData(),t.getQueryOilList("oilBrandList","add",i.data.data.oilBrandNumber),"oilName"==t.addType&&(t.ruleForm.oilBrandCode=i.data.data.oilBrandNumber)):t.ruleForm.oilBrandCode=e.oilBrand,"oilName"==t.addType?(t.getOilList(""),t.$set(t.ruleForm,"currentOilCode",i.data.data.oilNameNumber)):(t.getOilList(""),t.$set(t.ruleForm,"recommendOilCode",i.data.data.oilNameNumber)),t.addOilDialog=!1):t.$message({message:i.data.msg,type:"error"})})},closeDialogAdd:function(){p()(this.$data.addOilForm,this.$options.data().addOilForm),this.addOilDialog=!1},getOilBrandData:function(){var e=this;this.requestMethodGet("/mdm/oil/queryOilList",{status:1,parentCode:0}).then(function(t){if(1e3==t.data.code){var i=t.data.data,o=[];0!==i.length&&(i.forEach(function(e){e.text=e.name}),o=i.filter(function(e){return"oil_0001"!==e.code})),e.oilBrandListAdd=o,e.oilBrandListAdd.push({name:"自定义",code:"0"})}else e.$message({message:t.data.msg,type:"error"})})},createOil:function(e){this.addType=e,"oilName"==e&&this.getOilTypeData(this.ruleForm.oilBrandCode),"currentName"==e&&(this.$set(this.addOilForm,"oilBrand",""),this.$set(this.addOilForm,"oilBrandName","")),this.$set(this.addOilForm,"oilBrand",""),this.$set(this.addOilForm,"oilBrandName",""),this.$set(this.addOilForm,"oilType",""),this.$set(this.addOilForm,"oilName",""),this.$set(this.addOilForm,"oilTypeName",""),this.addOilDialog=!0},cancelAddOil:function(){this.addOilDialog=!1,p()(this.$data.addOilForm,this.$options.data().addOilForm)},getQueryOilList:function(e,t,i){var o=this;this.requestMethodGet("/mdm/oil/queryOilList",{parentCode:0,status:1}).then(function(a){if(1e3==(a=a.data).code){if(a.data&&a.data.length>0){var l=a.data;switch(l=l.map(function(e){return{value:e.code,label:e.name}}),e){case"oilBrandList":o.oilBrandList=l}}"add"==t&&"oilName"==o.addType&&o.$nextTick(function(){o.ruleForm.oilBrandCode=i})}else o.$message({message:a.msg,type:"warning"})}).catch(function(e){})},completeAddOil:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;var i={oilBrand:t.addOilForm.oilBrand,oilName:t.addOilForm.oilName,customerCompanyNumber:JSON.parse(t.Decrypt(sessionStorage.getItem("userInfo"))).companyNumber};"0"==t.addOilForm.oilBrand&&(i.oilBrand="",i.customCode="1",i.oilBrandName=t.addOilForm.oilBrandName),t.requestMethodPost("mdm/oil/addOil",i).then(function(e){if(1e3==e.data.code)"0"==t.addOilForm.oilBrand?(t.getOilBrandData(),t.getQueryOilList("oilBrandList","add",e.data.data.oilBrandNumber),"oilName"==t.addType&&(t.ruleForm.oilBrandCode=e.data.data.oilBrandNumber)):t.ruleForm.oilBrandCode=t.addOilForm.oilBrand,"oilName"==t.addType?t.getRecommendOilList(t.ruleForm.oilBrandCode,"addType",e.data.data.oilNameNumber):(t.getOilList(""),t.ruleForm.recommendOilCode=e.data.data.oilNameNumber),t.addOilDialog=!1;else if(4216==e.data.code){var i="请直接搜索或下拉查询此油品：“"+e.data.msg+"”";t.$confirm(i,"该油品已存在",{confirmButtonText:"确定",showCancelButton:!1,type:"warning"}).then(function(){}).catch(function(){})}else if(4217==e.data.code){var o="请直接搜索或下拉查询此油品：“"+e.data.msg+"”";t.$confirm(o,"该油品品牌已存在",{confirmButtonText:"确定",showCancelButton:!1,type:"warning"}).then(function(){}).catch(function(){})}else if(4218==e.data.code){var a="请直接搜索或下拉查询此油品：“"+e.data.msg+"”";t.$confirm(a,"该油品类型已存在",{confirmButtonText:"确定",showCancelButton:!1,type:"warning"}).then(function(){}).catch(function(){})}else t.$message({message:e.data.msg,type:"error"})})})},getOilList:function(e){var t=this;this.loadingRemote=!0,this.requestMethodGet("/mdm/oil/queryOilListByPage",{oilName:e,status:1,size:200,current:1}).then(function(e){1e3==e.data.code?(t.loadingRemote=!1,t.oilList=e.data.data.list):t.$message({message:e.data.msg,type:"error"})})},formatData:function(e){for(var t=0;t<e.length;t++)e[t].children&&0!=e[t].children.length?this.formatData(e[t].children):e[t].children=null;return e},selectRecommendOilName:function(e){++this.recommendOilCodeKey,e&&(this.ruleForm.recommendOilCode=e[e.length-1])},handleLubricationPointTypeChange:function(e){if(e){var t;t=this.lubricationPointTypeList.filter(function(t){return t.code===e}),this.ruleForm.lubricationPointTypeCode=t[0].code,this.ruleForm.lubricationPointType=t[0].name,this.ruleForm.lubricationMethod="",this.$_queryLubricationMethodData(this.ruleForm.lubricationPointTypeCode)}else this.ruleForm.lubricationPointTypeCode="",this.ruleForm.lubricationPointType=""},getDeviceType:function(e){var t;t=this.lubricationPointTypeData.filter(function(t){return t.code===e}),this.oilTypeDevice=t[0].oilType,2==this.oilTypeDevice?(this.ruleForm.oilBoxCapacityUnit="KG",this.ruleForm.everyTimeOilAddQuantityUnit="KG",this.ruleForm.preMonthOilAddQuantityUnit="KG",this.ruleForm.oilChangeMethod="",this.ruleForm.oilChangePeriod="",this.ruleForm.oilChangePeriodUnit="",this.ruleForm.lastOilChangeDate="",this.ruleForm.autoCreateOilChangePlan="",this.ruleForm.fillingQuantity="",this.ruleForm.fillingQuantityUnit="",this.ruleForm.nextScheduledOilChangeDate=""):(this.ruleForm.oilBoxCapacityUnit="L",this.ruleForm.everyTimeOilAddQuantityUnit="L",this.ruleForm.preMonthOilAddQuantityUnit="L",this.ruleForm.oilChangeMethod=2,this.ruleForm.autoCreateOilChangePlan=!1,"lubrication_point_type_0004"==this.ruleForm.lubricationPointTypeCode&&(this.ruleForm.oilChangeMethod=1))},handlelubricationMethodChange:function(e){this.getDeviceType(e)},$_queryLubricationMethodData:function(e){var t=this,i={typeCode:e};this.requestMethodGet("/web/device/getLubricationMethodByType",i).then(function(e){1e3==(e=e.data).code?(t.lubricationPointTypeData=e.data,1==t.lubricationPointTypeData.length?(t.ruleForm.lubricationMethod=t.lubricationPointTypeData[0].code,t.oilTypeDevice=t.lubricationPointTypeData[0].oilType,2!=t.oilTypeDevice?(t.ruleForm.oilBoxCapacityUnit="L",t.ruleForm.everyTimeOilAddQuantityUnit="L",t.ruleForm.preMonthOilAddQuantityUnit="L",t.ruleForm.autoCreateOilChangePlan=!1,"lubrication_point_type_0004"==t.ruleForm.lubricationPointTypeCode?t.ruleForm.oilChangeMethod=1:t.ruleForm.oilChangeMethod=2):(t.ruleForm.oilBoxCapacityUnit="KG",t.ruleForm.everyTimeOilAddQuantityUnit="KG",t.ruleForm.preMonthOilAddQuantityUnit="KG",t.ruleForm.oilChangePeriod="",t.ruleForm.oilChangePeriodUnit="",t.ruleForm.lastOilChangeDate="",t.ruleForm.autoCreateOilChangePlan="",t.ruleForm.fillingQuantity="",t.ruleForm.fillingQuantityUnit="",t.ruleForm.nextScheduledOilChangeDate="")):(t.ruleForm.lubricationMethod="",2==t.oilTypeDevice&&(t.oilTypeDevice=1,t.ruleForm.oilBoxCapacityUnit="L",t.ruleForm.everyTimeOilAddQuantityUnit="L",t.ruleForm.preMonthOilAddQuantityUnit="L"))):t.$message({message:e.msg,type:"warning"})}).catch(function(e){})},oilNameChange:function(e){if(e){var t=this.oilList.filter(function(t){return t.code==e});this.ruleForm.oilBrandCode=t[0].parentCode,this.ruleForm.currentOilCode=e}},handleAddLubricatePointFile:function(e,t){var i=this;if(!e.raw.type.startsWith("image"))return this.imageLubricationList=[],void this.$message.error("只能上传图片类型文件");if(!(e.size/1024/1024<10))return this.imageLubricationList=[],void this.$message.error("上传图片大小不能超过 10MB!");var o=new FormData;o.append("fileType","lubrication_point"),o.append("multipartFiles",e.raw),this.requestMethodPost("/web/file/uploadFiles",o).then(function(t){if(1e3==(t=t.data).code){var o=t.data[0];i.ruleForm.lubricationPointPicPath=t.data[0],i.getFullImgPath(o,e)}else i.$message({message:t.msg,type:"warning"})}).catch(function(e){})},getFullImgPath:function(e,t){var i=this,o={url:e};this.requestMethodGet("/web/file/getFullUrl",o).then(function(o){1e3==o.data.code?(i.imageLubricationList.push({url:o.data.data,submitImgUrl:e}),i.hideUpload=i.imageLubricationList.length>=1,i.ruleForm.id?i.ruleForm.imgLubricationFile=e:i.ruleForm.imgLubricationFile=t.raw):i.$message({message:o.data.msg,type:"warning"})})},handleLubricatePointRemove:function(e,t){var i=this;this.ruleForm.imgLubricationFile="",this.imageLubricationList=[],setTimeout(function(){i.hideUpload=t.length>=1},500)},validateForms:function(e){var t=[],i=e.map(function(e){return new m.a(function(i,o){e.validate(function(e,a){e?i():(t.push(a),o())})})});return m.a.all(i).catch(function(){return m.a.reject(t)})},handleSubmitForm:function(){var e=this,t=(this.ruleForm.isHas?["deviceRuleForm","lupRuleForm","oilRuleForm"]:["deviceRuleForm"]).map(function(t){return e.$refs[t]});this.validateForms(t).then(function(){if(e.ruleForm.isHas){var t=/^[1-9]\d*$/,i=Number(e.ruleForm.oilChangePeriod),o=Number(e.ruleForm.oilAddPeriod),a=t.test(i),l=t.test(o),r="2"==e.oilTypeDevice,n=e.oilChangePeriodList,s=null,d=null;if(n.forEach(function(e){e.rangMin=1,r?"KM"!=e.oilChangePeriodUnit&&(e.rangMax="Y"==e.oilChangePeriodUnit?2:"M"==e.oilChangePeriodUnit?24:"D"==e.oilChangePeriodUnit?730:17520):"KM"!=e.oilChangePeriodUnit&&(e.rangMax="Y"==e.oilChangePeriodUnit?20:"M"==e.oilChangePeriodUnit?240:"D"==e.oilChangePeriodUnit?7300:175200)}),r?n.forEach(function(t){e.ruleForm.oilAddPeriodUnit==t.oilChangePeriodUnit&&(d=t.rangMax)}):(n.forEach(function(t){e.ruleForm.oilChangePeriodUnit==t.oilChangePeriodUnit&&(s=t.rangMax)}),n.forEach(function(t){e.ruleForm.oilAddPeriodUnit==t.oilChangePeriodUnit&&(d=t.rangMax)})),o)if(l&&o>=1&&o<=d);else if(d)return void e.$message({type:"error",message:"加油/加脂周期：请输入1~"+d+"的整数"});if(a&&i&&!r)if(i>=1&&i<=s);else if(s)return void e.$message({type:"error",message:"换油周期：请输入1~"+s+"的整数"})}e.$gio.saveCreateDeviceInfo({entrance:"新建设备页",operation:"点击保存按钮",customer:e.$gio.findValueCodeCorresponding(e.customerList,e.ruleForm.customerNumber,"companyNumber","companyName")}),e.$confirm("确定提交添加设备?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$gio.saveCreateDeviceInfo({entrance:"新建设备页",operation:"弹框中点击确定",customer:e.$gio.findValueCodeCorresponding(e.customerList,e.ruleForm.customerNumber,"companyNumber","companyName")});var t=new FormData;t.append("deviceName",e.ruleForm.deviceName),t.append("customerNumber",e.ruleForm.customerNumber),t.append("deviceType ",e.ruleForm.eptType[e.ruleForm.eptType.length-1]),t.append("workshopId ",e.ruleForm.workshopId),t.append("manufacturer ",e.ruleForm.manufacturer),t.append("deviceModel ",e.ruleForm.deviceModel),t.append("deviceCode",e.ruleForm.deviceCode),t.append("devicePosition",e.ruleForm.devicePosition),t.append("haveLubricationPointFlag",e.ruleForm.isHas),e.ruleForm.isHas&&(t.append("oilBoxCapacity",e.ruleForm.oilBoxCapacity),t.append("oilBoxCapacityUnit",e.ruleForm.oilBoxCapacityUnit),t.append("oilBrandCode",e.ruleForm.oilBrandCode),t.append("oilBrand",e.oilBrandName),t.append("lubricationPointManufacturer",e.ruleForm.lubricationPointManufacturer),t.append("lubricationPointTypeCode ",e.ruleForm.lubricationPointTypeCode),e.ruleForm.lubricationPointPicPath&&t.append("lubricationPointPicPath",e.ruleForm.lubricationPointPicPath),t.append("lubricationPointType ",e.ruleForm.lubricationPointType),t.append("oilType",e.oilTypeDevice),e.lupDeviceNameList.length>1&&"自定义"!=e.ruleForm.lubricationPointSelectName?t.append("lubricationPointName ",e.ruleForm.lubricationPointSelectName):t.append("lubricationPointName ",e.ruleForm.lubricationPointName),t.append("lubricationPointDesc",e.ruleForm.lubricationPointDesc),e.ruleForm.recommendOilCode&&t.append("recommendOilCode",e.ruleForm.recommendOilCode),t.append("currentOilCode",e.ruleForm.currentOilCode),t.append("lubricationMethod",e.ruleForm.lubricationMethod),1==e.oilTypeDevice&&(0==e.showOrHideState&&(t.append("oilChangeMethod",e.ruleForm.oilChangeMethod),t.append("oilChangePeriod",e.ruleForm.oilChangePeriod),t.append("oilChangePeriodUnit",e.ruleForm.oilChangePeriodUnit),e.ruleForm.lastOilChangeDate&&(t.append("lastOilChangeDate ",e.ruleForm.lastOilChangeDate),t.append("fillingQuantity",e.ruleForm.fillingQuantity),t.append("fillingQuantityUnit",e.ruleForm.fillingQuantityUnit)),1==e.ruleForm.oilChangeMethod&&e.ruleForm.lastOilChangeDate&&e.ruleForm.oilChangePeriod&&"KM"!=e.ruleForm.oilChangePeriodUnit&&(t.append("autoCreateOilChangePlan",e.ruleForm.autoCreateOilChangePlan),e.ruleForm.nextScheduledOilChangeDate&&e.ruleForm.autoCreateOilChangePlan&&t.append("nextScheduledOilChangeDate ",e.ruleForm.nextScheduledOilChangeDate))),t.append("oilAddPeriod",e.ruleForm.oilAddPeriod),t.append("oilAddPeriodUnit",e.ruleForm.oilAddPeriodUnit),t.append("lastOilAddDate",e.ruleForm.lastOilAddDate),t.append("everyTimeOilAddQuantity",e.ruleForm.everyTimeOilAddQuantity),t.append("everyTimeOilAddQuantityUnit",e.ruleForm.everyTimeOilAddQuantityUnit),t.append("preMonthOilAddQuantity",e.ruleForm.preMonthOilAddQuantity),t.append("preMonthOilAddQuantityUnit",e.ruleForm.preMonthOilAddQuantityUnit),e.ruleForm.oilAddPeriod&&e.ruleForm.lastOilAddDate&&"KM"!=e.ruleForm.oilAddPeriodUnit&&(t.append("autoCreateOilAddPlan",e.ruleForm.autoCreateOilAddPlan),e.ruleForm.autoCreateOilAddPlan&&t.append("nextScheduledOilAddDate",e.ruleForm.nextScheduledOilAddDate))),2==e.oilTypeDevice&&(t.append("oilAddPeriodUnit",e.ruleForm.oilAddPeriodUnit),t.append("oilAddPeriod",e.ruleForm.oilAddPeriod),t.append("everyTimeOilAddQuantity",e.ruleForm.everyTimeOilAddQuantity),t.append("everyTimeOilAddQuantityUnit",e.ruleForm.everyTimeOilAddQuantityUnit),t.append("lastOilAddDate",e.ruleForm.lastOilAddDate),t.append("preMonthOilAddQuantity",e.ruleForm.preMonthOilAddQuantity),t.append("preMonthOilAddQuantityUnit",e.ruleForm.preMonthOilAddQuantityUnit),e.ruleForm.lastOilAddDate&&e.ruleForm.oilAddPeriod&&"KM"!=e.ruleForm.oilAddPeriodUnit&&(t.append("autoCreateOilAddPlan",e.ruleForm.autoCreateOilAddPlan),""!=e.ruleForm.nextScheduledOilAddDate&&e.ruleForm.autoCreateOilAddPlan&&t.append("nextScheduledOilAddDate",e.ruleForm.nextScheduledOilAddDate)))),e.requestMethodPost("/web/device/addDeviceV2",t).then(function(t){1e3==(t=t.data).code?(e.$message({message:"添加成功",type:"success"}),t.data.tips&&2!=e.$userInfo.userType?(e.showSyncLubDialog=!0,e.tipsData=t.data.tips):e.successNext()):e.$message({message:t.msg,type:"warning"})}).catch(function(e){})}).catch(function(){})}).catch(function(e){console.log(e)})},successNext:function(){this.ruleForm.isHas?(this.$refs.deviceRuleForm.resetFields(),this.$refs.lupRuleForm.resetFields(),this.$refs.oilRuleForm.resetFields()):this.$refs.deviceRuleForm.resetFields(),this.imageLubricationList=[],this.hideUpload=!1,this.addDeviceDialogFlag=!1,this.$parent.addDeviceDialogFlag=!1,this.$parent.getDeviceData("first")},handleResetFrom:function(){var e=this;this.$gio.cancelCreate({entrance:"新建设备页",operation:"点击取消按钮",customer:this.$gio.findValueCodeCorresponding(this.customerList,this.ruleForm.customerNumber,"companyNumber","companyName")}),this.$confirm("确认退出新建设备吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$gio.cancelCreate({entrance:"新建设备页",operation:"弹框中点击是",customer:e.$gio.findValueCodeCorresponding(e.customerList,e.ruleForm.customerNumber,"companyNumber","companyName")}),e.ruleForm.isHas?(e.$refs.deviceRuleForm.resetFields(),e.$refs.lupRuleForm.resetFields(),e.$refs.oilRuleForm.resetFields(),e.addDeviceDialogFlag=!1,e.$parent.addDeviceDialogFlag=!1):(e.$refs.deviceRuleForm.resetFields(),e.addDeviceDialogFlag=!1,e.$parent.addDeviceDialogFlag=!1),e.imageLubricationList=[],e.hideUpload=!1}).catch(function(){})}},computed:{showOrHideState:function(){var e=this.ruleForm,t=e.lubricationPointTypeCode,i=e.lubricationMethod;return"lubrication_method_0004"==i||"lubrication_method_0003"==i&&"lubrication_point_type_0011"==t?1:"lubrication_method_0001"==i||"lubrication_method_0002"==i||"lubrication_method_0008"==i||"lubrication_method_0003"==i&&"lubrication_point_type_0011"!=t?0:"lubrication_method_0005"==i||"lubrication_method_0006"==i||"lubrication_method_0007"==i||"lubrication_method_0009"==i?2:null}}},w=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-dialog",{attrs:{title:"创建设备",visible:e.addDeviceDialogFlag,width:"40%","close-on-click-modal":!1,"before-close":e.handleResetFrom},on:{"update:visible":function(t){e.addDeviceDialogFlag=t}}},[i("div",{staticClass:"lup-content"},[i("div",{staticClass:"info-title"},[i("div",{staticClass:"line"}),e._v(" "),i("div",{staticClass:"title"},[e._v("设备信息")])]),e._v(" "),i("div",{staticClass:"detail-form"},[i("el-form",{ref:"deviceRuleForm",attrs:{rules:e.rules,model:e.ruleForm,"label-width":"100px","label-position":"top"}},[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"设备名称",prop:"deviceName"}},[i("el-input",{staticStyle:{width:"80%"},attrs:{size:"small",maxlength:"50",clearable:"",placeholder:"请输入"},model:{value:e.ruleForm.deviceName,callback:function(t){e.$set(e.ruleForm,"deviceName",t)},expression:"ruleForm.deviceName"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"设备类型",prop:"eptType"}},[i("el-cascader",{ref:"deviceRef",staticStyle:{width:"80%"},attrs:{size:"small",placeholder:"试试搜索：设备",options:e.eptList,filterable:"",clearable:"",props:{value:"code",label:"name"}},on:{change:e.eptTypeChange},model:{value:e.ruleForm.eptType,callback:function(t){e.$set(e.ruleForm,"eptType",t)},expression:"ruleForm.eptType"}},[i("template",{slot:"empty"},[i("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center",padding:"5px 0px"}},[e._v("\n                    暂无匹配数据"),i("el-link",{staticStyle:{"margin-left":"10px",color:"#409eff"},on:{click:e.createDevice}},[e._v("去创建")])],1)])],2)],1)],1)],1),e._v(" "),i("el-row",{attrs:{gutter:20}},["2"!=e.roleType?i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"所属客户",prop:"customerNumber"}},[i("el-select",{staticStyle:{width:"80%"},attrs:{size:"small",disabled:"",placeholder:"请选择"},model:{value:e.ruleForm.customerNumber,callback:function(t){e.$set(e.ruleForm,"customerNumber",t)},expression:"ruleForm.customerNumber"}},e._l(e.customerList,function(e){return i("el-option",{key:e.companyNumber,attrs:{label:e.companyName,value:e.companyNumber}})}),1)],1)],1):e._e(),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"所属车间",prop:"workshopId"}},[i("el-select",{staticStyle:{width:"80%"},attrs:{placeholder:"请选择",size:"small",clearable:"",filterable:""},model:{value:e.ruleForm.workshopId,callback:function(t){e.$set(e.ruleForm,"workshopId",t)},expression:"ruleForm.workshopId"}},e._l(e.workshopList,function(e){return i("el-option",{key:e.workshopId,attrs:{label:e.workshopName,value:e.workshopId}})}),1)],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"制造商",prop:"manufacturer"}},[i("el-input",{staticStyle:{width:"80%"},attrs:{size:"small",maxlength:"50",clearable:"",placeholder:"请输入"},model:{value:e.ruleForm.manufacturer,callback:function(t){e.$set(e.ruleForm,"manufacturer",t)},expression:"ruleForm.manufacturer"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"设备型号",prop:"deviceModel"}},[i("el-input",{staticStyle:{width:"80%"},attrs:{size:"small",maxlength:"50",clearable:"",placeholder:"请输入"},model:{value:e.ruleForm.deviceModel,callback:function(t){e.$set(e.ruleForm,"deviceModel",t)},expression:"ruleForm.deviceModel"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"设备编码",prop:"deviceCode"}},[i("el-input",{staticStyle:{width:"80%"},attrs:{size:"small",maxlength:"50",clearable:"",placeholder:"请输入"},model:{value:e.ruleForm.deviceCode,callback:function(t){e.$set(e.ruleForm,"deviceCode",t)},expression:"ruleForm.deviceCode"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"设备位置",prop:"devicePosition"}},[i("el-input",{staticStyle:{width:"80%"},attrs:{size:"small",maxlength:"50",clearable:"",placeholder:"请输入"},model:{value:e.ruleForm.devicePosition,callback:function(t){e.$set(e.ruleForm,"devicePosition",t)},expression:"ruleForm.devicePosition"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"是否有部件需要润滑",prop:"isHas"}},[i("el-radio-group",{model:{value:e.ruleForm.isHas,callback:function(t){e.$set(e.ruleForm,"isHas",t)},expression:"ruleForm.isHas"}},[i("el-radio",{attrs:{label:1}},[e._v("需要")]),e._v(" "),i("el-radio",{attrs:{label:0}},[e._v("不需要")])],1)],1)],1)],1)],1)],1),e._v(" "),e.ruleForm.isHas?i("div",[i("div",{staticClass:"info-title"},[i("div",{staticClass:"line"}),e._v(" "),i("div",{staticClass:"title"},[e._v("润滑点信息")])]),e._v(" "),i("div",{staticClass:"form-content"},[i("el-form",{ref:"lupRuleForm",attrs:{rules:e.rules,model:e.ruleForm,"label-width":"100px","label-position":"top"}},[i("el-row",{attrs:{gutter:20}},[i("el-col",{staticStyle:{height:"80px"},attrs:{span:12}},[i("el-form-item",{attrs:{label:"润滑点设备名称",prop:"自定义"==e.ruleForm.lubricationPointSelectName||1==e.lupDeviceNameList.length||0==e.lupDeviceNameList.length?"lubricationPointName":"lubricationPointSelectName"}},[e.lupDeviceNameList.length>1?i("div",{staticStyle:{display:"flex"}},[i("el-select",{style:{width:"自定义"==e.ruleForm.lubricationPointSelectName?"30%":"80%",marginRight:"自定义"==e.ruleForm.lubricationPointSelectName?"5px":""},attrs:{placeholder:"请选择润滑点设备名称",size:"small"},model:{value:e.ruleForm.lubricationPointSelectName,callback:function(t){e.$set(e.ruleForm,"lubricationPointSelectName",t)},expression:"ruleForm.lubricationPointSelectName"}},e._l(e.lupDeviceNameList,function(e){return i("el-option",{key:e.id,style:{color:"自定义"==e.lubPointName?"blue":"#606266"},attrs:{label:e.lubPointName,value:e.lubPointName}})}),1),e._v(" "),"自定义"==e.ruleForm.lubricationPointSelectName?i("el-input",{style:{width:"自定义"==e.ruleForm.lubricationPointSelectName?"50%":"80%"},attrs:{size:"small",maxlength:"50",clearable:"",placeholder:"请输入"},on:{blur:e.lubricationPointNameBlur},model:{value:e.ruleForm.lubricationPointName,callback:function(t){e.$set(e.ruleForm,"lubricationPointName",t)},expression:"ruleForm.lubricationPointName"}}):e._e()],1):i("div",[i("el-input",{staticStyle:{width:"80%"},attrs:{size:"small",maxlength:"50",clearable:"",placeholder:"请输入"},on:{blur:e.lubricationPointNameBlur},model:{value:e.ruleForm.lubricationPointName,callback:function(t){e.$set(e.ruleForm,"lubricationPointName",t)},expression:"ruleForm.lubricationPointName"}})],1)])],1),e._v(" "),i("el-col",{staticStyle:{height:"80px"},attrs:{span:12}},[i("el-form-item",{attrs:{label:"润滑点设备类型",prop:"lubricationPointTypeCode"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("\n                    润滑点设备类型\n                    "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top-start"}},[i("div",{staticStyle:{"max-width":"400px","line-height":"18px"},attrs:{slot:"content"},slot:"content"},[e._v("\n                        1. 蒸汽轮机、燃气轮机、造纸机类型仅对应其循环系统 "),i("br"),e._v("\n                        2. 商用车对应的设备润滑点类型选择如下： 发动机请选择“发动机”，变速箱/差速器/终传动/轮边减速器请选择“闭式齿轮”，轮毂轴承/其它回转设备滚动轴承请选择“滚动轴承”，刹车系统/液压系统请选择“液压系统”，开式齿轮请选择“开式齿轮”，冷却系统/销轴请选择“其它”\n                        ")]),e._v(" "),i("el-button",{staticStyle:{color:"#333","font-size":"15px",padding:"0px"},attrs:{type:"text"}},[i("i",{staticClass:"el-icon-warning-outline"})])],1)],1),e._v(" "),i("el-select",{staticStyle:{width:"80%"},attrs:{placeholder:"请选择",size:"small"},on:{change:e.handleLubricationPointTypeChange},model:{value:e.ruleForm.lubricationPointTypeCode,callback:function(t){e.$set(e.ruleForm,"lubricationPointTypeCode",t)},expression:"ruleForm.lubricationPointTypeCode"}},e._l(e.lubricationPointTypeList,function(e){return i("el-option",{key:e.code,attrs:{label:e.name,value:e.code,clearable:""}})}),1)],1)],1),e._v(" "),i("el-col",{staticStyle:{height:"80px"},attrs:{span:12}},[i("el-form-item",{attrs:{label:"润滑⽅式",prop:"lubricationMethod"}},[i("el-select",{staticStyle:{width:"80%"},attrs:{size:"small",clearable:"",placeholder:"请选择","no-data-text":"请先选择润滑点设备类型"},on:{change:e.handlelubricationMethodChange},model:{value:e.ruleForm.lubricationMethod,callback:function(t){e.$set(e.ruleForm,"lubricationMethod",t)},expression:"ruleForm.lubricationMethod"}},e._l(e.lubricationPointTypeData,function(e){return i("el-option",{key:e.code,attrs:{label:e.name,value:e.code}})}),1)],1)],1),e._v(" "),i("el-col",{staticStyle:{height:"80px"},attrs:{span:12}},[i("el-form-item",{attrs:{label:"在用油品名称",prop:"currentOilCode"}},[i("el-select",{ref:"cascaderRef",attrs:{size:"small",placeholder:"试试搜索：油品名称",clearable:"",filterable:"",remote:"",loading:e.loadingRemote,"remote-method":e.getOilList},on:{change:e.oilNameChange},model:{value:e.ruleForm.currentOilCode,callback:function(t){e.$set(e.ruleForm,"currentOilCode",t)},expression:"ruleForm.currentOilCode"}},[e._l(e.oilList,function(e){return i("el-option",{key:e.code,attrs:{label:e.oilAlias,value:e.code}})}),e._v(" "),i("template",{slot:"empty"},[e.loadingRemote?i("div",{staticStyle:{"text-align":"center",padding:"5px",color:"grey"}},[e._v("\n                        加载中\n                      ")]):i("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center",padding:"5px 0px"}},[e._v("\n                      暂无匹配数据"),i("el-link",{staticStyle:{"margin-left":"10px",color:"#409eff"},on:{click:function(t){return e.createOil("oilName")}}},[e._v("去添加")])],1)])],2)],1)],1),e._v(" "),i("el-col",{staticStyle:{height:"80px"},attrs:{span:12}},[i("el-form-item",{attrs:{prop:"oilBoxCapacity"}},[i("el-col",{staticStyle:{padding:"0"},attrs:{span:11}},[i("el-form-item",{attrs:{prop:"oilBoxCapacity",label:"油箱容量",rules:[{required:2!=e.oilTypeDevice,message:"请输入油箱容量",trigger:"blur"},{pattern:/^(([1-9]\d*)|([0-9]\d*.\d?[1-9]{1,2}))$/,message:"数值不能为0,且小数点后最多三位小数",trigger:"blur"}]}},[i("el-input",{attrs:{size:"small",maxlength:"10",placeholder:"请输入",clearable:""},model:{value:e.ruleForm.oilBoxCapacity,callback:function(t){e.$set(e.ruleForm,"oilBoxCapacity",t)},expression:"ruleForm.oilBoxCapacity"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:"oilBoxCapacityUnit",rules:[{required:2!=e.oilTypeDevice,message:"请选择油箱容量单位",trigger:"change"}]}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},model:{value:e.ruleForm.oilBoxCapacityUnit,callback:function(t){e.$set(e.ruleForm,"oilBoxCapacityUnit",t)},expression:"ruleForm.oilBoxCapacityUnit"}},e._l(e.oilBoxCapacityList,function(e){return i("el-option",{key:e.oilBoxCapacityUnit,attrs:{label:e.oilBoxCapacityUnitDesc,value:e.oilBoxCapacityUnit}})}),1)],1)],1)],1)],1),e._v(" "),i("el-col",{staticStyle:{height:"80px"},attrs:{span:12}},[i("el-form-item",{attrs:{label:"润滑点设备制造商名称",prop:"lubricationPointManufacturer"}},[i("el-input",{staticStyle:{width:"80%"},attrs:{size:"small",maxlength:"50",clearable:"",placeholder:"请输入"},model:{value:e.ruleForm.lubricationPointManufacturer,callback:function(t){e.$set(e.ruleForm,"lubricationPointManufacturer",t)},expression:"ruleForm.lubricationPointManufacturer"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"设备制造商推荐油品",prop:"recommendOilCode"}},[i("el-select",{ref:"deviceRef",attrs:{size:"small",placeholder:"试试搜索：油品名称",clearable:"",filterable:"",remote:"",loading:e.loadingRemote,"remote-method":e.getOilList},on:{change:e.selectRecommendOilName},model:{value:e.ruleForm.recommendOilCode,callback:function(t){e.$set(e.ruleForm,"recommendOilCode",t)},expression:"ruleForm.recommendOilCode"}},[e._l(e.oilList,function(e){return i("el-option",{key:e.code,attrs:{label:e.oilAlias,value:e.code}})}),e._v(" "),i("template",{slot:"empty"},[e.loadingRemote?i("div",{staticStyle:{"text-align":"center",padding:"5px",color:"grey"}},[e._v("\n                        加载中\n                      ")]):i("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center",padding:"5px 0px"}},[e._v("\n                      暂无匹配数据"),i("el-link",{staticStyle:{"margin-left":"10px",color:"#409eff"},on:{click:function(t){return e.createOil("currentName")}}},[e._v("去添加")])],1)])],2)],1)],1)],1),e._v(" "),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:24}},[i("el-form-item",[i("div",{staticStyle:{"margin-bottom":"15px"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("润滑点图片")]),i("span",{staticStyle:{color:"#999"},attrs:{slot:"label"},slot:"label"},[e._v("（支持.png.jpg.svn.gif图片格式）")])]),e._v(" "),i("el-upload",{class:{hide:e.hideUpload||e.imageLubricationList.length>0},attrs:{action:e.uploadUrl,"list-type":"picture-card",limit:"1","file-list":e.imageLubricationList,accept:"image/*","auto-upload":!1,"on-change":e.handleAddLubricatePointFile,"on-remove":e.handleLubricatePointRemove}},[i("i",{staticClass:"el-icon-plus"})])],1)],1)],1),e._v(" "),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:24}},[i("el-form-item",{attrs:{label:"描述",prop:"lubricationPointDesc"}},[i("el-input",{staticStyle:{width:"80%"},attrs:{size:"small",type:"textarea",rows:6,maxlength:"200",placeholder:"请输入","show-word-limit":""},model:{value:e.ruleForm.lubricationPointDesc,callback:function(t){e.$set(e.ruleForm,"lubricationPointDesc",t)},expression:"ruleForm.lubricationPointDesc"}})],1)],1)],1)],1)],1),e._v(" "),i("div",{staticClass:"info-title"},[i("div",{staticClass:"line"}),e._v(" "),i("div",{staticClass:"title"},[e._v("用油信息")])]),e._v(" "),2!=e.oilTypeDevice?i("div",{staticClass:"form-content"},[i("el-form",{ref:"oilRuleForm",attrs:{rules:e.rules,model:e.ruleForm,"label-width":"100px","label-position":"top"}},[i("el-row",{attrs:{gutter:24}},[0==e.showOrHideState?i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"定期或按质换油",prop:"oilChangeMethod",rules:[{required:!0,message:"请选择定期或按质换油",trigger:"change"}]}},[i("el-radio-group",{model:{value:e.ruleForm.oilChangeMethod,callback:function(t){e.$set(e.ruleForm,"oilChangeMethod",t)},expression:"ruleForm.oilChangeMethod"}},[i("el-radio",{attrs:{label:1}},[e._v("定期")]),e._v(" "),i("el-radio",{attrs:{label:2}},[e._v("按质")])],1)],1)],1):e._e()],1),e._v(" "),i("el-row",{attrs:{gutter:24}},[0==e.showOrHideState?i("el-col",{staticStyle:{height:"80px"},attrs:{span:12}},[i("el-form-item",{attrs:{prop:"oilChangePeriod"}},[i("el-col",{staticStyle:{padding:"0",height:"80px"},attrs:{span:11}},[i("el-form-item",{attrs:{prop:"oilChangePeriod",label:"换油周期",rules:[{validator:e.validatePeriodVal(this.ruleForm),trigger:"blur"},{required:!0,message:"请输入换油周期",trigger:"blur"},{pattern:/^[0-9]*[1-9][0-9]*$/,message:"请输入正整数",trigger:"blur"}]}},[i("el-input",{staticClass:"input-with-select",attrs:{size:"small",maxlength:"10",placeholder:"请输入",clearable:""},on:{change:function(t){return e.dateChange("lastOilChangeDate")}},model:{value:e.ruleForm.oilChangePeriod,callback:function(t){e.$set(e.ruleForm,"oilChangePeriod",t)},expression:"ruleForm.oilChangePeriod"}})],1)],1),e._v(" "),i("el-col",{staticStyle:{height:"80px"},attrs:{span:9}},[i("el-form-item",{attrs:{prop:"oilChangePeriodUnit"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},on:{change:function(t){return e.dateChange("lastOilChangeDate")}},model:{value:e.ruleForm.oilChangePeriodUnit,callback:function(t){e.$set(e.ruleForm,"oilChangePeriodUnit",t)},expression:"ruleForm.oilChangePeriodUnit"}},e._l(e.oilChangePeriodList,function(e){return i("el-option",{key:e.oilChangePeriodUnit,attrs:{label:e.oilChangePeriodUnitDesc,value:e.oilChangePeriodUnit}})}),1)],1)],1)],1)],1):e._e(),e._v(" "),0==e.showOrHideState?i("el-col",{staticStyle:{height:"80px"},attrs:{span:12}},[i("el-form-item",{attrs:{label:"上次换油⽇期",prop:"lastOilChangeDate"}},[i("el-date-picker",{staticStyle:{width:"80%"},attrs:{type:"date",size:"small","picker-options":e.expireTimeOption,"value-format":"yyyy-MM-dd",placeholder:"选择日期"},on:{change:function(t){return e.dateChange("lastOilChangeDate")}},model:{value:e.ruleForm.lastOilChangeDate,callback:function(t){e.$set(e.ruleForm,"lastOilChangeDate",t)},expression:"ruleForm.lastOilChangeDate"}})],1)],1):e._e(),e._v(" "),0==e.showOrHideState&&e.ruleForm.lastOilChangeDate?i("el-col",{staticStyle:{height:"80px"},attrs:{span:12}},[i("el-form-item",{attrs:{prop:"fillingQuantity"}},[i("el-col",{staticStyle:{padding:"0"},attrs:{span:11}},[i("el-form-item",{attrs:{prop:"fillingQuantity",label:"上次换油时加注量",rules:[{pattern:/^(([1-9]\d*)|([0-9]\d*.\d?[1-9]{1,2}))$/,message:"数值不能为0,且小数点后最多三位小数",trigger:"blur"}]}},[i("el-input",{staticClass:"input-with-select",attrs:{size:"small",maxlength:"6",placeholder:"请输入",clearable:""},model:{value:e.ruleForm.fillingQuantity,callback:function(t){e.$set(e.ruleForm,"fillingQuantity",t)},expression:"ruleForm.fillingQuantity"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:"fillingQuantityUnit"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},model:{value:e.ruleForm.fillingQuantityUnit,callback:function(t){e.$set(e.ruleForm,"fillingQuantityUnit",t)},expression:"ruleForm.fillingQuantityUnit"}},e._l(e.oilBoxCapacityList,function(e){return i("el-option",{key:e.oilBoxCapacityUnit,attrs:{label:e.oilBoxCapacityUnitDesc,value:e.oilBoxCapacityUnit}})}),1)],1)],1)],1)],1):e._e(),e._v(" "),0==e.showOrHideState&&e.ruleForm.lastOilChangeDate&&e.ruleForm.oilChangePeriod&&1==e.ruleForm.oilChangeMethod&&"KM"!=e.ruleForm.oilChangePeriodUnit?i("el-col",{staticStyle:{height:"80px"},attrs:{span:12}},[i("el-form-item",{attrs:{label:"是否自动生成下次换油计划？",prop:"autoCreateOilChangePlan"}},[i("el-radio-group",{model:{value:e.ruleForm.autoCreateOilChangePlan,callback:function(t){e.$set(e.ruleForm,"autoCreateOilChangePlan",t)},expression:"ruleForm.autoCreateOilChangePlan"}},[i("el-radio",{attrs:{label:!0}},[e._v("是")]),e._v(" "),i("el-radio",{attrs:{label:!1}},[e._v("否")])],1)],1)],1):e._e(),e._v(" "),0==e.showOrHideState&&e.ruleForm.autoCreateOilChangePlan&&e.ruleForm.oilChangeMethod&&e.ruleForm.lastOilChangeDate&&1==e.ruleForm.oilChangeMethod&&e.ruleForm.oilChangePeriod&&"KM"!=e.ruleForm.oilChangePeriodUnit?i("el-col",{staticStyle:{height:"80px"},attrs:{span:12}},[i("el-form-item",{attrs:{label:"预计下次换油日期",prop:"nextScheduledOilChangeDate"}},[i("el-date-picker",{staticStyle:{width:"80%"},attrs:{type:"date",size:"small","picker-options":e.pickerBeginDateBefore,"value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:e.ruleForm.nextScheduledOilChangeDate,callback:function(t){e.$set(e.ruleForm,"nextScheduledOilChangeDate",t)},expression:"ruleForm.nextScheduledOilChangeDate"}})],1)],1):e._e()],1),e._v(" "),i("el-row",{attrs:{gutter:24}},[i("el-col",{attrs:{span:12}},[i("el-col",{staticStyle:{padding:"0",height:"80px"},attrs:{span:11}},[i("el-form-item",{attrs:{prop:"oilAddPeriod",label:"加油周期",rules:[{pattern:/^[0-9]*[1-9][0-9]*$/,message:"请输入正整数",trigger:"blur"}]}},[i("el-input",{staticClass:"input-with-select",attrs:{size:"small",maxlength:"10",placeholder:"请输入",clearable:""},on:{change:function(t){return e.dateChange("lastOilAddDate")}},model:{value:e.ruleForm.oilAddPeriod,callback:function(t){e.$set(e.ruleForm,"oilAddPeriod",t)},expression:"ruleForm.oilAddPeriod"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:"oilAddPeriodUnit"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},on:{change:function(t){return e.dateChange("lastOilAddDate")}},model:{value:e.ruleForm.oilAddPeriodUnit,callback:function(t){e.$set(e.ruleForm,"oilAddPeriodUnit",t)},expression:"ruleForm.oilAddPeriodUnit"}},e._l(e.oilChangePeriodList,function(e){return i("el-option",{key:e.oilChangePeriodUnit,attrs:{label:e.oilChangePeriodUnitDesc,value:e.oilChangePeriodUnit}})}),1)],1)],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"上次加油⽇期",prop:"lastOilAddDate"}},[i("el-date-picker",{staticStyle:{width:"80%"},attrs:{type:"date",size:"small","picker-options":e.expireTimeOption,"value-format":"yyyy-MM-dd",placeholder:"选择日期"},on:{change:function(t){return e.dateChange("lastOilAddDate")}},model:{value:e.ruleForm.lastOilAddDate,callback:function(t){e.$set(e.ruleForm,"lastOilAddDate",t)},expression:"ruleForm.lastOilAddDate"}})],1)],1)],1),e._v(" "),i("el-row",{attrs:{gutter:24}},[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{prop:"everyTimeOilAddQuantity"}},[i("el-col",{staticStyle:{padding:"0"},attrs:{span:11}},[i("el-form-item",{attrs:{prop:"everyTimeOilAddQuantity",label:"每次加油量",rules:[{pattern:/^(([1-9]\d*)|([0-9]\d*.\d?[1-9]{1,2}))$/,message:"数值不能为0,且小数点后最多三位小数",trigger:"blur"}]}},[i("el-input",{staticClass:"input-with-select",attrs:{size:"small",maxlength:"6",placeholder:"请输入",clearable:""},model:{value:e.ruleForm.everyTimeOilAddQuantity,callback:function(t){e.$set(e.ruleForm,"everyTimeOilAddQuantity",t)},expression:"ruleForm.everyTimeOilAddQuantity"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:"everyTimeOilAddQuantityUnit"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},model:{value:e.ruleForm.everyTimeOilAddQuantityUnit,callback:function(t){e.$set(e.ruleForm,"everyTimeOilAddQuantityUnit",t)},expression:"ruleForm.everyTimeOilAddQuantityUnit"}},e._l(e.oilBoxCapacityList,function(e){return i("el-option",{key:e.oilBoxCapacityUnit,attrs:{label:e.oilBoxCapacityUnitDesc,value:e.oilBoxCapacityUnit}})}),1)],1)],1)],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{prop:"preMonthOilAddQuantity"}},[i("el-col",{staticStyle:{padding:"0"},attrs:{span:11}},[i("el-form-item",{attrs:{prop:"preMonthOilAddQuantity",label:"每月润滑剂添加量",rules:[{pattern:/^(([1-9]\d*)|([0-9]\d*.\d?[1-9]{1,2}))$/,message:"数值不能为0,且小数点后最多三位小数",trigger:"blur"},{required:1==e.showOrHideState,message:"请输入每月润滑剂添加量",trigger:"blur"}]}},[i("el-input",{staticClass:"input-with-select",attrs:{size:"small",maxlength:"6",placeholder:"请输入",clearable:""},model:{value:e.ruleForm.preMonthOilAddQuantity,callback:function(t){e.$set(e.ruleForm,"preMonthOilAddQuantity",t)},expression:"ruleForm.preMonthOilAddQuantity"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:"preMonthOilAddQuantityUnit"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},model:{value:e.ruleForm.preMonthOilAddQuantityUnit,callback:function(t){e.$set(e.ruleForm,"preMonthOilAddQuantityUnit",t)},expression:"ruleForm.preMonthOilAddQuantityUnit"}},e._l(e.oilBoxCapacityList,function(e){return i("el-option",{key:e.oilBoxCapacityUnit,attrs:{label:e.oilBoxCapacityUnitDesc,value:e.oilBoxCapacityUnit}})}),1)],1)],1)],1)],1)],1),e._v(" "),i("el-row",{attrs:{gutter:24}},[e.ruleForm.oilAddPeriod&&e.ruleForm.lastOilAddDate&&"KM"!=e.ruleForm.oilAddPeriodUnit?i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"是否自动生成下次加油计划？",prop:"autoCreateOilAddPlan"}},[i("el-radio-group",{model:{value:e.ruleForm.autoCreateOilAddPlan,callback:function(t){e.$set(e.ruleForm,"autoCreateOilAddPlan",t)},expression:"ruleForm.autoCreateOilAddPlan"}},[i("el-radio",{attrs:{label:!0}},[e._v("是")]),e._v(" "),i("el-radio",{attrs:{label:!1}},[e._v("否")])],1)],1)],1):e._e(),e._v(" "),e.ruleForm.autoCreateOilAddPlan&&e.ruleForm.lastOilAddDate&&e.ruleForm.oilAddPeriod&&"KM"!=e.ruleForm.oilAddPeriodUnit?i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"预计下次加油日期",prop:"nextScheduledOilAddDate"}},[i("el-date-picker",{staticStyle:{width:"80%"},attrs:{type:"date","picker-options":e.pickerBeginDateBefore,size:"small","value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:e.ruleForm.nextScheduledOilAddDate,callback:function(t){e.$set(e.ruleForm,"nextScheduledOilAddDate",t)},expression:"ruleForm.nextScheduledOilAddDate"}})],1)],1):e._e()],1)],1)],1):e._e(),e._v(" "),2==e.oilTypeDevice?i("div",{staticClass:"form-content"},[i("el-form",{ref:"oilRuleForm",attrs:{rules:e.rules,model:e.ruleForm,"label-width":"100px","label-position":"top"}},[i("el-row",{attrs:{gutter:24}},[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{prop:"oilAddPeriod"}},[i("el-col",{staticStyle:{padding:"0"},attrs:{span:11}},[i("el-form-item",{attrs:{prop:"oilAddPeriod",label:"加脂周期",rules:[{pattern:/^[0-9]*[1-9][0-9]*$/,message:"请输入正整数",trigger:"blur"}]}},[i("el-input",{staticClass:"input-with-select",attrs:{size:"small",maxlength:"10",placeholder:"请输入",clearable:""},on:{change:function(t){return e.dateChange("lastOilAddDate2")}},model:{value:e.ruleForm.oilAddPeriod,callback:function(t){e.$set(e.ruleForm,"oilAddPeriod",t)},expression:"ruleForm.oilAddPeriod"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:"oilAddPeriodUnit"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},on:{change:function(t){return e.dateChange("lastOilAddDate2")}},model:{value:e.ruleForm.oilAddPeriodUnit,callback:function(t){e.$set(e.ruleForm,"oilAddPeriodUnit",t)},expression:"ruleForm.oilAddPeriodUnit"}},e._l(e.oilChangePeriodList,function(e){return i("el-option",{key:e.oilChangePeriodUnit,attrs:{label:e.oilChangePeriodUnitDesc,value:e.oilChangePeriodUnit}})}),1)],1)],1)],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{prop:"everyTimeOilAddQuantity"}},[i("el-col",{staticStyle:{padding:"0"},attrs:{span:11}},[i("el-form-item",{attrs:{prop:"everyTimeOilAddQuantity",label:"每次加脂量",rules:[{pattern:/^(([1-9]\d*)|([0-9]\d*.\d?[1-9]{1,2}))$/,message:"数值不能为0,且小数点后最多三位小数",trigger:"blur"}]}},[i("el-input",{staticClass:"input-with-select",attrs:{size:"small",maxlength:"6",placeholder:"请输入",clearable:""},model:{value:e.ruleForm.everyTimeOilAddQuantity,callback:function(t){e.$set(e.ruleForm,"everyTimeOilAddQuantity",t)},expression:"ruleForm.everyTimeOilAddQuantity"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:"everyTimeOilAddQuantityUnit"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},model:{value:e.ruleForm.everyTimeOilAddQuantityUnit,callback:function(t){e.$set(e.ruleForm,"everyTimeOilAddQuantityUnit",t)},expression:"ruleForm.everyTimeOilAddQuantityUnit"}},e._l(e.oilBoxCapacityList,function(e){return i("el-option",{key:e.oilBoxCapacityUnit,attrs:{label:e.oilBoxCapacityUnitDesc,value:e.oilBoxCapacityUnit}})}),1)],1)],1)],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{prop:"preMonthOilAddQuantity"}},[i("el-col",{staticStyle:{padding:"0"},attrs:{span:11}},[i("el-form-item",{attrs:{prop:"preMonthOilAddQuantity",label:"每月润滑剂添加量",rules:[{pattern:/^(([1-9]\d*)|([0-9]\d*.\d?[1-9]{1,2}))$/,message:"数值不能为0,且小数点后最多三位小数",trigger:"blur"},{required:!0,message:"请输入每月润滑剂添加量",trigger:"blur"}]}},[i("el-input",{staticClass:"input-with-select",attrs:{size:"small",maxlength:"6",placeholder:"请输入",clearable:""},model:{value:e.ruleForm.preMonthOilAddQuantity,callback:function(t){e.$set(e.ruleForm,"preMonthOilAddQuantity",t)},expression:"ruleForm.preMonthOilAddQuantity"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:9}},[i("el-form-item",{attrs:{prop:"preMonthOilAddQuantityUnit"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("单位")]),e._v(" "),i("el-select",{attrs:{size:"small",clearable:""},model:{value:e.ruleForm.preMonthOilAddQuantityUnit,callback:function(t){e.$set(e.ruleForm,"preMonthOilAddQuantityUnit",t)},expression:"ruleForm.preMonthOilAddQuantityUnit"}},e._l(e.oilBoxCapacityList,function(e){return i("el-option",{key:e.oilBoxCapacityUnit,attrs:{label:e.oilBoxCapacityUnitDesc,value:e.oilBoxCapacityUnit}})}),1)],1)],1)],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"上次加脂⽇期",prop:"lastOilAddDate"}},[i("el-date-picker",{staticStyle:{width:"80%"},attrs:{type:"date",size:"small","picker-options":e.expireTimeOption,"value-format":"yyyy-MM-dd",placeholder:"选择日期"},on:{change:function(t){return e.dateChange("lastOilAddDate2")}},model:{value:e.ruleForm.lastOilAddDate,callback:function(t){e.$set(e.ruleForm,"lastOilAddDate",t)},expression:"ruleForm.lastOilAddDate"}})],1)],1)],1),e._v(" "),i("el-row",{attrs:{gutter:24}},[e.ruleForm.lastOilAddDate&&e.ruleForm.oilAddPeriod&&"KM"!=e.ruleForm.oilAddPeriodUnit?i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"是否自动生成下次加脂计划？",prop:"autoCreateOilAddPlan"}},[i("el-radio-group",{model:{value:e.ruleForm.autoCreateOilAddPlan,callback:function(t){e.$set(e.ruleForm,"autoCreateOilAddPlan",t)},expression:"ruleForm.autoCreateOilAddPlan"}},[i("el-radio",{attrs:{label:!0}},[e._v("是")]),e._v(" "),i("el-radio",{attrs:{label:!1}},[e._v("否")])],1)],1)],1):e._e(),e._v(" "),i("el-col",{attrs:{span:12}},[e.ruleForm.lastOilAddDate&&e.ruleForm.oilAddPeriod&&e.ruleForm.autoCreateOilAddPlan&&"KM"!=e.ruleForm.oilAddPeriodUnit?i("el-form-item",{attrs:{label:"预计下次加脂日期",prop:"nextScheduledOilAddDate"}},[i("el-date-picker",{staticStyle:{width:"80%"},attrs:{type:"date","picker-options":e.pickerBeginDateBefore,size:"small","value-format":"yyyy-MM-dd",placeholder:"选择日期"},model:{value:e.ruleForm.nextScheduledOilAddDate,callback:function(t){e.$set(e.ruleForm,"nextScheduledOilAddDate",t)},expression:"ruleForm.nextScheduledOilAddDate"}})],1):e._e()],1)],1)],1)],1):e._e()]):e._e()]),e._v(" "),i("div",{staticStyle:{margin:"30px 0"},attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"danger",plain:"",size:"small"},on:{click:e.handleResetFrom}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"danger",size:"small"},on:{click:e.handleSubmitForm}},[e._v("保存")])],1)]),e._v(" "),i("el-dialog",{attrs:{title:"自定义设备类型",visible:e.createDeviceFlag,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.createDeviceFlag=t}}},[i("el-form",{ref:"addDeviceRef",staticClass:"demo-ruleForm",attrs:{model:e.addDeviceForm,rules:e.addDeviceRules}},[i("el-form-item",{attrs:{prop:"name"}},[i("el-input",{attrs:{size:"small",clearable:"",maxlength:"25"},model:{value:e.addDeviceForm.name,callback:function(t){e.$set(e.addDeviceForm,"name",t)},expression:"addDeviceForm.name"}})],1)],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){return e.cancelAdd("addDeviceRef")}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){return e.completeAdd("addDeviceRef")}}},[e._v("完 成")])],1)],1),e._v(" "),i("AddOil",{ref:"LupDialogRef",attrs:{addOilDialog:e.addOilDialog,addType:e.addType,addOilForm:e.addOilForm},on:{addOrEditOil:e.addOrEditOil,closeDialogAdd:e.closeDialogAdd}}),e._v(" "),i("SyncLub",{attrs:{dialogFlag:e.showSyncLubDialog,tipsData:e.tipsData},on:{closeSyncLubDialog:e.closeSyncLubDialog}})],1)};w._withStripped=!0;var O={render:w,staticRenderFns:[]},L=O;var B=!1;var T=i("VU/8")(x,L,!1,function(e){B||i("73cQ")},"data-v-6b3fd997",null);T.options.__file="src/components/spotInspection/components/addDevice.vue";var A,k=T.exports,S=i("q9Tq"),N=i("8qGi"),M={components:{CreateDevice:S.a,CreateLubricationPoint:N.a,LupDialog:C,addDevice:k,SyncLub:D.a},props:(A={chooseDeviceAndLupDialog:{type:Boolean,default:function(){return!1}},singleFlag:{type:Boolean,default:function(){return!1}},checkedDevice:{type:Array,default:function(){return[]}},urlType:{type:String,default:function(){return""}},workShopId:{type:String,default:function(){return""}},companyId:{type:String,default:function(){return""}},actionType:{type:Number,default:function(){return 0}},companyName:{type:String,default:function(){return""}},companyNumber:{type:String,default:function(){return""}},actionTargets:{type:Array,default:function(){return[]}},taskType:{type:String,default:function(){return""}}},c()(A,"companyNumber",{type:String,default:function(){return""}}),c()(A,"selectMax",{type:Number,default:function(){return 100}}),c()(A,"workshopId",{type:Number,default:function(){return null}}),c()(A,"plantStudyServiceFlag",{type:Boolean,default:function(){return!1}}),c()(A,"reportType",{type:Number,default:function(){return 0}}),c()(A,"abnormalDeviceId",{type:String,default:function(){return""}}),c()(A,"isPlantStudyServiceFlag",{type:Boolean,default:function(){return!1}}),c()(A,"coreDataTemplateId",{type:Number,default:null}),c()(A,"serviceNumber",{type:String,default:""}),c()(A,"checkedDeviceId",{type:String,default:""}),c()(A,"checkedlubricationPointNumber",{type:String,default:""}),A),watch:{checkedDevice:{handler:function(e,t){var i=this;if(e){var o=[];this.lupTableData.map(function(t){i.$set(t,"checkList",[]),t.lubPointDtoList.map(function(i){e.map(function(e){i.lubricationPointNumber==e&&(t.checkList.push(e),o.push(i))})})}),this.checkedDevice=e}},deep:!0,immediate:!0},chooseDeviceAndLupDialog:function(e,t){e&&(this.firstLoadFlag=!0,this.addDeviceDialogFlag=!1,this.resetSearch(),this.getGroupTree(),this.getWorkshopList(),this.getTemplateFitter())}},data:function(){return{customerObj:{},checkDeviceObj:{},selectLubricationPointNumber:"",addDeviceDialog:!1,deviceTypeDialog:"",addLubricationPointDialog:!1,tipsData:{},showSyncLubDialog:!1,searchForm:{deviceName:"",deviceType:[],groupId:[],devicePosition:"",workshopId:"",deviceCode:""},distributionPerson:{},chooseTranferWorkshopDialog:!1,resultNotice:!1,lumSearch:"",workshopSearch:"",checkedLumNew:[],checkDeviceData:[],workshopList:[],loadingDevice:!1,loadMoreDeviceFlag:!1,loadMoreLumPointFlag:!1,loadMoreWorkshopFlag:!1,deviceListTotal:0,lupTableTotal:0,deviceCurrent:1,deviceTypeList:[],templateFitter:!1,groupList:[],userInfo:JSON.parse(this.Decrypt(sessionStorage.getItem("userInfo"))),deviceTableData:[],deviceTotal:0,radioDeviceRow:{},radioLupRow:{},chooseLupDialog:!1,lupTableData:[],tempCheckLupList:[],addLupDialogFlag:!1,addDeviceDialogFlag:!1,addLupForm:{},recommendOilCodeKey:1,addLupImgList:[],lubricationPointTypeList:[],oilBrandList:[],oilChangePeriodList:[],oilBoxCapacityList:[{oilBoxCapacityUnit:"L",oilBoxCapacityUnitDesc:"L"},{oilBoxCapacityUnit:"KG",oilBoxCapacityUnitDesc:"KG"}],methodsList:[{value:"循环",label:"循环"},{value:"飞溅",label:"飞溅"},{value:"喷射",label:"喷射"},{value:"手刷",label:"手刷"},{value:"油枪",label:"油枪"}],oilList:[],loadingLup:!1,firstLoadFlag:!1,checkedAddLum:{},lubPointCurrent:1,lupDeviceNameList:[],workshopId:"",loadingPerson:!1,workshopData:[],workshopTotal:0,workshopCurrent:1}},created:function(){this.getDeviceTypeList(),this.getlubricationpointType(),this.getQueryOilList(),this.getOilChangePeriodData(),this.getOilList("")},methods:{addOrEditDevice:function(){this.getDeviceData("refresh"),this.addDeviceDialog=!1},addOrEditDeviceAndLumpoint:function(){this.getDeviceData("refresh"),this.addDeviceDialog=!1},closeDialogAddDevice:function(){this.addDeviceDialog=!1},clickAddDevice:function(){this.customerObj={companyName:this.companyName,companyNumber:this.companyNumber,companyId:this.companyId},this.deviceTypeDialog="addDeviceAndLubpoint",this.addDeviceDialog=!0},closeSyncLubDialog:function(){this.showSyncLubDialog=!1,this.successNext()},createLup:function(e){this.checkDeviceObj=e,this.deviceTypeDialog="addLumPoint",this.addLubricationPointDialog=!0},addOrEditLup:function(){this.addLubricationPointDialog=!1,this.successNext()},closeDialogAddLubPoint:function(){this.addLubricationPointDialog=!1},handleDistributionnChange:function(e){this.workshopId=e.workshopId},getWorkshopList:function(){var e=this,t={companyId:this.companyId,workshopName:"",current:1,size:300};this.requestMethodGet("/weChat/workshop/queryWorkshopListByPage",t).then(function(t){if(1e3==t.data.code){var i=t.data.data.list||[];e.workshopList=i,e.workshopId&&(e.searchForm.workshopId=e.workshopId)}else e.$message({message:t.data.msg,type:"error"})})},getOilList:function(e){var t=this;this.requestMethodGet("/mdm/oil/queryOilListByPage",{oilName:e,status:1,size:200,current:1}).then(function(e){1e3==e.data.code?t.oilList=e.data.data.list:t.$message({message:e.data.msg,type:"error"})})},formatData1:function(e){for(var t=0;t<e.length;t++)e[t].children&&0!=e[t].children.length?this.formatData1(e[t].children):e[t].children=null;return e},getOilChangePeriodData:function(){var e=this;this.requestMethodGet("/web/device/getOilChangePeriodUnitConfig").then(function(t){if(1e3==(t=t.data).code){if(t.data&&t.data.length>0){var i=t.data;i=i.map(function(e){return{oilChangePeriodUnit:e.oilChangePeriodUnit,oilChangePeriodUnitDesc:e.oilChangePeriodUnitDesc}}),e.oilChangePeriodList=i}}else e.$message({message:t.msg,type:"warning"})}).catch(function(e){})},getQueryOilList:function(){var e=this;this.requestMethodGet("/mdm/oil/queryOilList",{parentCode:0,status:1}).then(function(t){if(1e3==(t=t.data).code){if(t.data&&t.data.length>0){var i=t.data;i=i.map(function(e){return{value:e.code,label:e.name}}),e.oilBrandList=i}}else e.$message({message:t.msg,type:"warning"})}).catch(function(e){})},getlubricationpointType:function(){var e=this;this.requestMethodGet("/web/customer/getIndustryTreeList",{parentCode:"lubrication_point_type"}).then(function(t){1e3==(t=t.data).code?t.data&&t.data.length>0&&(e.lubricationPointTypeList=t.data):e.$message({message:t.msg,type:"warning"})}).catch(function(e){})},successNext:function(){this.addLupDialogFlag=!1;var e=[];this.lupTableData.map(function(t){t.lubPointDtoList.map(function(i){t.checkList.map(function(t){i.lubricationPointNumber==t&&e.push(i)})})}),this.checkedLumNew=this.checkedLumNew.concat(e),this.lubPointCurrent=1,this.queryLubPointByDevice()},closeDialog:function(){this.addLupDialogFlag=!1},rowKey:function(e){return e.deviceId},getDeviceTypeList:function(){var e=this;this.requestMethodGet("/weChat/device/queryAllDeviceTypeTree4",{filterFlag:!0}).then(function(t){1e3==t.data.code?e.deviceTypeList=t.data.data:e.$message({message:t.data.msg,type:"error"})})},getGroupTree:function(){var e=this,t={companyId:this.$userInfo.orgInfo.companyId};this.requestMethodGet("/weChat/deviceGroup/getDeviceGroupTree",t).then(function(t){1e3==t.data.code?e.groupList=t.data.data:e.$message({message:t.data.msg,type:"error"})})},getDeviceData:function(e){var t=this;e&&(this.deviceCurrent=1,this.checkDeviceData=[]);var i=s()({size:30,current:this.deviceCurrent},this.searchForm);i.deviceType.length?i.deviceType=i.deviceType[i.deviceType.length-1]:i.deviceType="",i.groupId.length?i.groupId=i.groupId[i.groupId.length-1]:i.groupId="",i.companyId=this.companyId,this.workshopId&&this.firstLoadFlag&&(i.workshopId=this.workshopId,this.firstLoadFlag=!1),this.loadingDevice=!0;var o="";"workOrder"==this.urlType||"workOrderReport"==this.urlType?(i.companyNumber=this.companyNumber,i.workshopId=this.workshopId,i.plantStudyServiceFlag=this.plantStudyServiceFlag,i.reportType=this.reportType,i.coreDataTemplateId=this.coreDataTemplateId,i.serviceNumber=this.serviceNumber,o="/workOrder/getDeviceByCompany"):"MSLAWorkOrder"==this.urlType||"lubrTable"==this.urlType?o="/web/device/queryAllDeviceByPage":"createPopOrRop"==this.urlType||"parameter"==this.urlType?(i.companyNumber=this.companyNumber,o="/workOrder/getDeviceByCompany"):"workshop"==this.urlType&&(i.companyNumber=this.companyNumber,i.workshopId=this.workShopId,o="/web/device/deviceListOfAccount"),i.userId=this.$userInfo.userId,o="customize/form/record/deviceList",this.requestMethodPost(o,i).then(function(i){if(1e3==i.data.code){var o=[];e?(t.$refs.deviceTableRef.clearSelection(),o=i.data.data.list):o=t.deviceTableData.concat(i.data.data.list),o.length&&o.forEach(function(e){_.isEmpty(e.checkItemIds)?e.checkItemIdsList=[]:e.checkItemIdsList=e.checkItemIds.indexOf(",")>-1?e.checkItemIds.split(","):[e.checkItemIds]}),t.deviceTableData=o,t.deviceTotal=i.data.data.totalCount,t.$nextTick(function(){t.checkedDeviceId&&t.deviceTableData.some(function(e,i){if(e.id==t.checkedDeviceId)return t.$refs.deviceTableRef.toggleRowSelection(e,!0),t.checkDeviceData=[{id:t.checkedDeviceId}],!0})}),t.deviceTableData.length<t.deviceTotal?t.loadMoreDeviceFlag=!0:t.loadMoreDeviceFlag=!1,t.loadingDevice=!1}else t.$message({message:i.data.msg,type:"error"})})},getTemplateFitter:function(){var e=this,t={reportType:this.reportType};t.templateId=this.coreDataTemplateId,t.serviceNumber=this.serviceNumber,this.requestMethodGet("/workOrder/getTemplateFitter",t).then(function(t){1e3==t.data.code?e.templateFitter=t.data.data:e.$message({message:t.data.msg,type:"warning"})})},checkSelectable:function(e,t){return"createTask"!=this.urlType||!_.isEmpty(e.checkItemIds)},loadMore:function(){this.loadMoreDeviceFlag&&this.deviceTableData.length<this.deviceTotal&&(++this.deviceCurrent,this.getDeviceData())},resetSearch:function(){for(var e in this.searchForm)this.searchForm[e]="";this.searchForm.deviceType=[],this.searchForm.groupId=[],this.getDeviceData("refresh")},handleSelectDevice:function(e,t){if(1==e.length)return this.checkDeviceData=[t];var i=e.shift();this.$refs.deviceTableRef.toggleRowSelection(i,!1),this.checkDeviceData=[t]},handleCellClick:function(e){var t=this;e.disabled||this.$refs.deviceTableRef.toggleRowSelection(e),this.checkDeviceData.map(function(e){return e.id}).includes(e.id)?this.checkDeviceData.forEach(function(i,o){i.id==e.id&&t.checkDeviceData.splice(o,1)}):this.checkDeviceData.push(e)},selectAllDevice:function(e){this.checkDeviceData=e},cancelChoose:function(){this.checkDeviceData=[],this.$emit("cancelChooseDeviceAndLup")},lumSearchChange:function(){var e=[];this.lupTableData.map(function(t){t.lubPointDtoList.map(function(i){t.checkList.map(function(t){i.lubricationPointNumber==t&&e.push(i)})})}),this.checkedLumNew=e,this.lubPointCurrent=1,this.lupTableData=[],this.queryLubPointByDevice("search")},workShopSearch:function(){this.workshopCurrent=1,this.workshopData=[],this.queryWorkShopList("search")},nextChooseLup:function(){this.checkDeviceData.length?"workshop"!=this.urlType?(this.checkedLumNew=[],this.lubPointCurrent=1,this.lumSearch="",this.queryLubPointByDevice()):(this.chooseTranferWorkshopDialog=!0,this.workshopCurrent=1,this.queryWorkShopList()):this.$message({type:"warning",message:"请选择设备"})},getLupDeviceNameList:function(e){var t=this,i={deviceCode:e,lubPointName:"",status:1,current:1,size:100};this.lupDeviceNameList=[],this.requestMethodGet("/device/coreDeviceLubPoint/pageList",i).then(function(e){if(1e3==e.data.code){var i=e.data.data.list||[];i.length&&i.forEach(function(e){e.isCustomFlag=!1});i.push({lubPointName:"自定义",isCustomFlag:!0}),t.lupDeviceNameList=i}else t.$message({message:e.data.msg,type:"error"})})},loadMoreLumPoint:function(){this.loadMoreLumPointFlag&&this.lupTableData.length<this.lupTableTotal&&(++this.lubPointCurrent,this.queryLubPointByDevice("scroll"))},loadMoreWorkshop:function(){this.loadMoreWorkshopFlag&&this.workshopData.length<this.workshopTotal&&(++this.workshopCurrent,this.queryWorkShopList("scroll"))},queryWorkShopList:function(e){var t=this,i={companyId:this.companyId,noWorkShopFlag:!0,current:this.workshopCurrent,size:20,workshopName:this.workshopSearch};this.loadingPerson=!0,this.requestMethodGet("/weChat/workshop/queryWorkshopListByPage",i).then(function(i){if(1e3==i.data.code){t.loadingPerson=!1;var o=i.data.data.list||[];t.workshopTotal=i.data.data.totalCount,t.workshopData=e?t.workshopData.concat(o):o,t.workshopData.length<t.workshopTotal?t.loadMoreWorkshopFlag=!0:t.loadMoreWorkshopFlag=!1}else t.loadingPerson=!1,t.$message({message:i.data.msg,type:"error"})})},queryLubPointByDevice:function(e){var t=this,i=[];this.checkDeviceData.forEach(function(e){i.push(e.id)});var o,a={};a.deviceIds=i.toString(),a.current=this.lubPointCurrent,a.size=10,a.searchCondition=this.lumSearch,a.reportType=this.reportType,a.serviceNumber=this.serviceNumber,a.templateId=this.coreDataTemplateId,o="/workOrder/getLubPointByDevice",this.loadingLup=!0,this.requestMethodGet(o,a).then(function(i){1e3==i.data.code?(t.chooseLupDialog=!0,t.loadingLup=!1,i.data.data.list.length>0&&i.data.data.list.map(function(e){t.$set(e,"checkList",[])}),t.lupTableData=e?t.lupTableData.concat(i.data.data.list):i.data.data.list,t.lumSearch?t.resultNotice=!0:t.resultNotice=!1,t.lupTableTotal=i.data.data.totalCount,t.lupTableData.length<t.lupTableTotal?t.loadMoreLumPointFlag=!0:t.loadMoreLumPointFlag=!1,"MSLAWorkOrder"==t.urlType?t.lupTableData.map(function(e){e.lubPointDtoList.map(function(i){t.checkedDevice.map(function(t){i.lubricationPointId==t.id&&(e.checkList.push(i.lubricationPointNumber),i.disabled=!0)}),t.checkedLumNew.length>0&&t.checkedLumNew.map(function(t){i.lubricationPointNumber==t.lubricationPointNumber&&e.checkList.push(t.lubricationPointNumber)})})}):t.lupTableData.map(function(e){e.lubPointDtoList.map(function(i){t.checkedDevice.map(function(t){i.lubricationPointNumber==t.lubricationPointNumber&&(e.checkList.push(t.lubricationPointNumber),i.disabled=!0)}),t.checkedLumNew.length>0&&t.checkedLumNew.map(function(t){i.lubricationPointNumber==t.lubricationPointNumber&&e.checkList.push(t.lubricationPointNumber)})})}),t.checkedlubricationPointNumber&&(t.lupTableData[0].checkList=[t.checkedlubricationPointNumber])):t.$message({message:i.data.msg,type:"error"})})},cancelChooseLup:function(){this.lumSearch="",this.chooseLupDialog=!1},cancelChooseWorkshop:function(){this.distributionPerson={},this.workshopSearch="",this.chooseTranferWorkshopDialog=!1},upStep:function(){"workshop"!=this.urlType?(this.tempCheckLupList=[],this.radioLupRow={},this.chooseLupDialog=!1):(this.workshopSearch="",this.distributionPerson={},this.chooseTranferWorkshopDialog=!1)},tanferWorkshop:function(e){var t=this;this.requestMethodPost("/weChat/workshop/changeDeviceWorkshopBatch",e).then(function(e){1e3==e.data.code?(t.$message({type:"success",message:"设备转移成功"}),t.chooseTranferWorkshopDialog=!1,t.$emit("confirmTranfer")):t.$message({message:e.data.msg,type:"error"}),t.$gio.Clicktotransferdevice({entrance:"选择设备页"})})},confirmChoose:function(){var e=this;return r()(a.a.mark(function t(){var i,o,l,r,n;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("workshop"!=e.urlType){t.next=10;break}if(e.workshopId){t.next=4;break}return e.$message({type:"error",message:"请选择车间"}),t.abrupt("return");case 4:i=[],e.checkDeviceData.forEach(function(e){i.push(e.deviceNumber)}),o={companyId:e.companyId,workshopId:e.workshopId,deviceNumberList:i},e.requestMethodPost("/weChat/workshop/getNoMoveDevice",o).then(function(t){if(1e3==t.data.code){var o=t.data.data,a={companyId:e.companyId,workshopId:e.workshopId};if(o.canEditFlag)a.deviceNumberList=i,e.tanferWorkshop(a);else{var l="";l=0!=o.moveCount?"有"+o.noMoveCount+"台设备无法变更车间，是否要转移剩余的"+o.moveCount+"台设备":"您所选的"+o.noMoveCount+"台设备均无法变更车间。",e.$confirm(l,"",{confirmButtonText:0!=o.moveCount?"确定":"知道了",cancelButtonText:"取消",showCancelButton:0!=o.moveCount,type:"warning"}).then(function(){0!=o.moveCount&&(a.deviceNumberList=o.moveList,e.tanferWorkshop(a))}).catch(function(){})}}else e.$message({message:t.data.msg,type:"error"})}),t.next=25;break;case 10:if(l=[],e.lupTableData.map(function(e){e.lubPointDtoList.map(function(t){e.checkList.map(function(e){t.lubricationPointNumber==e&&l.push(t)})})}),l.length){t.next=15;break}return e.$message({type:"error",message:"请至少选择一个润滑点"}),t.abrupt("return");case 15:if(r=0,l.forEach(function(e){e.disabled&&r++}),!(l.length>e.selectMax+r)){t.next=20;break}return e.$message({type:"error",message:"最多可再添加"+e.selectMax+"个润滑点"}),t.abrupt("return");case 20:return n=e.checkedDevice.concat(l),t.next=23,e.handleIcon(n);case 23:e.chooseLupDialog=!1,"MSLAWorkOrder"==e.urlType||"lubrTable"==e.urlType?(e.checkedDevice.forEach(function(e,t){l.forEach(function(t,i){t.lubricationPointId==e.id&&l.splice(i,1)})}),e.$emit("confirmChooseLup",l),e.tempCheckLupList=[]):(e.$emit("confirmChooseLup",_.uniqBy(n,"lubricationPointNumber")),e.tempCheckLupList=[]);case 25:case"end":return t.stop()}},t,e)}))()},handleIcon:function(e){var t=this;return r()(a.a.mark(function i(){var o,l;return a.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:for(o=0;o<e.length;o++)(l=e[o]).lubricationPointPicPath&&t.getFullUrl(l);case 1:case"end":return i.stop()}},i,t)}))()},getFullUrl:function(e){var t=this,i={url:e.lubricationPointPicPath};this.requestMethodGet("/web/file/getFullUrl",i).then(function(i){1e3==i.data.code?t.$set(e,"lubricationPointPicPathFull",i.data.data):t.$message({message:i.data.msg,type:"warning"})})},changeSelLubPoint:function(e,t){t.checkList=[e.pop()]},cellClass:function(e){if(0==e.columnIndex)return"table-header-line"}}},U=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{position:"relative"}},[i("el-dialog",{attrs:{visible:e.chooseDeviceAndLupDialog,width:"70%","append-to-body":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.cancelChoose},on:{"update:visible":function(t){e.chooseDeviceAndLupDialog=t}},scopedSlots:e._u([{key:"title",fn:function(){return[i("span",{staticStyle:{"font-weight":"bolder","font-size":"16px",color:"#606266"}},[e._v("选择设备")])]},proxy:!0}])},[e._v(" "),i("el-form",{ref:"searchForm",attrs:{model:e.searchForm,inline:"","label-width":"80px"}},[i("el-form-item",{attrs:{label:"设备名称"}},[i("el-input",{attrs:{placeholder:"请输入",size:"small",clearable:""},on:{change:function(t){return e.getDeviceData("refresh")}},model:{value:e.searchForm.deviceName,callback:function(t){e.$set(e.searchForm,"deviceName",t)},expression:"searchForm.deviceName"}})],1),e._v(" "),"workOrder"!=e.urlType&&"MSLAWorkOrder"!=e.urlType&&"lubrTable"!=e.urlType&&"workOrderReport"!=e.urlType&&"parameter"!=e.urlType&&"workshop"!=e.urlType?i("el-form-item",{attrs:{label:"所属车间"}},[i("el-select",{attrs:{placeholder:"请选择",size:"small",clearable:""},on:{change:function(t){return e.getDeviceData("refresh")}},model:{value:e.searchForm.workshopId,callback:function(t){e.$set(e.searchForm,"workshopId",t)},expression:"searchForm.workshopId"}},e._l(e.workshopList,function(e){return i("el-option",{key:e.workshopId,attrs:{label:e.workshopName,value:e.workshopId}})}),1)],1):e._e(),e._v(" "),i("el-form-item",{attrs:{label:"编码"}},[i("el-input",{attrs:{placeholder:"请输入",size:"small",clearable:""},on:{change:function(t){return e.getDeviceData("refresh")}},model:{value:e.searchForm.deviceCode,callback:function(t){e.$set(e.searchForm,"deviceCode",t)},expression:"searchForm.deviceCode"}})],1),e._v(" "),i("el-form-item",[i("div",[i("el-button",{attrs:{size:"small"},on:{click:e.resetSearch}},[e._v("重置")]),e._v(" "),i("el-button",{attrs:{size:"small",plain:"",type:"danger"},on:{click:e.clickAddDevice}},[e._v("\n            创建设备\n          ")])],1)])],1),e._v(" "),e.templateFitter?i("div",{staticStyle:{background:"#ebf1ff",padding:"0px 0px","border-radius":"4px",height:"36px","line-height":"36px","margin-bottom":"10px"}},[i("span",{staticStyle:{"margin-left":"20px"}},[e._v("温馨提示 "),i("span",[e._v("由于服务内容限制，只能选择")]),i("span",{staticStyle:{color:"#dd0000"}},[e._v(" 特定类型的设备")])])]):e._e(),e._v(" "),"workshop"==e.urlType?i("div",{staticStyle:{padding:"0px 0px",height:"36px","line-height":"36px","margin-bottom":"10px"}},[i("span",{staticStyle:{"margin-left":"20px",color:"#dd0000"}},[e._v("温馨提示：为确保成功转移，选择的设备需要满足关联的润滑服务申请单为”已完成“状态")])]):e._e(),e._v(" "),i("div",[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingDevice,expression:"loadingDevice"},{name:"el-table-infinite-scroll",rawName:"v-el-table-infinite-scroll",value:e.loadMore,expression:"loadMore"}],ref:"deviceTableRef",attrs:{data:e.deviceTableData,"tooltip-effect":"dark","row-key":e.rowKey,"header-cell-class-name":e.cellClass},on:{select:e.handleSelectDevice}},[i("el-table-column",{attrs:{type:"selection","reserve-selection":!0,width:"55",selectable:"check"==e.taskType?e.checkSelectable:""}}),e._v(" "),i("el-table-column",{attrs:{prop:"deviceName","min-width":"8%",label:"设备名称","show-overflow-tooltip":""}}),e._v(" "),i("el-table-column",{attrs:{prop:"deviceTypeName","min-width":"8%",label:"设备类型","show-overflow-tooltip":""}}),e._v(" "),i("el-table-column",{attrs:{prop:"deviceGroupName","min-width":"10%",label:"分组","show-overflow-tooltip":""}}),e._v(" "),i("el-table-column",{attrs:{prop:"devicePosition","min-width":"5%",label:"位置","show-overflow-tooltip":""}}),e._v(" "),i("el-table-column",{attrs:{prop:"deviceCode","min-width":"8%",label:"编码","show-overflow-tooltip":""}}),e._v(" "),i("el-table-column",{attrs:{prop:"lubricationPointNum","min-width":"8%",label:"润滑点数","show-overflow-tooltip":""}}),e._v(" "),e.loadMoreDeviceFlag?i("p",[e._v("加载中...")]):e._e(),e._v(" "),e.loadMoreWorkshopFlag?e._e():i("p",[e._v("没有更多了")])],1)],1),e._v(" "),i("span",{attrs:{slot:"footer"},slot:"footer"},[i("div",[i("el-button",{attrs:{size:"small"},on:{click:e.cancelChoose}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{size:"small",type:"danger"},on:{click:e.nextChooseLup}},[e._v("下一步")])],1)])],1),e._v(" "),i("el-dialog",{attrs:{visible:e.chooseLupDialog,width:"65%","append-to-body":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.cancelChooseLup},on:{"update:visible":function(t){e.chooseLupDialog=t}},scopedSlots:e._u([{key:"title",fn:function(){return[i("span",{staticStyle:{"font-weight":"bolder","font-size":"16px",color:"#606266"}},[e._v("添加润滑点")])]},proxy:!0}])},[e._v(" "),i("div",{staticClass:"device-right"},[i("el-input",{staticStyle:{width:"220px"},attrs:{size:"small",placeholder:"请输入关键词","suffix-icon":"el-icon-search",maxlength:"50",clearable:""},on:{change:e.lumSearchChange},model:{value:e.lumSearch,callback:function(t){e.lumSearch=t},expression:"lumSearch"}}),e._v(" "),e.resultNotice&&e.lumSearch?i("div",{staticStyle:{"margin-top":"20px",color:"#dd0000","font-size":"13px"}},[e._v("搜索结果：")]):e._e(),e._v(" "),i("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:e.loadMoreLumPoint,expression:"loadMoreLumPoint"}],staticStyle:{height:"500px","overflow-y":"scroll","overflow-x":"hidden"}},[e._l(e.lupTableData,function(t,o){return i("div",{key:o,staticClass:"checkbox-wrap"},[i("div",{staticStyle:{height:"48px","line-height":"48px",background:"#f9f9f9",padding:"0 20px",display:"flex","justify-content":"space-between"}},[i("div",[e._v(e._s(t.deviceName)+" ("+e._s(t.deviceTypeName)+")")]),e._v(" "),i("div",[i("el-button",{staticStyle:{color:"#001450"},attrs:{type:"text"},on:{click:function(i){return e.createLup(t)}}},[e._v("+ 添加润滑点")])],1)]),e._v(" "),t.lubPointDtoList.length>0?i("div",{staticClass:"checkbox-box",staticStyle:{width:"100%"}},[i("el-checkbox-group",{staticStyle:{width:"100%"},on:{change:function(i){return e.changeSelLubPoint(i,t)}},model:{value:t.checkList,callback:function(i){e.$set(t,"checkList",i)},expression:"item.checkList"}},e._l(t.lubPointDtoList,function(t,o){return i("el-checkbox",{key:o,staticClass:"checkbox",attrs:{label:t.lubricationPointNumber,disabled:t.disabled}},[i("div",{staticStyle:{color:"#333"}},[e._v(e._s(t.lubricationPointName))]),e._v(" "),i("div",{staticStyle:{color:"#999"}},[e._v(e._s(t.lubricationPointType))])])}),1)],1):i("div",{staticClass:"empty-style"},[e._v("\n            暂无润滑点\n          ")])])}),e._v(" "),e.loadMoreLumPointFlag?i("p",{staticClass:"load-style"},[e._v("加载中...")]):e._e(),e._v(" "),e.loadMoreLumPointFlag?e._e():i("p",{staticClass:"load-style"},[e._v("没有更多了")])],2)],1),e._v(" "),i("span",{attrs:{slot:"footer"},slot:"footer"},[i("div",[i("el-button",{attrs:{size:"small"},on:{click:e.upStep}},[e._v("上一步")]),e._v(" "),i("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){e.confirmChoose(),e.$gio.addLubrPointTrack(e.NULL,"弹框中点击确定")}}},[e._v("\n          确定\n        ")])],1)])]),e._v(" "),i("el-dialog",{attrs:{title:"选择转移车间",visible:e.chooseTranferWorkshopDialog,width:"65%","append-to-body":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,"before-close":e.cancelChooseWorkshop},on:{"update:visible":function(t){e.chooseTranferWorkshopDialog=t}}},[i("div",{staticClass:"device-right"},[i("span",[e._v("车间名称：")]),e._v(" "),i("el-input",{staticStyle:{width:"220px"},attrs:{size:"small",placeholder:"","suffix-icon":"el-icon-search",maxlength:"50",clearable:""},on:{change:e.workShopSearch},model:{value:e.workshopSearch,callback:function(t){e.workshopSearch=t},expression:"workshopSearch"}}),e._v(" "),i("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:e.loadMoreWorkshop,expression:"loadMoreWorkshop"}],staticStyle:{height:"500px","overflow-y":"scroll","overflow-x":"hidden"}},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingPerson,expression:"loadingPerson"},{name:"el-table-infinite-scroll",rawName:"v-el-table-infinite-scroll",value:e.loadMoreWorkshop,expression:"loadMoreWorkshop"}],ref:"multipleTableAdd",attrs:{data:e.workshopData,"tooltip-effect":"dark","row-key":e.getRowKey},on:{"current-change":e.handleDistributionnChange}},[i("el-table-column",{attrs:{width:"55","reserve-selection":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-radio",{attrs:{label:t.row},model:{value:e.distributionPerson,callback:function(t){e.distributionPerson=t},expression:"distributionPerson"}},[i("i")])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"workshopName","min-width":"20%",label:"车间名称"}}),e._v(" "),i("el-table-column",{attrs:{prop:"deviceCount","min-width":"10%",label:"设备数"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s(t.row.deviceCount||0)+"\n            ")]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"workOrderCount","min-width":"10%",label:"工单数"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s(t.row.workOrderCount||0)+"\n            ")]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"createTime","min-width":"10%",label:"创建时间"}})],1)],1)],1),e._v(" "),i("span",{attrs:{slot:"footer"},slot:"footer"},[i("div",[i("el-button",{attrs:{size:"small"},on:{click:e.upStep}},[e._v("上一步")]),e._v(" "),i("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){e.confirmChoose(),e.$gio.addLubrPointTrack(e.NULL,"弹框中点击确定")}}},[e._v("\n          确定\n        ")])],1)])]),e._v(" "),e.addDeviceDialog?i("CreateDevice",{attrs:{deviceTypeDialog:e.deviceTypeDialog,addDeviceDialog:e.addDeviceDialog,customerObj:e.customerObj,workshopId:e.workshopId},on:{addOrEditDevice:e.addOrEditDevice,addOrEditDeviceAndLumpoint:e.addOrEditDeviceAndLumpoint,closeDialogAddDevice:e.closeDialogAddDevice}}):e._e(),e._v(" "),e.addLubricationPointDialog?i("CreateLubricationPoint",{attrs:{epInfo:e.checkDeviceObj,selectLubricationPointNumber:e.selectLubricationPointNumber,deviceTypeDialog:e.deviceTypeDialog,addLubricationPointDialog:e.addLubricationPointDialog},on:{addOrEditDevice:e.addOrEditDevice,addOrEditLup:e.addOrEditLup,lastNext:e.lastNext,closeDialogAddLubPoint:e.closeDialogAddLubPoint}}):e._e(),e._v(" "),i("SyncLub",{attrs:{dialogFlag:e.showSyncLubDialog,tipsData:e.tipsData},on:{closeSyncLubDialog:e.closeSyncLubDialog}})],1)};U._withStripped=!0;var $={render:U,staticRenderFns:[]},I=$;var Q=!1;var q=i("VU/8")(M,I,!1,function(e){Q||i("VSfC")},"data-v-3298701c",null);q.options.__file="src/components/spotInspection/components/chooseLubricationPointWorkorderForRecord.vue";t.default=q.exports},n8UN:function(e,t,i){"use strict";var o=i("//Fk"),a=i.n(o),l=i("Dd8w"),r=i.n(l),n=i("pFYg"),s=i.n(n),d=(i("7YgM"),{name:"ImgCutter",props:{crossOrigin:{type:Boolean,default:!1,required:!1},crossOriginHeader:{type:String,default:"*",required:!1},label:{type:String,default:"选择图片",required:!1},isModal:{type:Boolean,default:!0,required:!1},lockScroll:{type:Boolean,default:!0,required:!1},showChooseBtn:{type:Boolean,default:!0,required:!1},boxWidth:{type:Number,default:800,required:!1},boxHeight:{type:Number,default:400,required:!1},cutWidth:{type:Number,default:200,required:!1},cutHeight:{type:Number,default:200,required:!1},rate:{type:String,default:null,required:!1},tool:{type:Boolean,default:!0,required:!1},toolBgc:{type:String,default:"#fff",required:!1},imgMove:{type:Boolean,default:!0,required:!1},sizeChange:{type:Boolean,default:!0,required:!1},originalGraph:{type:Boolean,default:!0,required:!1},moveAble:{type:Boolean,default:!0,required:!1},previewMode:{type:Boolean,default:!0,required:!1},CuttingOriginal:{type:Boolean,default:!1,required:!1},WatermarkText:{type:String,default:"",required:!1},WatermarkTextFont:{type:String,default:"12px Sans-serif",required:!1},WatermarkTextColor:{type:String,default:"#fff",required:!1},WatermarkTextX:{type:Number,default:.95,required:!1},WatermarkTextY:{type:Number,default:.95,required:!1},smallToUpload:{type:Boolean,default:!1,required:!1},saveCutPosition:{type:Boolean,default:!1,required:!1},scaleAble:{type:Boolean,default:!0,required:!1},index:{default:null,required:!1},fileType:{default:"png",required:!1,type:String},toolBoxOverflow:{type:Boolean,default:!0,required:!1},DoNotDisplayCopyright:{type:Boolean,default:!1,required:!1},quality:{type:Number,default:1,required:!1}},model:["label","boxWidth","boxHeight","rate","tool","DoNotDisplayCopyright"],data:function(){return{visible:!1,fileName:"",cutImageObj:null,onPrintImgTimmer:null,toolBoxPosition:{x:0,y:0},drawImg:{img:null,sx:0,sy:0,swidth:0,sheight:0,x:0,y:0,width:0,height:0},toolBox:{disable:!0,width:this.boxWidth/2,height:this.boxHeight/2,x:0,y:0,boxMove:{start:{x:0,y:0},moveTo:{x:0,y:0}}},dropImg:{active:!1,pageX:0,pageY:0,params:{}},rotateImg:{angle:0},rotateControl:{active:!1,start:{x:0,y:0},position:100},scaleImg:{rate:0,params:{}},controlBox:{disable:!0,btnName:"",start:{x:0,y:0,width:0,height:0}},selectBox:!1,selectBoxColor:"rgba(0,0,0,0.6)",isFlipHorizontal:!1,isFlipVertically:!1,realFileType:null}},mounted:function(){var e=this;!1===this.isModal&&(this.visible=!0,this.$nextTick(function(){e.$refs.toolBox&&(e.$refs.toolBox.onmousewheel=e.scaleImgWheel,e.$refs.toolBox.addEventListener("DOMMouseScroll",e.scaleImgWheel))}))},methods:{handleOpen:function(e){var t=this,i=function(e){if(t.$refs.toolBox&&(t.$refs.toolBox.onmousewheel=t.scaleImgWheel,t.$refs.toolBox.addEventListener("DOMMouseScroll",t.scaleImgWheel)),!0===t.isModal){!0===t.lockScroll&&(document.body.style.overflowY="hidden");var i=t.$refs.dialogMainModalRef.offsetHeight+200,o=window.innerHeight,a=t.$refs.mask;a.style.overflowY=i>o?"scroll":"hidden"}e&&"function"==typeof e&&e()};if(e&&"object"===(void 0===e?"undefined":s()(e))&&e.src){if(!e.name)throw new Error("传入参数必须包含：src,name");var o=new Image;!0===this.crossOrigin&&(o.crossOrigin=this.crossOriginHeader),o.name=e.name,o.style.position="fixed",o.style.top="-5000px",o.style.opacity=0,o.onerror=function(e){console.error("图片加载失败"),t.$emit("error",{index:t.index,event:e,msg:"图片加载失败"}),t.clearCutImageObj()},o.onload=function(){if(!0!==o.complete)throw new Error("图片加载失败");t.visible=!0,t.$nextTick(function(){i(function(){t.importImgToCanv(o)})})},o.src=e.src,this.cutImageObj=o,document.body.appendChild(o),this.$emit("onChooseImg",e,this.index)}else this.visible=!0,this.$nextTick(function(){i()})},handleClose:function(){var e=this;this.clearAll(),!0===this.isModal&&(!0===this.lockScroll&&(document.body.style.overflowY="scroll"),this.$nextTick(function(){e.visible=!1}))},chooseImg:function(){this.$refs.inputFile.click()},importImgToCanv:function(e){var t=e.height,i=e.width,o=this.boxWidth,a=this.boxHeight,l=void 0,n=r()({},this.drawImg);this.fileName=e.name,n.img=e,this.scaleImg.rate=i/t,t<a&&i<o?(l=1,n.x=(o-i)/2,n.y=(a-t)/2):i/t<=o/a?(l=a/t,n.x=(o-i*l)/2):(l=o/i,n.y=(a-t*l)/2),n.swidth=i,n.sheight=t,n.width=i*l,n.height=t*l,n.x=(o-n.width)/2,n.y=(a-n.height)/2,this.drawImg=n,this.printImg(),this.putToolBox()},putImgToCanv:function(e){var t=this,i=void 0;if(!e.target.files)return console.error("IE9及以下需要自己传入image对象"),!1;if(i=e.target.files[0]||null){this.fileName=i.name,this.realFileType=i.type;var o=new FileReader;o.readAsDataURL(i),o.onload=function(e){var a=e.target.result,l=document.createElement("img");l.src=a;var n=setInterval(function(){if(2===o.readyState){if(clearInterval(n),!t.sizeChange&&t.smallToUpload&&l.width<=t.cutWidth&&l.height<=t.cutHeight)return t.handleClose(),i.name=t.changeFileName(i.name,t.fileType),void t.$emit("cutDown",{filename:t.changeFileName(i.name,t.fileType),file:i,index:t.index});var e=l.height,a=l.width,s=t.boxWidth,d=t.boxHeight,c=void 0,u=r()({},t.drawImg);u.img=l,t.scaleImg.rate=a/e,e<d&&a<s?(c=1,u.x=(s-a)/2,u.y=(d-e)/2):a/e<=s/d?(c=d/e,u.x=(s-a*c)/2):(c=s/a,u.y=(d-e*c)/2),u.swidth=a,u.sheight=e,u.width=a*c,u.height=e*c,u.x=(s-u.width)/2,u.y=(d-u.height)/2,t.drawImg=u,t.printImg(),t.putToolBox()}},200)},this.$emit("onChooseImg",i,this.index)}},putToolBox:function(){var e=this;this.toolBox.width!==this.boxWidth/2&&this.toolBox.height!==this.boxHeight/2&&!1!==this.saveCutPosition||(this.toolBox.width=this.cutWidth>this.boxWidth?this.boxWidth:this.cutWidth,this.toolBox.height=this.cutHeight>this.boxHeight?this.boxHeight:this.cutHeight),(0===this.toolBox.x&&0===this.toolBox.y||!1===this.saveCutPosition)&&(this.toolBox.x=this.boxWidth/2-this.toolBox.width/2,this.toolBox.y=this.boxHeight/2-this.toolBox.height/2),this.checkToolBoxOverflow().then(function(){e.printImg()}),this.drawControlBox(this.toolBox.width,this.toolBox.height,this.toolBox.x,this.toolBox.y)},checkToolBoxOverflow:function(){var e=this;return new a.a(function(t){if(!e.toolBoxOverflow){if(e.drawImg.width<e.toolBox.width||e.drawImg.height<e.toolBox.height){var i=e.drawImg.width/e.drawImg.height;e.drawImg.width<e.toolBox.width&&(e.drawImg.width=e.toolBox.width,e.drawImg.height=e.drawImg.width/i),e.drawImg.height<e.toolBox.height&&(e.drawImg.height=e.toolBox.height,e.drawImg.width=e.drawImg.height*i),e.drawImg.x=(e.boxWidth-e.drawImg.width)/2,e.drawImg.y=(e.boxHeight-e.drawImg.height)/2}e.drawImg.x>e.toolBox.x&&(e.drawImg.x=e.toolBox.x),e.drawImg.x+e.drawImg.width<e.toolBox.x+e.toolBox.width&&(e.drawImg.x=e.toolBox.x+e.toolBox.width-e.drawImg.width),e.drawImg.y>e.toolBox.y&&(e.drawImg.y=e.toolBox.y),e.drawImg.y+e.drawImg.height<e.toolBox.y+e.toolBox.height&&(e.drawImg.y=e.toolBox.y+e.toolBox.height-e.drawImg.height)}t()})},isSupportFileApi:function(){return!!(window.File&&window.FileList&&window.FileReader&&window.Blob&&-1===navigator.userAgent.indexOf("Edge")&&-1===navigator.userAgent.indexOf("MSIE")&&-1===navigator.userAgent.indexOf("Trident"))},dataURLtoFile:function(e,t){for(var i=e.split(","),o=i[0].match(/:(.*?);/)[1],a=atob(i[1]),l=a.length,r=new Uint8Array(l);l--;)r[l]=a.charCodeAt(l);return this.isSupportFileApi()?new File([r],t,{type:o}):"不支持File对象"},clearAll:function(){var e=this.$refs.canvas;e.getContext("2d").clearRect(0,0,e.width,e.height);var t=this.$refs.canvasSelectBox;t.getContext("2d").clearRect(0,0,t.width,t.height);var i=this.drawImg.sx,o=this.drawImg.sy;this.drawImg={img:null,sx:i,sy:o,swidth:0,sheight:0,x:0,y:0,width:0,height:0},this.isFlipHorizontal=!1,this.isFlipVertically=!1,this.$refs.inputFile.value="",this.rotateImg.angle=0,this.drawImg.img=null,this.turnReset(),this.clearCutImageObj(),this.$emit("onClearAll",this.index)},clearCutImageObj:function(){null!==this.cutImageObj&&void 0!==this.cutImageObj&&("function"==typeof this.cutImageObj.remove?this.cutImageObj.remove():this.cutImageObj.removeNode()),this.cutImageObj=null},drawControlBox:function(e,t,i,o){var a=this;this.toolBoxOverflow||(e<1&&(e=1),t<1&&(t=1),e>this.drawImg.width&&(e=this.drawImg.width),t>this.drawImg.height&&(t=this.drawImg.height),i<this.drawImg.x&&(i=this.drawImg.x),o<this.drawImg.y&&(o=this.drawImg.y),i>this.drawImg.x+this.drawImg.width-e&&(i=this.drawImg.x+this.drawImg.width-e),o>this.drawImg.y+this.drawImg.height-t&&(o=this.drawImg.y+this.drawImg.height-t)),e>this.boxWidth&&(e=this.boxWidth),t>this.boxHeight&&(t=this.boxHeight),i<0&&(i=0),o<0&&(o=0);var l=this.$refs.toolBoxControl,r=this.$refs.canvasSelectBox,n=r.getContext("2d");n.fillStyle=this.selectBoxColor,n.clearRect(0,0,r.width,r.height),n.fillRect(0,0,r.width,r.height);var s=void 0,d=void 0;if(this.rate&&""!==this.rate){var c=this.rate.split(":")[0]/this.rate.split(":")[1];c>=1?(s=e,(d=e/c)+o>this.drawImg.y+this.drawImg.height&&(s=(d=this.drawImg.y+this.drawImg.height-o)*c)):(s=t*c,d=t)}else s=e,d=t;this.toolBox.width=Math.abs(s),this.toolBox.height=Math.abs(d),l.style.width=Math.abs(s)+"px",l.style.height=Math.abs(d)+"px",this.toolBox.boxMove.moveTo.x=i,this.toolBox.boxMove.moveTo.y=o,s<0&&(i+=s),d<0&&(o+=d),i+this.toolBox.width>this.boxWidth&&(i=this.boxWidth-this.toolBox.width),i<0&&(i=0),o+this.toolBox.height>this.boxHeight&&(o=this.boxHeight-this.toolBox.height),o<0&&(o=0),this.toolBoxPosition.x=i,this.toolBoxPosition.y=o,l.style.left=i+"px",l.style.top=o+"px",n.clearRect(i,o,Math.abs(s),Math.abs(d)),this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout(function(){a.cropPicture(!0)},100)},resetToolBox:function(){this.toolBox.width<0&&(this.toolBox.boxMove.moveTo.x=this.toolBox.x-this.toolBox.width),this.toolBox.height<0&&(this.toolBox.boxMove.moveTo.y=this.toolBox.y-this.toolBox.height),this.toolBox.width=Math.abs(this.toolBox.width),this.toolBox.height=Math.abs(this.toolBox.height)},toolBoxMouseDown:function(e){var t=this.$refs.toolBoxControl;this.toolBox.x=parseInt(t.style.left.split("px")[0]),this.toolBox.y=parseInt(t.style.top.split("px")[0]),this.toolBox.disable=!1,this.dropImg.active=!1,this.toolBox.boxMove.start={x:e.pageX,y:e.pageY}},toolBoxMouseMove:function(e){if(this.dropImg.active&&this.dropImgMove(e),!1===this.toolBox.disable&&!0===this.moveAble){var t=e.pageX-this.toolBox.boxMove.start.x,i=e.pageY-this.toolBox.boxMove.start.y,o=this.toolBox.x+t,a=this.toolBox.y+i;this.drawControlBox(this.toolBox.width,this.toolBox.height,o,a)}},toolBoxMouseLeave:function(){var e=this;this.toolBox.disable=!0,this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout(function(){e.cropPicture(!0)},100),this.resetToolBox()},toolBoxMouseUp:function(){this.toolBox.x=parseInt(this.toolBoxPosition.x),this.toolBox.y=parseInt(this.toolBoxPosition.y),this.toolBox.disable=!0,this.dropImg.active=!1,this.resetToolBox()},printImg:function(){var e=this;if(this.drawImg.img){var t=this.$refs.canvas,i=t.getContext("2d");i.font="18px bold 黑体",i.fillStyle="#ff0",i.textAlign="center",i.textBaseline="middle",i.save(),i.clearRect(0,0,t.width,t.height),i.translate(this.drawImg.x+this.drawImg.width/2,this.drawImg.y+this.drawImg.height/2),i.rotate(this.rotateImg.angle*Math.PI/180),i.translate(-(this.drawImg.x+this.drawImg.width/2),-(this.drawImg.y+this.drawImg.height/2)),i.translate(this.drawImg.x,this.drawImg.y),i.scale(this.isFlipHorizontal?-1:1,this.isFlipVertically?-1:1),i.drawImage(this.drawImg.img,this.drawImg.sx,this.drawImg.sy,this.drawImg.swidth,this.drawImg.sheight,this.isFlipHorizontal?-this.drawImg.width:0,this.isFlipVertically?-this.drawImg.height:0,this.drawImg.width,this.drawImg.height),i.translate(-this.drawImg.x,this.drawImg.y),i.restore(),this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout(function(){e.cropPicture(!0)},100)}},dropImgOn:function(e){!0===this.imgMove&&(this.dropImg.active=!0,this.dropImg.params=r()({},this.drawImg),this.dropImg.pageX=e.pageX,this.dropImg.pageY=e.pageY)},dropImgOff:function(){var e=this;this.dropImg.active=!1,this.onPrintImgTimmer&&clearTimeout(this.onPrintImgTimmer),this.onPrintImgTimmer=setTimeout(function(){e.cropPicture(!0)},100)},dropImgMove:function(e){if(this.dropImg.active&&this.drawImg.img){var t=r()({},this.drawImg);t.x=this.dropImg.params.x-(this.dropImg.pageX-e.pageX),t.y=this.dropImg.params.y-(this.dropImg.pageY-e.pageY),this.toolBoxOverflow||(t.x>this.toolBox.x&&(t.x=this.toolBox.x),t.x<this.toolBox.x+this.toolBox.width-t.width&&(t.x=this.toolBox.x+this.toolBox.width-t.width),t.y>this.toolBox.y&&(t.y=this.toolBox.y),t.y<this.toolBox.y+this.toolBox.height-t.height&&(t.y=this.toolBox.y+this.toolBox.height-t.height)),this.drawImg=t,this.printImg(),e.stopPropagation()}},scaleReset:function(){this.drawImg.width=this.drawImg.swidth,this.drawImg.height=this.drawImg.sheight,this.printImg()},scaleImgWheel:function(e){var t=this;if(this.drawImg.img&&!0===this.scaleAble){var i=void 0,o=e||window.event;o.wheelDelta?i=-o.wheelDelta/40:o.detail&&(i=o.detail);this.drawImg.x=this.drawImg.width-9*i>50?this.drawImg.x+3*i:this.drawImg.x,this.drawImg.y=this.drawImg.width-9*i>50?this.drawImg.y+3*i:this.drawImg.y,this.drawImg.width=this.drawImg.width-9*i>50?this.drawImg.width-9*i:50,this.drawImg.height=this.drawImg.width/this.scaleImg.rate,this.checkToolBoxOverflow().then(function(){t.printImg(),t.onPrintImgTimmer&&clearTimeout(t.onPrintImgTimmer),t.onPrintImgTimmer=setTimeout(function(){t.cropPicture(!0)},100)})}return e.preventDefault(),e.returnValue=!1,!1},flipHorizontal:function(){this.drawImg.img&&(0==this.isFlipHorizontal?this.isFlipHorizontal=!0:this.isFlipHorizontal=!1,this.printImg())},flipVertically:function(){this.drawImg.img&&(0==this.isFlipVertically?this.isFlipVertically=!0:this.isFlipVertically=!1,this.printImg())},turnImg:function(e){var t=this.rotateImg.angle+e;t>=-180&&t<=180&&(this.rotateImg.angle=t,this.rotateControl.position=t/180*100+100,this.printImg("rotate"))},turnReset:function(){this.rotateImg.angle=0,this.rotateControl.position=100,this.printImg("rotate")},controlBtnMouseDown:function(e,t){this.controlBox.disable=!1,this.controlBox.btnName=t,this.controlBox.start.x=e.clientX,this.controlBox.start.y=e.clientY,this.controlBox.start.width=this.toolBox.width,this.controlBox.start.height=this.toolBox.height,e.stopPropagation()},controlBtnMouseUp:function(e){this.controlBox.disable=!0,this.dropImgOff(),this.resetToolBox(),this.toolBoxMouseUp(),e.stopPropagation()},controlBtnMouseMove:function(e){if(!1===this.controlBox.disable){var t=e.clientX-this.controlBox.start.x,i=e.clientY-this.controlBox.start.y,o=void 0,a=void 0;if("leftUp"==this.controlBox.btnName){if(this.rate){var l=this.rate.split(":")[0]/this.rate.split(":")[1];l>=1?(o=this.toolBox.x+t,a=this.toolBox.y+t/l):(o=this.toolBox.x+i*l,a=this.toolBox.y+i)}else o=this.toolBox.x+t,a=this.toolBox.y+i;this.toolBox.width=this.controlBox.start.width-t,this.toolBox.height=this.controlBox.start.height-i}if("rightUp"==this.controlBox.btnName){if(this.rate){var r=this.rate.split(":")[0]/this.rate.split(":")[1];r>=1?(o=this.toolBox.x,a=this.toolBox.y-t/r):(o=this.toolBox.x,a=this.toolBox.y+i)}else o=this.toolBox.x,a=this.toolBox.y+i;this.toolBox.width=this.controlBox.start.width+t,this.toolBox.height=this.controlBox.start.height-i}if("rightDown"==this.controlBox.btnName&&(o=this.toolBox.x,a=this.toolBox.y,this.toolBox.width=this.controlBox.start.width+t,this.toolBox.height=this.controlBox.start.height+i),"leftDown"==this.controlBox.btnName){if(this.rate){var n=this.rate.split(":")[0]/this.rate.split(":")[1];n>=1?(o=this.toolBox.x+t,a=this.toolBox.y):(o=this.toolBox.x+-i*n,a=this.toolBox.y)}else o=this.toolBox.x+t,a=this.toolBox.y;this.toolBox.width=this.controlBox.start.width-t,this.toolBox.height=this.controlBox.start.height+i}"topCenter"==this.controlBox.btnName&&(o=this.toolBox.x,a=this.toolBox.y+i,this.toolBox.width=this.controlBox.start.width,this.toolBox.height=this.controlBox.start.height-i),"downCenter"==this.controlBox.btnName&&(o=this.toolBox.x,a=this.toolBox.y,this.toolBox.width=this.controlBox.start.width,this.toolBox.height=this.controlBox.start.height+i),"leftCenter"==this.controlBox.btnName&&(o=this.toolBox.x+t,a=this.toolBox.y,this.toolBox.width=this.controlBox.start.width-t,this.toolBox.height=this.controlBox.start.height),"rightCenter"==this.controlBox.btnName&&(o=this.toolBox.x,a=this.toolBox.y,this.toolBox.width=this.controlBox.start.width+t,this.toolBox.height=this.controlBox.start.height),this.drawControlBox(this.toolBox.width,this.toolBox.height,o,a)}e.stopPropagation()},changeFileName:function(e,t){var i=e.lastIndexOf(".");return e.substr(0,i+1)+("jpeg"===t?"jpg":t)},cropPicture:function(e){var t=this,i=t.realFileType?t.realFileType:"image/"+t.fileType,o=t.fileType;if(t.realFileType&&(o=t.realFileType.split("/")[1]),this.drawImg.img){var a=this.$refs.canvas;if(this.WatermarkText&&!e){var l=a.getContext("2d");l.font=this.WatermarkTextFont,l.fillStyle=this.WatermarkTextColor,l.textAlign="right",l.textBaseline="bottom",l.fillText(this.WatermarkText,this.toolBox.x+this.toolBox.width*this.WatermarkTextX,this.toolBox.y+this.toolBox.height*this.WatermarkTextY)}var r=new Image;!0===this.crossOrigin&&(r.crossOrigin=this.crossOriginHeader),r.src=a.toDataURL("image/"+this.fileType,t.quality),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,o){window.atob?setTimeout(function(){for(var l=atob(a.toDataURL(t,o).split(",")[1]),r=l.length,n=new Uint8Array(r),s=void 0,d=0;d<r;d++)n[d]=l.charCodeAt(d);try{s=new Blob([n],{type:i})}catch(e){if(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,"TypeError"==e.name&&window.BlobBuilder){var c=new(0,window.BlobBuilder);c.append(n.buffer),s=c.getBlob(i)}"InvalidStateError"==e.name&&(s=new Blob([n.buffer],{type:i}))}e(s)},200):e(!1,{type:i})}}),a.toBlob(function(a){if(a){var l=new FileReader;l.readAsDataURL(a),l.onload=function(){var a=setInterval(function(){if(2==l.readyState){clearInterval(a);var n=document.createElement("canvas"),s=n.getContext("2d");if(1==t.originalGraph){var d=t.drawImg.width/t.drawImg.swidth,c=t.toolBox.width/d,u=t.toolBox.height/d;n.width=c,n.height=u;var m=(t.toolBox.x-t.drawImg.x)/d,h=(t.toolBox.y-t.drawImg.y)/d,p=t.drawImg.swidth,g=t.drawImg.sheight;s.translate(-m,-h),s.drawImage(t.drawImg.img,0,0,p,g)}else{n.width=t.toolBox.width,n.height=t.toolBox.height;var v=t.toolBox;if(t.rate){var f=t.rate.split(":")[0]/t.rate.split(":")[1];t.rate.split(":")[0]>=t.rate.split(":")[1]?s.drawImage(r,v.x,v.y,v.width,v.width*f,0,0,v.width,v.width*f):s.drawImage(r,v.x,v.y,v.width,v.width/f,0,0,v.width,v.width/f)}else s.drawImage(r,v.x,v.y,v.width,v.height,0,0,v.width,v.height)}n.toBlob(function(a){var l=t.changeFileName(t.fileName,o);if(e)t.previewMode&&t.$emit("onPrintImg",{index:t.index,fileName:l,blob:a,file:t.dataURLtoFile(n.toDataURL(i,t.quality),l),dataURL:n.toDataURL(i,t.quality)});else if(t.handleClose(),a.size>1048576){var r=n.toDataURL(i,1);t.compressImage(l,r,a)}else t.$emit("cutDown",{index:t.index,fileName:l,blob:a,file:t.dataURLtoFile(n.toDataURL(i,t.quality),l),dataURL:n.toDataURL(i,t.quality)})},i,t.quality)}},200)}}else{var n=document.createElement("canvas");n.width=t.toolBox.width,n.height=t.toolBox.height;var s=n.getContext("2d"),d=t.toolBox;if(t.rate){var c=t.rate.split(":")[0]/t.rate.split(":")[1];s.drawImage(r,d.x,d.y,d.width,d.width*c,0,0,d.width,d.width*c)}else s.drawImage(r,d.x,d.y,d.width,d.height,0,0,d.width,d.height);var u=t.changeFileName(t.fileName,o);e?t.$emit("onPrintImg",{fileName:u,dataURL:n.toDataURL(i,t.quality)}):(t.handleClose(),t.$emit("cutDown",{fileName:u,dataURL:n.toDataURL(i,t.quality)}))}}),t.quality}else e||(console.warn("No picture selected"),t.$emit("error",{err:1,msg:"No picture selected"}))},scrollBarControlMove:function(e){if(this.rotateControl.active){var t=e.pageX-this.rotateControl.start.x,i=this.rotateControl.start.position+t;i<=0&&(i=0),i>=200&&(i=200),this.rotateControl.position=i,this.rotateImg.angle=(i-100)/100*180,this.printImg()}},scrollBarControlOn:function(e){this.rotateControl.active=!0,this.rotateControl.start.x=e.pageX,this.rotateControl.start.y=e.pageY,this.rotateControl.start.position=this.rotateControl.position},scrollBarControlOff:function(){this.rotateControl.active=!1},compressImage:function(e,t,i){var o=new Image;o.src=t;var a=this,l=a.realFileType?a.realFileType:"image/"+a.fileType;o.onload=function(){var t=document.createElement("canvas"),r=t.getContext("2d");t.width=o.width,t.height=o.height,r.drawImage(o,0,0,t.width,t.height);var n=t.toDataURL(l,.6);a.$emit("cutDown",{index:a.index,fileName:e,blob:i,file:a.dataURLtoFile(t.toDataURL(l,.6),e),dataURL:n})}}},computed:{showToolBoxWidth:function(){var e=void 0;return e=this.originalGraph?this.toolBox.width/(this.drawImg.width/this.drawImg.swidth):this.toolBox.width,Number(e).toFixed(0)},showToolBoxHeight:function(){var e=void 0;return e=this.originalGraph?this.toolBox.height/(this.drawImg.width/this.drawImg.swidth):this.toolBox.height,Number(e).toFixed(0)},showToolBoxX:function(){var e;return e=this.toolBoxPosition.x,Number(e).toFixed(0)},showToolBoxY:function(){var e;return e=this.toolBoxPosition.y,Number(e).toFixed(0)}}}),c=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[!0===e.showChooseBtn&&!0===e.isModal?i("div",{on:{click:e.handleOpen}},[e._t("openImgCutter"),e._v(" "),e._t("open")],2):e._e(),e._v(" "),i("transition",{attrs:{name:"fade"}},[e.visible?i("div",{ref:"mask",class:!0===e.isModal?"mask vue-img-cutter":""},[e.visible?i("div",{class:!0===e.isModal?"dialogBoxModal":"dialogBox"},[i("transition",{attrs:{name:"fade","enter-class":"fade-in-enter","enter-active-class":"fade-in-active","leave-class":"fade-out-enter","leave-active-class":"fade-out-active"}},[i("div",{ref:"dialogMainModalRef",class:!0===e.isModal?"dialogMainModal":"dialogMain",style:"width:"+(!0===e.isModal?e.boxWidth+32:e.boxWidth)+"px"},[i("div",{staticClass:"toolMain"},[!0===e.isModal?i("div",{staticClass:"tool-title"},[e._v("\n                                图片裁剪\n                                "),i("span",{staticClass:"closeIcon",on:{click:e.handleClose}},[e._v("×")])]):e._e(),e._v(" "),i("div",{ref:"toolBox",staticClass:"toolBox",style:"height:"+e.boxHeight+"px;width:"+e.boxWidth+"px",on:{mousemove:e.controlBtnMouseMove,mouseup:e.controlBtnMouseUp,mouseleave:e.controlBtnMouseUp}},[i("div",{directives:[{name:"show",rawName:"v-show",value:null!=e.drawImg.img,expression:"drawImg.img != null"}],ref:"toolBoxControl",staticClass:"toolBoxControl",on:{mousedown:e.toolBoxMouseDown,mouseup:e.toolBoxMouseUp,mousemove:e.toolBoxMouseMove,mouseleave:e.toolBoxMouseLeave}},[i("div",{staticClass:"toolBoxControlBox"},[i("div",{staticClass:"controlBox"},[i("div",{staticClass:"controlBoxInnerLine controlBoxInnerLineTop"}),e._v(" "),i("div",{staticClass:"controlBoxInnerLine controlBoxInnerLineBottom"}),e._v(" "),i("div",{staticClass:"controlBoxInnerLine controlBoxInnerLineLeft"}),e._v(" "),i("div",{staticClass:"controlBoxInnerLine controlBoxInnerLineRight"}),e._v(" "),i("div",{staticClass:"selectArea"},[e._v("\n                                                宽:"+e._s(e.showToolBoxWidth)+" 高:"+e._s(e.showToolBoxHeight)+" (x:"+e._s(e.showToolBoxX)+",y:"+e._s(e.showToolBoxY)+")\n                                            ")]),e._v(" "),!0===e.sizeChange?i("div",{staticClass:"leftUp controlBtn",attrs:{"data-name":"leftUp"},on:{mousedown:function(t){return e.controlBtnMouseDown(t,"leftUp")}}}):e._e(),e._v(" "),!0===e.sizeChange?i("div",{staticClass:"leftDown controlBtn",attrs:{"data-name":"leftDown"},on:{mousedown:function(t){return e.controlBtnMouseDown(t,"leftDown")}}}):e._e(),e._v(" "),!0===e.sizeChange?i("div",{staticClass:"rightUp controlBtn",attrs:{"data-name":"rightUp"},on:{mousedown:function(t){return e.controlBtnMouseDown(t,"rightUp")}}}):e._e(),e._v(" "),!0===e.sizeChange?i("div",{staticClass:"rightDown controlBtn",attrs:{"data-name":"rightDown"},on:{mousedown:function(t){return e.controlBtnMouseDown(t,"rightDown")}}}):e._e(),e._v(" "),!0===e.sizeChange&&!e.rate&&e.toolBox.width>20?i("div",{staticClass:"topCenter controlBtn",attrs:{"data-name":"topCenter"},on:{mousedown:function(t){return e.controlBtnMouseDown(t,"topCenter")}}}):e._e(),e._v(" "),!0===e.sizeChange&&!e.rate&&e.toolBox.width>20?i("div",{staticClass:"downCenter controlBtn",attrs:{"data-name":"downCenter"},on:{mousedown:function(t){return e.controlBtnMouseDown(t,"downCenter")}}}):e._e(),e._v(" "),!0===e.sizeChange&&!e.rate&&e.toolBox.height>20?i("div",{staticClass:"leftCenter controlBtn",attrs:{"data-name":"leftCenter"},on:{mousedown:function(t){return e.controlBtnMouseDown(t,"leftCenter")}}}):e._e(),e._v(" "),!0===e.sizeChange&&!e.rate&&e.toolBox.height>20?i("div",{staticClass:"rightCenter controlBtn",attrs:{"data-name":"rightCenter"},on:{mousedown:function(t){return e.controlBtnMouseDown(t,"rightCenter")}}}):e._e()]),e._v(" "),i("div",{staticClass:"toolBoxControlLine toolBoxControlLineItem-1"}),e._v(" "),i("div",{staticClass:"toolBoxControlLine toolBoxControlLineItem-2"}),e._v(" "),i("div",{staticClass:"toolBoxControlLine toolBoxControlLineItem-3"}),e._v(" "),i("div",{staticClass:"toolBoxControlLine toolBoxControlLineItem-4"})])]),e._v(" "),i("canvas",{ref:"canvasSelectBox",staticClass:"canvasSelectBox",attrs:{width:e.boxWidth,height:e.boxHeight},on:{mousedown:e.dropImgOn,mouseup:e.dropImgOff,mousemove:e.dropImgMove}}),e._v(" "),i("canvas",{ref:"canvas",staticClass:"canvas",attrs:{width:e.boxWidth,height:e.boxHeight}})])]),e._v(" "),i("div",{staticClass:"i-dialog-footer",staticStyle:{height:"40px"}},[i("input",{ref:"inputFile",staticStyle:{width:"1px",height:"1px",border:"none",opacity:"0"},attrs:{type:"file",accept:"image/gif, image/jpeg ,image/png"},on:{change:e.putImgToCanv}}),e._v(" "),i("div",{staticClass:"btn-group fl"},[i("el-button",{attrs:{size:"small",type:"danger",plain:""},on:{click:e.chooseImg}},[e._v("选择图片")])],1),e._v(" "),i("div",{staticClass:"btn-group fr"},[i("el-button",{attrs:{size:"small"},on:{click:e.handleClose}},[e._v("取消")]),e._v(" "),i("el-button",{staticStyle:{"margin-left":"15px"},attrs:{type:"primary",size:"small",disabled:!e.drawImg.img},on:{click:function(t){return e.cropPicture(!1)}}},[e._v("确定")])],1)])])]),e._v(" "),i("div",{staticStyle:{clear:"both"}})],1):e._e()]):e._e()])],1)};c._withStripped=!0;var u={render:c,staticRenderFns:[]},m=u;var h=!1;var p=i("VU/8")(d,m,!1,function(e){h||i("A+fv")},"data-v-16a33b62",null);p.options.__file="src/components/imgCutter.vue";t.a=p.exports},q9Tq:function(e,t,i){"use strict";var o=i("Xxa5"),a=i.n(o),l=i("exGp"),r=i.n(l),n=i("mvHQ"),s=i.n(n),d=i("fZjL"),c=i.n(d),u=i("Csjt"),m=i("8qGi"),h=i("O4Lo"),p=i.n(h),g={components:{CreateLubricationPoint:m.a,SyncLub:u.a},props:{addDeviceDialog:{type:Boolean,default:function(){return!1}},deviceTypeDialog:{type:String,default:""},selectLubricationPointNumber:{type:String,default:""},workshopId:{type:String,default:""},customerObj:{type:Object,default:function(){return{}}},resource:{type:String,default:""},epInfo:{type:Object,default:function(){return{}}}},data:function(){var e=this;return{roleType:"",loadingRemote:!1,customerList:[],eptList:[],selectCompanyName:"",createDeviceFlag:!1,workshopList:[],addLubricationPointDialog:!1,canEditFlag:!0,showDialog:!1,addDeviceMsg:"",addDeviceCode:null,showSyncLubDialog:!1,tipsData:{},SPList:[],addDeviceForm:{spId:"",customerNumber:"",newBusinessFlag:!1,deviceName:"",eptType:[],workshopId:"",manufacturer:"",deviceModel:"",deviceCode:"",devicePosition:"",customerVisibility:1},saveFlag:!1,addLumPointFormSave:{imgLubricationFile:"",recommendOilBrand:"",oilChangeMethod:2,recommendOilType:"",recommendOilSeries:"",recommendOilCode:"",lubricationPointType:"",lubricationPointTypeCode:"",lastOilAddDate:"",oilBrandCode:"",lubricationPointName:"",lubricationPointDesc:"",lubricationPointManufacturer:"",lubricationMethod:"",oilAddPeriod:"",oilName:"",oilSeries:"",oilType:"",everyTimeOilAddQuantityUnit:"L",fillingQuantityUnit:"L",preMonthOilAddQuantityUnit:"L",preMonthOilAddQuantity:"",lastOilChangeDate:"",fillingQuantity:"",oilBoxCapacity:"",currentOilCode:"",everyTimeOilAddQuantity:"",nextScheduledOilChangeDate:"",nextScheduledOilAddDate:"",autoCreateOilChangePlan:!1,lastTestDate:"",autoCreateOilAddPlan:!1,oilChangePeriodUnit:"D",oilChangePeriod:"",oilBoxCapacityUnit:"L",oilAddPeriodUnit:"D",lubricationPointSelectName:""},addDeviceRules:{deviceName:[{required:!0,message:"请输入设备名称",trigger:"blur"}],spId:[{required:!0,message:"请选择经销商",trigger:"blur"}],customerNumber:[{required:!0,message:"请选择所属客户",trigger:"change"}],eptType:[{required:!0,validator:function(t,i,o){if(!e.addDeviceForm.eptType.length)return o(new Error("请选择设备类型"));o()},trigger:"change"}],customerVisibility:[{required:!0,message:"请选择是否对客户可见",trigger:"change"}],newBusinessFlag:[{required:!0,message:"是否是新项目设备初装生意",trigger:"change"}]},addDeviceTypeForm:{name:""},addDeviceDefinedRules:{name:[{validator:function(e,t,i){if(!t)return i(new Error("请输入自定义设备类型"));if(!/^[\u4e00-\u9fa5]{0,}$/.test(t))return i(new Error("请输入中文"));i()},trigger:"blur"}]},uploadUrl:"",imageLubricationList:[],oldBussess:Boolean}},created:function(){this.roleType=JSON.parse(this.Decrypt(sessionStorage.getItem("userInfo"))).userType,"2"==this.roleType&&(this.addDeviceForm.customerNumber=JSON.parse(this.Decrypt(sessionStorage.getItem("userInfo"))).companyNumber,this.getWorkShopList(JSON.parse(this.Decrypt(sessionStorage.getItem("userInfo"))).companyId),this.getSpList(this.$userInfo.orgInfo.companyId)),this.customerObj&&this.customerObj.companyId&&this.getSpList(this.customerObj.companyId)},watch:{addDeviceDialog:{handler:function(e,t){var i=this;if(e){this.oldBussess=this.epInfo.newBusinessFlag,this.getEptList(),"editDevice"==this.deviceTypeDialog||"editDeviceAndLumPoint"==this.deviceTypeDialog?(this.getWorkShopList(this.epInfo.companyId),this.getDeviceEdit(this.epInfo.deviceNumber),c()(this.addDeviceForm).forEach(function(e){i.addDeviceForm[e]=i.epInfo[e]})):(void 0==this.customerObj||s()("{}"==this.customerObj))&&this.$_queryCustomerData(),this.workshopId&&(this.$set(this.addDeviceForm,"workshopId",this.workshopId),this.canEditFlag=!1,this.getWorkShopList(this.customerObj.companyId)),this.customerObj&&"{}"!=s()(this.customerObj)&&(console.log(this.customerObj,1111),this.$set(this.addDeviceForm,"customerNumber",this.customerObj.companyNumber),this.selectCompanyName=this.customerObj.companyName,this.$_queryCustomerData(),this.getWorkShopList(this.customerObj.companyId));var o=[];this.epInfo.deviceTypeDto&&this.epInfo.deviceTypeDto.forEach(function(e){o.push(e.code)}),this.addDeviceForm.eptType=o,this.addDeviceForm.customerVisibility||0==this.addDeviceForm.customerVisibility||this.$set(this.addDeviceForm,"customerVisibility",!1),this.addDeviceForm.newBusinessFlag&&void 0!=this.addDeviceForm.newBusinessFlag||this.$set(this.addDeviceForm,"newBusinessFlag",!1)}},immediate:!0}},methods:{lastNext:function(e,t,i){this.addLubricationPointDialog=!1,this.addLumPointFormSave=e,this.imageLubricationList=t,this.uploadUrl=i,this.saveFlag=!0},closeDialogAddLubPoint:function(){this.addLubricationPointDialog=!1},changeEpt:function(e){this.addDeviceForm.eptType=e},addDevice:function(){this.submitDevice(this.addDeviceForm,"addDevice")},editDeviceAndLumPoint:function(){this.addLubricationPointDialog=!1,this.$emit("addOrEditDeviceAndLumpoint")},addOrEditLup:function(){this.addLubricationPointDialog=!1,this.$emit("addOrEditDeviceAndLumpoint")},closeSyncLubDialog:function(){this.showSyncLubDialog=!1,this.$emit("closeDialogAddDevice")},cancelAddDevice:function(){this.$emit("closeDialogAddDevice")},handleSaveDevice:function(){var e=this;this.oldBussess&&!this.addDeviceForm.newBusinessFlag?this.$alert("设备由新项目初装设备变为现有生意设备，必填信息发生改变，请及时补全设备及润滑点信息","提示",{confirmButtonText:"知道了",callback:function(t){e.submitDevice(e.addDeviceForm,"editDevice")}}):this.submitDevice(this.addDeviceForm,"editDevice")},submitDevice:function(e,t){var i=this;if("addDevice"==t){var o={};o.spId=e.spId,o.deviceName=e.deviceName,o.newBusinessFlag=e.newBusinessFlag,o.customerNumber=e.customerNumber,o.deviceType=e.eptType[e.eptType.length-1],o.workshopId=e.workshopId,o.manufacturer=e.manufacturer,o.deviceModel=e.deviceModel,o.deviceCode=e.deviceCode,o.devicePosition=e.devicePosition,o.customerVisibility=e.customerVisibility,o.haveLubricationPointFlag=!1,this.requestMethodPost("/web/device/addDeviceV2",o).then(function(e){1e3==(e=e.data).code?(i.$message({message:"添加成功",type:"success"}),e.data.tips&&2!=i.$userInfo.userType?(i.showSyncLubDialog=!0,i.tipsData=e.data.tips):i.$emit("addOrEditDevice")):i.$message({message:e.msg,type:"warning"})}).catch(function(e){})}else{var a={deviceNumber:this.epInfo.deviceNumber,newBusinessFlag:e.newBusinessFlag,deviceName:e.deviceName,customerNumber:e.customerNumber,manufacturer:e.manufacturer||"",deviceModel:e.deviceModel||"",picDeleteFlag:e.delDevicePicFlag||"",lubricationPointUpdateRequestList:null,deviceType:e.eptType[e.eptType.length-1],workshopId:e.workshopId,deviceCode:e.deviceCode,devicePosition:e.devicePosition,customerVisibility:e.customerVisibility};this.requestMethodPost("/web/device/updateDeviceAndLPBatch",a).then(function(e){1e3==(e=e.data).code?(i.$message({message:"修改成功",type:"success"}),i.$emit("addOrEditDevice")):i.$message({message:e.msg,type:"warning"})}).catch(function(e){})}},getDeviceEdit:function(e){var t=this,i={deviceNumberList:[e]};this.requestMethodPost("weChat/workshop/getNoMoveDevice",i).then(function(e){1e3==e.data.code?t.canEditFlag=e.data.data.canEditFlag:t.$message({message:e.data.msg,type:"error"})})},handleContinueAddLumpoint:function(e){var t=this;console.log(e),this.$refs[e].validate(function(e){e&&(t.addLubricationPointDialog=!0)})},$_queryCustomerData:function(){var e=this;if(console.log(122333,this.$userInfo.orgInfo),2!=this.$userInfo.userType){this.loadingRemote=!0;var t={companyType:2,size:100,status:"1,2,3",companyName:this.selectCompanyName,menuCode:"CustomerProfileList"};this.requestMethodGet("/web/customer/queryCompanyListByPage",t).then(function(t){e.loadingRemote=!1,1e3==(t=t.data).code?e.customerList=t.data.list:e.$message({message:t.msg,type:"warning"})}).catch(function(t){e.loadingRemote=!1})}else this.customerList=[{companyName:this.$userInfo.orgInfo.companyName,companyNumber:this.$userInfo.orgInfo.companyNumber}]},customerAllFilter:p()(function(e){this.selectCompanyName=e,this.$_queryCustomerData()},500),handleChangeCustomer:function(e){this.SPList=[],this.addDeviceForm.workshopId="";var t="",i={};if(e){var o=(i=this.customerList.filter(function(t){return t.companyNumber==e})[0]).companyId;t=o,this.getWorkShopList(o,i.daFlag)}else this.selectCompanyName="",this.$_queryCustomerData();this.getSpList(t,i.daFlag)},getSpList:function(e,t){var i=this;return r()(a.a.mark(function o(){var l;return a.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(1!=i.$userInfo.userType||t){o.next=2;break}return o.abrupt("return",i.addDeviceForm.spId=i.$userInfo.orgInfo.companyId);case 2:if(i.SPList=[],e){o.next=5;break}return o.abrupt("return",i.SPList=[]);case 5:return o.next=7,i.requestMethodGetTip("/web/company/getSpsOfAccount",{accountId:e});case 7:if(l=o.sent,i.SPList=l.data.data,1!=i.SPList.length){o.next=11;break}return o.abrupt("return",i.addDeviceForm.spId=i.SPList[0].spId);case 11:case"end":return o.stop()}},o,i)}))()},getWorkShopList:function(e){var t=this,i={companyId:e,workshopName:"",current:1,size:500};this.requestMethodGet("/weChat/workshop/queryWorkshopListByPage",i).then(function(e){if(1e3==e.data.code){var i=e.data.data.list||[];t.workshopList=i}else t.$message({message:e.data.msg,type:"error"})})},getEptList:function(){var e=this;this.requestMethodGet("/weChat/device/queryAllDeviceTypeTree4",{filterFlag:!0}).then(function(t){1e3==t.data.code?e.eptList=t.data.data:e.$message({message:t.data.msg,type:"error"})})},cancelAdd:function(e){var t=this;this.createDeviceFlag=!1,this.$nextTick(function(){t.$refs[e].resetFields()})},chooseAgain:function(){this.showDialog=!1,this.cancelAdd("addDeviceRef")},confirmAddDevice:function(){var e=this,t={level:"4",name:this.addDeviceTypeForm.name,parentCode:"device_user_defined",forceSaveExistNameFlag:!0};this.requestMethodPost("web/config/industryDevice/addIndustryDevice",t).then(function(t){1e3==t.data.code?(e.addDeviceForm.eptType=["industry_0013","industry_0051","device_user_defined",t.data.data],e.chooseAgain(),e.getEptList()):e.$message({message:t.data.msg,type:"error"})})},createDevice:function(){this.createDeviceFlag=!0,this.addDeviceTypeForm.name=this.$refs.deviceRef.inputValue},completeAdd:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;var i={level:"4",name:t.addDeviceTypeForm.name,parentCode:"device_user_defined"};t.requestMethodPost("web/config/industryDevice/addIndustryDevice",i).then(function(e){1e3==e.data.code?(t.addDeviceForm.eptType=["industry_0013","industry_0051","device_user_defined",e.data.data],t.chooseAgain(),t.getEptList()):4306==e.data.code||4307==e.data.code?(t.addDeviceCode=e.data.code,t.addDeviceMsg=e.data.msg,t.showDialog=!0):t.$message({message:e.data.msg,type:"error"})})})}},computed:{}},v=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"addDevice"},[i("el-dialog",{attrs:{title:"addDeviceAndLubpoint"==e.deviceTypeDialog?"创建设备":"编辑设备",visible:e.addDeviceDialog,width:"40%","close-on-click-modal":!1,"before-close":e.cancelAddDevice},on:{"update:visible":function(t){e.addDeviceDialog=t}}},[i("div",{staticStyle:{padding:"0px 20px 0",height:"630px",overflow:"auto"}},[i("el-form",{ref:"addDeviceRef",staticClass:"demo-addDeviceForm",attrs:{model:e.addDeviceForm,rules:e.addDeviceRules,"label-width":"100px","label-position":"top"}},[i("div",{staticStyle:{"margin-top":"20px"}}),e._v(" "),"editDevice"!=e.deviceTypeDialog&&"editDeviceAndLumPoint"!=e.deviceTypeDialog?i("el-row",["2"!=e.roleType?i("el-col",{attrs:{span:24}},[i("el-form-item",{attrs:{label:"所属客户",prop:"customerNumber"}},[i("div",{staticClass:"selectFollow"},[i("el-select",{staticStyle:{width:"100%"},attrs:{size:"small","popper-class":"myCascader","popper-append-to-body":!1,clearable:"",filterable:"",disabled:e.customerObj&&e.customerObj.companyNumber,"filter-method":e.customerAllFilter,placeholder:"请选择"},on:{change:e.handleChangeCustomer},model:{value:e.addDeviceForm.customerNumber,callback:function(t){e.$set(e.addDeviceForm,"customerNumber",t)},expression:"addDeviceForm.customerNumber"}},[e._l(e.customerList,function(e){return i("el-option",{key:e.companyNumber,attrs:{label:e.companyName,value:e.companyNumber}})}),e._v(" "),i("template",{slot:"empty"},[e.loadingRemote?i("div",{staticStyle:{"text-align":"center",padding:"5px",color:"grey","font-size":"13px"}},[e._v("\n                      加载中···\n                    ")]):i("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center",padding:"5px 0px"}},[e._v("\n                      暂无数据\n                    ")])])],2)],1)])],1):e._e(),e._v(" "),i("el-col",{attrs:{span:24}},[e.SPList.length>1&&"1"!=e.roleType?i("el-form-item",{attrs:{label:"服务商",prop:"spId"}},[i("div",{staticClass:"selectFollow"},[i("el-select",{staticStyle:{width:"100%"},attrs:{size:"small","popper-class":"myCascader","popper-append-to-body":!1,clearable:"",filterable:"",placeholder:"请选择"},model:{value:e.addDeviceForm.spId,callback:function(t){e.$set(e.addDeviceForm,"spId",t)},expression:"addDeviceForm.spId"}},e._l(e.SPList,function(e){return i("el-option",{key:e.spId,attrs:{label:e.spName,value:e.spId}})}),1)],1)]):e._e()],1)],1):e._e(),e._v(" "),"2"!=e.roleType&&"editDevice"!=e.deviceTypeDialog&&"editDeviceAndLumPoint"!=e.deviceTypeDialog?i("div",{staticClass:"border"}):e._e(),e._v(" "),i("el-row",{directives:[{name:"show",rawName:"v-show",value:"2"!=e.roleType,expression:"roleType != '2'"}],attrs:{gutter:20}},[i("el-col",{attrs:{span:20}},[i("el-form-item",{attrs:{label:"是否是新项目设备初装生意？",prop:"newBusinessFlag","label-width":"220px"}},[i("el-radio-group",{model:{value:e.addDeviceForm.newBusinessFlag,callback:function(t){e.$set(e.addDeviceForm,"newBusinessFlag",t)},expression:"addDeviceForm.newBusinessFlag"}},[i("el-radio",{attrs:{label:!1}},[e._v("现有生意")]),e._v(" "),i("el-radio",{attrs:{label:!0}},[e._v("新项目初装")])],1)],1)],1)],1),e._v(" "),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"设备名称",prop:"deviceName"}},[i("el-input",{staticStyle:{width:"100%"},attrs:{size:"small",maxlength:"50",clearable:"",placeholder:"请输入"},model:{value:e.addDeviceForm.deviceName,callback:function(t){e.$set(e.addDeviceForm,"deviceName",t)},expression:"addDeviceForm.deviceName"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"设备类型",prop:"eptType"}},[i("el-cascader",{ref:"deviceRef",staticStyle:{width:"100%"},attrs:{size:"small",placeholder:"试试搜索：设备",options:e.eptList,filterable:"",clearable:"",props:{value:"code",label:"name"}},on:{change:e.changeEpt},model:{value:e.addDeviceForm.eptType,callback:function(t){e.$set(e.addDeviceForm,"eptType",t)},expression:"addDeviceForm.eptType"}},[i("template",{slot:"empty"},[i("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center",padding:"5px 0px"}},[e._v("\n                    暂无匹配数据"),i("el-link",{staticStyle:{"margin-left":"10px",color:"#409eff"},on:{click:e.createDevice}},[e._v("去创建")])],1)])],2)],1)],1)],1),e._v(" "),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"所属车间",prop:"workshopId"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"small",clearable:"",filterable:""},model:{value:e.addDeviceForm.workshopId,callback:function(t){e.$set(e.addDeviceForm,"workshopId",t)},expression:"addDeviceForm.workshopId"}},e._l(e.workshopList,function(e){return i("el-option",{key:e.workshopId,attrs:{label:e.workshopName,value:e.workshopId}})}),1)],1)],1),e._v(" "),"2"!=e.roleType?i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"是否对客户可见",prop:"customerVisibility","label-width":"220px"}},[i("el-radio-group",{model:{value:e.addDeviceForm.customerVisibility,callback:function(t){e.$set(e.addDeviceForm,"customerVisibility",t)},expression:"addDeviceForm.customerVisibility"}},[i("el-radio",{attrs:{label:1}},[e._v("可见")]),e._v(" "),i("el-radio",{attrs:{label:0}},[e._v("不可见")])],1)],1)],1):e._e()],1),e._v(" "),i("div",{staticClass:"border"}),e._v(" "),i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"制造商"}},[i("el-input",{staticStyle:{width:"100%"},attrs:{size:"small",maxlength:"50",clearable:"",placeholder:"请输入"},model:{value:e.addDeviceForm.manufacturer,callback:function(t){e.$set(e.addDeviceForm,"manufacturer",t)},expression:"addDeviceForm.manufacturer"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"设备型号"}},[i("el-input",{staticStyle:{width:"100%"},attrs:{size:"small",maxlength:"50",clearable:"",placeholder:"请输入"},model:{value:e.addDeviceForm.deviceModel,callback:function(t){e.$set(e.addDeviceForm,"deviceModel",t)},expression:"addDeviceForm.deviceModel"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"设备编码"}},[i("el-input",{staticStyle:{width:"100%"},attrs:{size:"small",maxlength:"50",clearable:"",placeholder:"请输入"},model:{value:e.addDeviceForm.deviceCode,callback:function(t){e.$set(e.addDeviceForm,"deviceCode",t)},expression:"addDeviceForm.deviceCode"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"设备位置"}},[i("el-input",{staticStyle:{width:"100%"},attrs:{size:"small",maxlength:"50",clearable:"",placeholder:"请输入"},model:{value:e.addDeviceForm.devicePosition,callback:function(t){e.$set(e.addDeviceForm,"devicePosition",t)},expression:"addDeviceForm.devicePosition"}})],1)],1)],1)],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){return e.cancelAddDevice("addDeviceRef")}}},[e._v("取 消")]),e._v(" "),"editDevice"!=e.deviceTypeDialog?i("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){return e.handleContinueAddLumpoint("addDeviceRef")}}},[e._v("下一步")]):e._e(),e._v(" "),"editDevice"==e.deviceTypeDialog?i("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){return e.handleSaveDevice("addDeviceRef")}}},[e._v("确定")]):e._e()],1)]),e._v(" "),i("el-dialog",{attrs:{title:"自定义设备类型",visible:e.createDeviceFlag,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.createDeviceFlag=t}}},[i("el-form",{ref:"addDeviceRef",staticClass:"demo-addDeviceForm",staticStyle:{padding:"20px"},attrs:{model:e.addDeviceTypeForm,rules:e.addDeviceDefinedRules}},[i("el-form-item",{attrs:{prop:"name"}},[i("el-input",{attrs:{size:"small",clearable:"",maxlength:"25"},model:{value:e.addDeviceTypeForm.name,callback:function(t){e.$set(e.addDeviceTypeForm,"name",t)},expression:"addDeviceTypeForm.name"}})],1)],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){return e.cancelAdd("addDeviceRef")}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){return e.completeAdd("addDeviceRef")}}},[e._v("完 成")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"设备类型查重",visible:e.showDialog,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showDialog=t}}},[i("span",[e._v(e._s(e.addDeviceMsg))]),e._v(" "),4307==e.addDeviceCode?i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:e.chooseAgain}},[e._v("重新选择")]),e._v(" "),i("el-button",{attrs:{type:"danger",size:"small"},on:{click:e.confirmAddDevice}},[e._v("确 定")])],1):e._e(),e._v(" "),4306==e.addDeviceCode?i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(t){e.showDialog=!1}}},[e._v("我知道了")])],1):e._e()]),e._v(" "),e.addLubricationPointDialog?i("CreateLubricationPoint",{attrs:{addDeviceForm:e.addDeviceForm,deviceTypeDialog:e.deviceTypeDialog,selectLubricationPointNumber:e.selectLubricationPointNumber,addLumPointFormSave:e.addLumPointFormSave,saveFlag:e.saveFlag,epInfo:e.epInfo,resource:e.resource,imageLubricationList:e.imageLubricationList,uploadUrl:e.uploadUrl,addLubricationPointDialog:e.addLubricationPointDialog},on:{addOrEditDevice:e.addOrEditDevice,addOrEditLup:e.addOrEditLup,lastNext:e.lastNext,addDevice:e.addDevice,editDeviceAndLumPoint:e.editDeviceAndLumPoint,closeDialogAddLubPoint:e.closeDialogAddLubPoint}}):e._e(),e._v(" "),i("SyncLub",{attrs:{dialogFlag:e.showSyncLubDialog,tipsData:e.tipsData},on:{closeSyncLubDialog:e.closeSyncLubDialog}})],1)};v._withStripped=!0;var f={render:v,staticRenderFns:[]},y=f;var b=!1;var F=i("VU/8")(g,y,!1,function(e){b||i("gcxd")},"data-v-3613f68a",null);F.options.__file="src/components/equipment/components/CreateDevice.vue";t.a=F.exports}});